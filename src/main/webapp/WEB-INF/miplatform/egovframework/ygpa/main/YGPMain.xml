<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="763" Id="IPMain" Left="8" OnLoadCompleted="ISMain_OnLoadCompleted" PidAttrib="7" Title="인천항만공사" TooltipFont=",0" Top="8" Ver="1.0" Width="1200" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_userlist">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_authlist">
				<Contents>
					<colinfo id="menuDc" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_author">
				<Contents>
					<colinfo id="searchCondition" size="256" summ="default" type="STRING"/>
					<colinfo id="searchKeyword" size="256" summ="default" type="STRING"/>
					<record>
						<searchCondition></searchCondition>
						<searchKeyword></searchKeyword>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_authority"></Dataset>
		</Datasets>
		<Image FillType="STRETCH" Height="33" Id="Image2" ImageID="menu_bar" TabOrder="2" Width="1200"></Image>
		<Div Border="Flat" BorderColor="user5" Height="700" Id="divFrame" Left="5" TabOrder="1" Text="Div0" Top="38" Width="1190">
			<Contents>
				<Static Height="16" Id="lblTitle" Left="29" Style="C_lblTitle" TabOrder="2" Text="가입&#32;승인&#32;요청&#32;사용자" Top="15" Width="153"></Static>
				<Image Height="11" Id="imgBullet" ImageID="bullet_b" Left="15" TabOrder="1" Top="15" Width="11"></Image>
				<Grid AutoFit="TRUE" BindDataset="ds_userlist" BkColor2="default" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user5" Bottom="330" Color="user0" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadHeight="19" Height="270" Id="grdList" InputPanel="FALSE" Left="15" LineColor="default" MinWidth="100" OnCellDBLClick="grdList_OnCellDblClick" OnHeadClick="divFrame_grdList_OnHeadClick" Right="1175" SelColor="user20" TabOrder="3" TabStop="true" Top="60" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1160">
					<contents>
						<format id="Default">
							<columns>
								<col width="20"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
							</columns>
							<head>
								<cell autosizing="keep" bkcolor="user10" col="0" color="user12" display="checkbox" text="selChk"/>
								<cell bkcolor="user10" col="1" color="user12" display="text" text="No."/>
								<cell bkcolor="user10" col="2" color="user12" display="text" text="UNIQ"/>
								<cell bkcolor="user10" col="3" color="user12" display="text" text="아이디"/>
								<cell bkcolor="user10" col="4" color="user12" display="text" text="이름"/>
								<cell bkcolor="user10" col="5" color="user12" display="text" text="이메일"/>
								<cell bkcolor="user10" col="6" color="user12" display="text" text="그룹"/>
								<cell bkcolor="user10" col="7" color="user12" display="text" text="사용자유형"/>
								<cell bkcolor="user10" col="8" color="user12" display="text" text="조직"/>
							</head>
							<body>
								<cell autosizing="keep" bkcolor="user6" bkcolor2="user4" col="0" colid="delChk" display="checkbox" edit="checkbox"/>
								<cell bkcolor="user6" bkcolor2="user4" col="1" colid="roleCode" display="text" expr="rowidx+1"/>
								<cell bkcolor="user6" bkcolor2="user4" col="2" colid="uniqId" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="3" colid="userId" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="4" colid="userNm" display="text" expandsize="0"/>
								<cell bkcolor="user6" bkcolor2="user4" col="5" colid="userEmail" display="text" expandsize="0"/>
								<cell bkcolor="user6" bkcolor2="user4" col="6" colid="groupNm" display="text" expandsize="0"/>
								<cell bkcolor="user6" bkcolor2="user4" col="7" colid="userSe" display="text" expandsize="0"/>
								<cell bkcolor="user6" bkcolor2="user4" col="8" colid="orgnztNm" display="text" expandsize="0"/>
							</body>
						</format>
					</contents>
				</Grid>
				<Static Height="16" Id="Static0" Left="29" Style="C_lblTitle" TabOrder="5" Text="권한&#32;미등록&#32;사용자" Top="365" Width="153"></Static>
				<Image Height="11" Id="Image0" ImageID="bullet_b" Left="15" TabOrder="4" Top="365" Width="11"></Image>
				<Grid AutoFit="TRUE" BindDataset="ds_authlist" BkColor2="default" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user5" Bottom="680" Color="user0" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadHeight="19" Height="270" Id="grdList2" InputPanel="FALSE" Left="15" LineColor="default" MinWidth="100" OnHeadClick="divFrame_grdList2_OnHeadClick" Right="1175" SelColor="user20" TabOrder="6" TabStop="true" Top="410" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1160">
					<contents>
						<format id="Default">
							<columns>
								<col width="20"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
								<col width="80"/>
							</columns>
							<head>
								<cell autosizing="keep" bkcolor="user10" col="0" color="user12" display="checkbox" text="selChk"/>
								<cell bkcolor="user10" col="1" color="user12" display="text" text="아이디"/>
								<cell bkcolor="user10" col="2" color="user12" display="text" text="UNIQ"/>
								<cell bkcolor="user10" col="3" color="user12" display="text" text="이름"/>
								<cell bkcolor="user10" col="4" color="user12" display="text" text="사용자유형"/>
								<cell bkcolor="user10" col="5" color="user12" display="text" text="권한"/>
								<cell bkcolor="user10" col="6" color="user12" display="text" text="권한코드"/>
							</head>
							<body>
								<cell autosizing="keep" bkcolor="user6" bkcolor2="user4" col="0" colid="delChk" display="checkbox" edit="checkbox"/>
								<cell bkcolor="user6" bkcolor2="user4" col="1" colid="userId" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="2" colid="uniqId" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="3" colid="userNm" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="4" colid="userSe" display="text"/>
								<cell bkcolor="user6" bkcolor2="user4" col="5" colid="authorGroup" combocol="authorCode" combodataset="ds_author" combotext="authorNm" display="combo" edit="combo"/>
								<cell bkcolor="user6" bkcolor2="user4" col="6" colid="authorGroup" display="text"/>
							</body>
						</format>
					</contents>
				</Grid>
				<Div Height="25" Id="Div0" Left="1003" TabOrder="7" Text="Div0" Top="30" Width="180">
					<Contents>
						<Button ButtonStyle="TRUE" Height="18" Id="btnSearch" ImageID="btn_02_2" Left="25" OnClick="divFrame_Div0_btnSearch_OnClick" Style="C_Button" TabOrder="1" Text="조회" Top="5" Width="48"></Button>
						<Button ButtonStyle="TRUE" Height="18" Id="btnApply" ImageID="btn_02_4" Left="90" OnClick="divFrame_Div0_btnApply_OnClick" Style="C_Button" TabOrder="2" Text="가입승인" Top="5" Width="72"></Button>
					</Contents>
				</Div>
				<Div Height="25" Id="Div1" Left="1003" TabOrder="8" Text="Div0" Top="380" Width="180">
					<Contents>
						<Button ButtonStyle="TRUE" Height="18" Id="btnSearch" ImageID="btn_02_2" Left="25" OnClick="divFrame_Div1_btnSearch_OnClick" Style="C_Button" TabOrder="1" Text="조회" Top="5" Width="48"></Button>
						<Button ButtonStyle="TRUE" Height="18" Id="btnInsert" ImageID="btn_02_2" Left="90" OnClick="divFrame_Div1_btnInsert_OnClick" Style="C_Button" TabOrder="2" Text="저장" Top="5" Width="48"></Button>
					</Contents>
				</Div>
			</Contents>
		</Div>
		<Image Height="21" Id="Image1" ImageID="foot" Left="924" TabOrder="3" Top="738" Width="266"></Image>
		<MenuBar BorderColor="-1" CaptionCol="menuNm" EnableCol="Enable" EndColor="-1" Font="돋움,9,Bold" GradationMode="Horizontal" Height="14" HighlightBKColor="#3b97d3" HighlightTextColor="white" IconCol="Icon" Id="mnuBar" IDCol="menuNo" ImageID="menu_btn_bg" LevelCol="level" MainTextColor="user6" MenuDataset="gdsMenu" OnMenuClick="mnuBar_OnMenuClick" PopupBoard3D="False" PopupLeftMargin="12" PopupTextColor="-1" Selection3D="False" StartColor="-1" Style="XP&#32;2003" TabOrder="4" Top="7" Width="1000"></MenuBar>
		<Static BindDataset="gdsUser" Column="name" Height="17" Id="Static0" Left="1005" TabOrder="5" Text="Static0" Top="9" Width="50"></Static>
		<Static BindDataset="gdsUser" Column="id" Height="17" Id="Static1" Left="1102" TabOrder="6" Text="Static0" Top="7" Visible="FALSE" Width="80"></Static>
		<Image Cursor="HAND" Height="22" Id="imgOnly" ImageID="btn_onlybrowerrun_m" Left="1055" OnClick="imgOnly_OnClick" Static="FALSE" TabOrder="7" Top="5" Width="139"></Image>
	</Form>
	<Script><![CDATA[
#include "lib::common.js";
function ISMain_OnLoadCompleted(obj)
{
	gfn_Init();
	
	fnGetAuthority();
	
	var strSvcid = "getMenu";
	var strController = "/ipa/sym/mpm/ISUserSystemMenuSelect.do";
	var arrayInputDs = [];					   	
	var strOutputDs = "gdsMenu=ds_output gdsUser=ds_user";
	var strParam = "menuNm=통합프레임워크";
	var strFnCallback = "fnCallback";

	fnCmTr(this, strSvcid, strController, arrayInputDs, strOutputDs, strParam, strFnCallback);
}
function fnGetAuthority() {
	var strSvcid="getAuthority";
	var strController="/ipa/cmm/sec/ram/ISMyAuthorList.do";
	var arrayInputDs=[];
	var strOutputDs="ds_authority=ds_authority";
	var strParam="";
	var strFnCallback = "fnCallback";
	
	fnCmTr(this,strSvcid,strController,arrayInputDs,strOutputDs,strParam,strFnCallback);
}


function fnCallback(svcid, errcd, errmsg)
{
	//alert(IPLUSSES);
	gfn_hideProg(this);
	if(errCd < 0){
		alert(errMsg);
		return;
	}
	if(svcid == "getUsrList"){
		//alert(errMsg);
		
	}
	if(svcid == "updateUsr"){
		alert(errMsg);
		divFrame_Div0_btnSearch_OnClick();
	}
	if(svcid == "getAuthList"){
		//alert(errMsg);
		
	}
	if(svcid == "insertAuth"){
		alert(errMsg);
		divFrame_Div1_btnSearch_OnClick();
	}
	if(svcid == "getAuthority"){
		var rows=ds_authority.RowCount();
		for (var i=0 ; i<rows ; i++) {
		    if (ds_authority.GetColumn(i,"USER_AUTHORITY") == "IP_DEFAULT_USER") { //항만정보 
				divFrame.URL=G_Server+"/ipa/req/ISItReqListView.do"; 
				return;
			}
		}
	}
}


function mnuBar_OnMenuClick(obj, strID)
{
	var row = gdsMenu.FindRow("menuNo",strID);
	if(row < 0 || gdsMenu.GetColumn(row,"chkURL") == "dir")	return;
	
	fn_menu(row, "");
}
function lfn_menu(strURL)
{

	lfn_menu2(strURL, "");
}

function lfn_menu2(strURL, strArg)
{
	if ( strURL == "dir" ) return;
	
	var row = gdsMenu.FindRow("chkURL",strURL);
	if(row < 0 ) return;
	
	fn_menu(row, strArg);
}

function lfn_menu_id(strID)
{

	lfn_menu_id2(strID, "");
}
function lfn_menu_id2(strID, strArg)
{
	if ( strURL == "dir" ) return;
	
	var row = gdsMenu.FindRow("menuNo",strID);
	if(row < 0 || gdsMenu.GetColumn(row,"chkURL") == "dir")	return;
	
	fn_menu(row, strArg);
}

function fn_menu(menuRow, strArg)
{
	var row = menuRow;

	gdsCurMenu.DeleteAll();
	gdsCurMenu.AddRow();
	gdsCurMenu.CopyRow(gdsCurMenu.row,"gdsMenu",row);
	//alert(left(gdsMenu.GetColumn(row,"chkURL"), 4));
	//if ( IndexOf(gdsMenu.GetColumn(row,"chkURL"), "http") > -1 ) {
	if ( left(gdsMenu.GetColumn(row,"chkURL"), 5) == "http:" ) {
		var str_arg = "param=" + UrlEncode(gdsMenu.GetColumn(row,"chkURL"));
		var iXPos = ClientToScreenX(this, 0);
		var iyPos = ClientToScreenY(this, 30);

		var url=G_Server+"/ISMiPlatformPopUpPage.do";
		Dialog(url,str_arg,400,300,"",iXPos,iyPos);

		//var url=G_Server+"/ipa/ISCommonPopup.do";
		//WebBrowser0.PageUrl = url;
		//WebBrowser0.run();		
	//}else if ( IndexOf(gdsMenu.GetColumn(row,"chkURL"), "browser::") > -1 ) {
	}else if ( left(gdsMenu.GetColumn(row,"chkURL"), 9) == "browser::" ) {
		var param = right(gdsMenu.GetColumn(row,"chkURL"), length(gdsMenu.GetColumn(row,"chkURL"))-9);

		var str_arg = "param=" + UrlEncode(param);
		var iXPos = ClientToScreenX(this, 0);
		var iyPos = ClientToScreenY(this, 30);

		var url=G_Server+"/ISBrowserViewer.do";
		Open(url,str_arg,50,50,"",iXPos,iyPos);

		//var url=G_Server+"/ipa/ISCommonPopup.do";
		//WebBrowser0.PageUrl = url;
		//WebBrowser0.run();		
	}else{
		divFrame.url = G_Server + gdsMenu.GetColumn(row,"chkURL");
	}
}

function divFrame_grdList_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
//alert(grdList.SetSubCellProp("head",0, 1, "text", "0"));
//alert(grdList.GetSubCellProp("head",0, 1,"text"));
	//if (grdList.GetCellProp("head",nCell,"text")==''){
	if (divFrame.grdList.GetCellProp("head",nCell,"text")=='selChk'
		|| divFrame.grdList.GetCellProp("head",nCell,"text")=='0'
		|| divFrame.grdList.GetCellProp("head",nCell,"text")=='1'
	){
		lfn_GridSelChk(obj, "delChk");
	}
	//}
}



function divFrame_Div0_btnSearch_OnClick(obj)
{
	gfn_showProg(this,"조회중입니다.");

	var strSvcid = "getUsrList";
	var strController = "/ipa/uss/umt/user/ISMainAllUserManage.do";
	//var strVoClass = "egovframework.com.cmm.ComDefaultVO";
	//var strInputDs = "ds_input=ds_input";
	
	var arrayInputDs = [];
					   	
	var strOutputDs = "ds_userlist=ds_output";
	var strParam = "";
	var strFnCallback = "fnCallback";

	fnCmTr(this, strSvcid, strController, arrayInputDs, strOutputDs, strParam, strFnCallback);
}

function divFrame_Div0_btnApply_OnClick(obj)
{
	gfn_showProg(this,"저장중입니다.");
	var userIds = "";
	var userTys = "";

 	for (i=0; i<ds_userlist.RowCount(); i++){
		if ( ds_userlist.GetColumn(i, "delChk") == 1 ){

			userIds += ds_userlist.GetColumn(i, "uniqId")+";";
			userTys += ds_userlist.GetColumn(i, "userTy")+";";
		}
 	}
 	
	var param = "userIds=" + userIds;
	param += "&userTys=" + userTys;

	var strSvcid = "updateUsr";
	var strController = "/ipa/uss/umt/user/ISMainAllUserSttusUpdate.do?"+param;
	var arrayInputDs = [];
	var strOutputDs = "";
	var strParam = "";
	var strFnCallback = "fnCallback";

	fnCmTr(this, strSvcid, strController, arrayInputDs, strOutputDs, strParam, strFnCallback);
}

function divFrame_Div1_btnInsert_OnClick(obj)
{
	gfn_showProg(this,"저장중입니다.");
	var userIds = "";
	var uniqIds = "";
	var authorCodes = "";
 	for (i=0; i<ds_authlist.RowCount(); i++){
		if ( ds_authlist.GetColumn(i, "delChk") == 1 ){
			userIds += ds_authlist.GetColumn(i, "userId")+";";
			uniqIds += ds_authlist.GetColumn(i, "uniqId")+";";
			authorCodes += ds_authlist.GetColumn(i, "authorGroup")+";";
		}
 	}
 	
	var param = "userIds=" + userIds;
	param += "&uniqIds=" + uniqIds;
	param += "&authorCodes=" + authorCodes;
	 	
	var strSvcid = "insertAuth";
	var strController = "/ipa/uss/umt/user/ISMainAuthorUserInsert.do?"+param;
	var arrayInputDs = [];
	var strOutputDs = "";
	var strParam = "";
	var strFnCallback = "fnCallback";

	fnCmTr(this, strSvcid, strController, arrayInputDs, strOutputDs, strParam, strFnCallback);
}


function divFrame_Div1_btnSearch_OnClick(obj)
{
	gfn_showProg(this,"조회중입니다.");

	var strSvcid = "getAuthList";
	var strController = "/ipa/uss/umt/user/ISMainAuthorUserManage.do";
	//var strVoClass = "egovframework.com.cmm.ComDefaultVO";
	//var strInputDs = "ds_input=ds_input";
	
	var arrayInputDs = [];
					   	
	var strOutputDs = "ds_authlist=ds_output ds_author=ds_outputmanage";
	var strParam = "";
	var strFnCallback = "fnCallback";

	fnCmTr(this, strSvcid, strController, arrayInputDs, strOutputDs, strParam, strFnCallback);
}

function divFrame_grdList2_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if (divFrame.grdList2.GetCellProp("head",nCell,"text")=='selChk'
		|| divFrame.grdList2.GetCellProp("head",nCell,"text")=='0'
		|| divFrame.grdList2.GetCellProp("head",nCell,"text")=='1'
	){
		lfn_GridSelChk(obj, "delChk");
	}
}


function imgHome_OnClick(obj,nX,nY)
{
	gfn_Message("-8888","gohome");
}

function imgLogout_OnClick(obj,nX,nY)
{
	gfn_Message("-9999","logout");
}

function imgOnly_OnClick(obj,nX,nY)
{
	gfn_Message("-9090","only");
}
]]></Script>
</Window>