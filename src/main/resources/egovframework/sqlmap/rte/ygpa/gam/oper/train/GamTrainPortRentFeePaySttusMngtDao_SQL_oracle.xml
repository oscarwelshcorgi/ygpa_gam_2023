<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.oper.trainPort">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamTrainPortRentFeePaySttusMngtVO" type="egovframework.rte.ygpa.gam.oper.train.service.GamTrainPortRentFeePaySttusMngtVO"/>

    <resultMap id="gamTrainPortRentFeePaySttusMngtSumMap" class="egovframework.rte.ygpa.gam.oper.train.service.GamTrainPortRentFeePaySttusMngtVO">
        <result property="sumCnt" column="SUM_CNT" columnIndex="1"/>
        <result property="sumNticAmt" column="SUM_BILL_AMNT" columnIndex="2"/>
    </resultMap>
    
    <select id="gamTrainPortRentFeePaySttusMngtDao.selectTrainPortRentFeePaySttusMngtList_D" parameterClass="gamTrainPortRentFeePaySttusMngtVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT 
							     PO.INT_SEQ             
							    , PO.DEL_KIND           
							    , PO.JINGSU_DATE            
							    , PO.SUNAP_DATE         
							    , PO.PRT_AT_CODE            
							    , PO.FEE_TP             
							    , PO.FISCAL_YR          
							    , PO.BILL_NO                
							    , PO.ACCNT_CODE         
							    , PO.AGENT_CODE         
							    , PO.BILL_AMNT          
							    , PO.BILL_DT                
							    , PO.BILL_PRT_YN            
							    , PO.DUE_DATE           
							    , PO.RCVD_DT                
							    , PO.RCVD_TP                
							    , PO.RSLT_CODE          
							    , PO.EXMP_AMNT          
							    , PO.OVER_AMNT          
							    , PO.DC_AMNT                
							    , PO.DC_CODE                
							    , PO.DC_RATE                
							    , PO.RECPT_EPDT         
							    , PO.ELCT_BILL_RSLT     
							    , PO.BULL_INFO_INQR_DTIME
							    , PO.AMNT_RSN           
							    , PO.BZ_RGST_ID         
							    , PO.AGENT_NAME         
							    , PO.LAST               
							    , PO.VAT_YN             
							    , PO.JIRO_NO                
							    , PO.ELEC_PAY_NO            
							    , PO.CUSTOMER_MNGT_NO   
							    , PO.CUSTOMER_ADDR      
							    , PO.PAY_NAME 
							FROM ERP_REV_COLL_F@YGPA_PORTMIS PO
							    , LEV_REQEST_F LE
							WHERE LE.NTICNO = PO.BILL_NO	<!-- 고지 번호 -->
							AND (
							        (LE.PRT_AT_CODE, LE.MNG_YEAR, LE.MNG_NO, LE.MNG_CNT) IN (
							                                                  SELECT   R.PRT_AT_CODE
							                                                         , R.MNG_YEAR
							                                                         , R.MNG_NO
							                                                         , R.MNG_CNT 
							                                                   FROM ASSETS_RENT_F R
							                                                   WHERE R.QUAY_GROUP_CD = 'T' <!-- 철송장 -->
							                                                 )
							    ) 
					       
					        <isNotEmpty property="sPrtAtCode">
			                    AND PO.PRT_AT_CODE = #sPrtAtCode#
			                </isNotEmpty>
							ORDER BY PO.INT_SEQ DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>

    </select>
    
    <select id="gamTrainPortRentFeePaySttusMngtDao.selectTrainPortRentFeePaySttusMngtListTotCnt_S" parameterClass="gamTrainPortRentFeePaySttusMngtVO" resultClass="int">
            SELECT 
            	COUNT(*) TOTCNT
            FROM ERP_REV_COLL_F@YGPA_PORTMIS PO
			    , LEV_REQEST_F LE
			WHERE LE.NTICNO = PO.BILL_NO	<!-- 고지 번호 -->
			AND (
			        (LE.PRT_AT_CODE, LE.MNG_YEAR, LE.MNG_NO, LE.MNG_CNT) IN (
			                                                  SELECT   R.PRT_AT_CODE
			                                                         , R.MNG_YEAR
			                                                         , R.MNG_NO
			                                                         , R.MNG_CNT 
			                                                   FROM ASSETS_RENT_F R
			                                                   WHERE R.QUAY_GROUP_CD = 'T' <!-- 철송장 -->
			                                                 )
			    ) 
	       
	        <isNotEmpty property="sPrtAtCode">
                   AND PO.PRT_AT_CODE = #sPrtAtCode#
             </isNotEmpty>
    </select>
 
    <select id="gamTrainPortRentFeePaySttusMngtDao.selectTrainPortRentFeePaySttusMngtSum_S" parameterClass="gamTrainPortRentFeePaySttusMngtVO" resultMap="gamTrainPortRentFeePaySttusMngtSumMap">
            SELECT 
               TRIM(TO_CHAR(NVL(COUNT(*),0), '999,999,999,999')) SUM_CNT
               , TRIM(TO_CHAR(NVL(SUM(PO.BILL_AMNT),0), '999,999,999,999')) SUM_BILL_AMNT
            FROM ERP_REV_COLL_F@YGPA_PORTMIS PO
			    , LEV_REQEST_F LE
			WHERE LE.NTICNO = PO.BILL_NO	<!-- 고지 번호 -->
			AND (
			        (LE.PRT_AT_CODE, LE.MNG_YEAR, LE.MNG_NO, LE.MNG_CNT) IN (
			                                                  SELECT   R.PRT_AT_CODE
			                                                         , R.MNG_YEAR
			                                                         , R.MNG_NO
			                                                         , R.MNG_CNT 
			                                                   FROM ASSETS_RENT_F R
			                                                   WHERE R.QUAY_GROUP_CD = 'T' <!-- 철송장 -->
			                                                 )
			    ) 
	       
	        <isNotEmpty property="sPrtAtCode">
                   AND PO.PRT_AT_CODE = #sPrtAtCode#
             </isNotEmpty>
    </select>
       
</sqlMap>