<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd"> 
<sqlMap namespace="ygpa.gam.soc">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyCtrtLgerHistVO" type="egovframework.rte.ygpa.gam.ctrt.service.GamFcltyCtrtLgerHistVO"/>

	<resultMap id="selectFcltyCtrtLgerHistInfoSumMap" class="gamFcltyCtrtLgerHistVO">
		<result property="totalCnt" column="TOTAL_CNT" columnIndex="1" javaType="int"/>
        <result property="sumPlanAmt" column="SUM_PLAN_AMT" columnIndex="2" javaType="java.lang.Long"/>
        <result property="sumPrmtAmt" column="SUM_PRMT_AMT" columnIndex="3" javaType="java.lang.Long"/>
        <result property="sumScsbidAmt" column="SUM_SCSBID_AMT" columnIndex="4" javaType="java.lang.Long"/>
        <result property="sumBaseAmt" column="SUM_BASE_AMT" columnIndex="5" javaType="java.lang.Long"/>
    </resultMap>
    
    <resultMap id="selectFcltyCtrtLgerHistDetailMap" class="gamFcltyCtrtLgerHistVO">
		<result property="ctrtNo" column="CTRT_NO" columnIndex="1"/>
		<result property="ctrtSe" column="CTRT_SE" columnIndex="2"/>
		<result property="bidPblancNo" column="BID_PBLANC_NO" columnIndex="3"/>
		<result property="bidPblancDt" column="BID_PBLANC_DT" columnIndex="4"/>
		<result property="bidDt" column="BID_DT" columnIndex="5"/>
		<result property="registEntrpsCd" column="REGIST_ENTRPS_CD" columnIndex="6"/>
		<result property="siteDesc" column="SITE_DESC" columnIndex="7"/>
		<result property="ctrtNm" column="CTRT_NM" columnIndex="8"/>
		<result property="planAmt" column="PLAN_AMT" columnIndex="9"/>
		<result property="prmtAmt" column="PRMT_AMT" columnIndex="10"/>
		<result property="scsbidAmt" column="SCSBID_AMT" columnIndex="11"/>
		<result property="scsbidRate" column="SCSBID_RATE" columnIndex="12"/>
		<result property="baseAmt" column="BASE_AMT" columnIndex="13"/>
		<result property="bidMth" column="BID_MTH" columnIndex="14"/>
		<result property="ctrtMth" column="CTRT_MTH" columnIndex="15"/>
		<result property="ctrtDt" column="CTRT_DT" columnIndex="16"/>
		<result property="ctrtAmt" column="CTRT_AMT" columnIndex="17"/>
		<result property="ctrtPdFrom" column="CTRT_PD_FROM" columnIndex="18"/>
		<result property="ctrtPdTo" column="CTRT_PD_TO" columnIndex="19"/>
		<result property="ctrtGrntyAmt" column="CTRT_GRNTY_AMT" columnIndex="20"/>
		<result property="prcuPblancNo" column="PRCU_PBLANC_NO" columnIndex="21"/>
		<result property="ctrtGrntyMth" column="CTRT_GRNTY_MTH" columnIndex="22"/>
		<result property="ctrtExamDt" column="CTRT_EXAM_DT" columnIndex="23"/>
		<result property="intendant1" column="INTENDANT_1" columnIndex="24"/>
		<result property="intendant2" column="INTENDANT_2" columnIndex="25"/>
		<result property="intendant3" column="INTENDANT_3" columnIndex="26"/>
		<result property="caryFwd_bdgtAmt" column="CARY_FWD_BDGT_AMT" columnIndex="27"/>
		<result property="elctrnSanctnTrnsmisSe" column="ELCTRN_SANCTN_TRNSMIS_SE" columnIndex="28"/>
		<result property="elctrnSanctnProgrsCd" column="ELCTRN_SANCTN_PROGRS_CD" columnIndex="29"/>
		<result property="elctrnSanctnTrnsmisDt" column="ELCTRN_SANCTN_TRNSMIS_DT" columnIndex="30"/>
		<result property="elctrnSanctnInterlockInfo" column="ELCTRN_SANCTN_INTERLOCK_INFO" columnIndex="31"/>
		<result property="elctrnSanctnDocId" column="ELCTRN_SANCTN_DOC_ID" columnIndex="32"/>
		<result property="confmDt" column="CONFM_DT" columnIndex="33"/>
		<result property="confmerCd" column="CONFMER_CD" columnIndex="34"/>
		<result property="regUsr" column="REG_USR" columnIndex="35"/>
		<result property="registDt" column="REGIST_DT" columnIndex="36"/>
		<result property="updUsr" column="UPD_USR" columnIndex="37"/>
		<result property="updtDt" column="UPDT_DT" columnIndex="38"/>
		<result property="orderMthd" column="ORDER_MTHD" columnIndex="39"/>
		<result property="sldrtGrnty" column="SLDRT_GRNTY" columnIndex="40"/>
		<result property="jobChrgDeptCd" column="JOB_CHRG_DEPT_CD" columnIndex="41"/>
		<result property="flawPdFrom" column="FLAW_PD_FROM" columnIndex="42"/>
		<result property="flawPdTo" column="FLAW_PD_TO" columnIndex="43"/>
		<result property="causeAct" column="CAUSE_ACT" columnIndex="44"/>
    </resultMap>

    <select id="gamFcltyCtrtLgerHistDao.selectFcltyCtrtLgerHistList" parameterClass="gamFcltyCtrtLgerHistVO" resultClass="egovMap">
        SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT
                                    CTRT_NO
                                  , (CASE WHEN CTRT_SE = '1' THEN '자체' 
                                  		  WHEN CTRT_SE = '2' THEN '조달'
                                  	END) AS CTRT_SE
                                  , BID_PBLANC_NO
                                  , CTRT_NM
                                  , TO_CHAR(BID_PBLANC_DT, 'YYYY-MM-DD') AS BID_PBLANC_DT
                                  , TO_CHAR(BID_DT, 'YYYY-MM-DD') AS BID_DT
                                  , REGIST_ENTRPS_CD
                                  , GAM_GETENTRPSNM(REGIST_ENTRPS_CD, 1) AS REGIST_ENTRPS_NM
                                  , PLAN_AMT
                                  , PRMT_AMT
                                  , SCSBID_AMT
                                  , SCSBID_RATE
                                  , BASE_AMT
                             FROM 
					              	CTRT_INFO_F
					              
								  WHERE 1=1
					
									<isNotEmpty property="sCtrtSe">
										AND CTRT_SE = #sCtrtSe#
									</isNotEmpty>
									
									<isNotEmpty property="sCtrtNm">
										AND CTRT_NM LIKE '%' || #sCtrtNm# || '%' 
									</isNotEmpty>
									
									<isNotEmpty property="sCtrtFrDt">
										<![CDATA[ AND CTRT_DT >= #sCtrtFrDt# ]]>
									</isNotEmpty>
									
									<isNotEmpty property="sCtrtToDt">
										<![CDATA[ AND CTRT_DT < #sCtrtToDt# ]]>
									</isNotEmpty>
									
									<isNotEmpty property="sRegistEntrpsCd">
										AND REGIST_ENTRPS_CD = #sRegistEntrpsCd#
									</isNotEmpty>
									
									<isNotEmpty property="sBidFrDt">
										<![CDATA[ AND BID_DT >= #sBidFrDt# ]]>
									</isNotEmpty>
									
									<isNotEmpty property="sCtrtToDt">
										<![CDATA[ AND BID_DT < #sBidToDt# ]]>
									</isNotEmpty>
									

                             <!-- ORDER BY REGIST_DT DESC -->
                             ORDER BY BID_DT DESC, CTRT_DT DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamFcltyCtrtLgerHistDao.selectFcltyCtrtLgerHistInfoSum" parameterClass="gamFcltyCtrtLgerHistVO" resultMap="selectFcltyCtrtLgerHistInfoSumMap">

        SELECT 
        		COUNT(*) AS TOTAL_CNT
        		, NVL(SUM(PLAN_AMT),0) AS SUM_PLAN_AMT
        		, NVL(SUM(PRMT_AMT),0) AS SUM_PRMT_AMT
        		, NVL(SUM(SCSBID_AMT),0) AS SUM_SCSBID_AMT
        		, NVL(SUM(BASE_AMT),0) AS SUM_BASE_AMT
              FROM 
              	CTRT_INFO_F
              
			  WHERE 1=1

				<isNotEmpty property="sCtrtSe">
					AND CTRT_SE = #sCtrtSe#
				</isNotEmpty>
				
				<isNotEmpty property="sCtrtNm">
					AND CTRT_NM LIKE '%' || #sCtrtNm# || '%' 
				</isNotEmpty>
				
				<isNotEmpty property="sCtrtFrDt">
					<![CDATA[ AND CTRT_DT >= #sCtrtFrDt# ]]>
				</isNotEmpty>
				
				<isNotEmpty property="sCtrtToDt">
					<![CDATA[ AND CTRT_DT < #sCtrtToDt# ]]>
				</isNotEmpty>
				
				<isNotEmpty property="sRegistEntrpsCd">
					AND REGIST_ENTRPS_CD = #sRegistEntrpsCd#
				</isNotEmpty>
				
				<isNotEmpty property="sBidFrDt">
					<![CDATA[ AND BID_DT >= #sBidFrDt# ]]>
				</isNotEmpty>
				
				<isNotEmpty property="sCtrtToDt">
					<![CDATA[ AND BID_DT < #sBidToDt# ]]>
				</isNotEmpty>
    </select>
    
    
    <select id="gamFcltyCtrtLgerHistDao.selectFcltyCtrtLgerHistDetail" parameterClass="gamFcltyCtrtLgerHistVO" resultMap="selectFcltyCtrtLgerHistDetailMap">

        SELECT 
        		CTRT_NO
        		, CTRT_SE
        		, BID_PBLANC_NO
        		, TO_CHAR(BID_PBLANC_DT, 'YYYY-MM-DD') AS BID_PBLANC_DT
        		, TO_CHAR(BID_DT, 'YYYY-MM-DD') AS BID_DT
        		, REGIST_ENTRPS_CD
        		, SITE_DESC
        		, CTRT_NM
        		, PLAN_AMT
        		, PRMT_AMT
        		, SCSBID_AMT
        		, SCSBID_RATE
        		, BASE_AMT
        		, BID_MTH
        		, CTRT_MTH
        		, TO_CHAR(CTRT_DT, 'YYYY-MM-DD') AS CTRT_DT
        		, CTRT_AMT
        		, TO_CHAR(CTRT_PD_FROM, 'YYYY-MM-DD') AS CTRT_PD_FROM
        		, TO_CHAR(CTRT_PD_TO, 'YYYY-MM-DD') AS CTRT_PD_TO
        		, CTRT_GRNTY_AMT
        		, PRCU_PBLANC_NO
        		, CTRT_GRNTY_MTH
        		, TO_CHAR(CTRT_EXAM_DT, 'YYYY-MM-DD') AS CTRT_EXAM_DT
        		, INTENDANT_1
        		, INTENDANT_2
        		, INTENDANT_3
        		, CARY_FWD_BDGT_AMT
        		, ELCTRN_SANCTN_TRNSMIS_SE
        		, ELCTRN_SANCTN_PROGRS_CD
        		, TO_CHAR(ELCTRN_SANCTN_TRNSMIS_DT, 'YYYY-MM-DD') AS ELCTRN_SANCTN_TRNSMIS_DT
        		, ELCTRN_SANCTN_INTERLOCK_INFO
        		, ELCTRN_SANCTN_DOC_ID
        		, TO_CHAR(CONFM_DT, 'YYYY-MM-DD') AS CONFM_DT
        		, CONFMER_CD
        		, REG_USR
        		, TO_CHAR(REGIST_DT, 'YYYY-MM-DD') AS REGIST_DT
        		, UPD_USR
        		, TO_CHAR(UPDT_DT, 'YYYY-MM-DD') AS UPDT_DT
        		, ORDER_MTHD
        		, SLDRT_GRNTY
        		, JOB_CHRG_DEPT_CD
        		, TO_CHAR(FLAW_PD_FROM, 'YYYY-MM-DD') AS FLAW_PD_FROM
        		, TO_CHAR(FLAW_PD_TO, 'YYYY-MM-DD') AS FLAW_PD_TO
        		, CAUSE_ACT
              FROM 
              	CTRT_INFO_F
              
			  WHERE CTRT_NO = #ctrtNo#

    </select>
    
    
</sqlMap>