<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.asset.rent">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamAssetRentSttusInqireVO" type="egovframework.rte.ygpa.gam.asset.rent.service.GamAssetRentSttusInqireVO"/>
    
    <resultMap id="gamAssetRentSumMap" class="egovframework.rte.ygpa.gam.asset.rent.service.GamAssetRentSttusInqireVO">
        <result property="sumCnt" column="SUM_CNT" columnIndex="1"/>
        <result property="sumGrAr" column="SUM_GR_AR" columnIndex="2"/>
        <result property="sumGrFee" column="SUM_GR_FEE" columnIndex="3"/>
    </resultMap>

    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentList_D" parameterClass="gamAssetRentSttusInqireVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT 
                                    A.PRT_AT_CODE
                                  , (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM019' AND CD.CODE = A.PRT_AT_CODE AND ROWNUM = 1) PRT_AT_CODE_NM  
                                  , A.MNG_YEAR
                                  , A.MNG_NO
                                  , A.MNG_CNT
                                  , A.MNG_YEAR || '-' || A.MNG_NO || '-' || A.MNG_CNT AS RENT_MNG_NO
                                  , A.ENTRPSCD
                                  , ( SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = A.ENTRPSCD AND ROWNUM = 1 ) ENTRPS_NM 
                                  , A.REQST_SE_CD
                                  , (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM011' AND CD.CODE = A.REQST_SE_CD AND ROWNUM = 1) REQST_SE_CD_NM
                                  , A.GR_AR
                                  , A.GR_FEE
                                  , A.NTIC_MTH
                                  , TO_CHAR(A.FRST_PRMISN_DT, 'YYYY-MM-DD') FRST_PRMISN_DT
                                  , TO_CHAR(A.PRMISN_DT, 'YYYY-MM-DD') PRMISN_DT
                                  , A.PRMISN_YN
                                  , TO_CHAR(A.GR_USAGE_PD_FROM, 'YYYY-MM-DD') GR_USAGE_PD_FROM
                                  , TO_CHAR(A.GR_USAGE_PD_TO, 'YYYY-MM-DD') GR_USAGE_PD_TO
                                  , A.DOC_NO
                                  , A.RM
                                  , A.CMT
                                  , A.ETC
                                  , A.REG_USR
                                  , TO_CHAR(A.REGIST_DT, 'YYYY-MM-DD') REGIST_DT 
                                  , A.UPD_USR
                                  , TO_CHAR(A.UPDT_DT, 'YYYY-MM-DD') UPDT_DT 
                                  , A.GR_RDCXPT_FEE
                                  , A.GIS_CD
                                  , A.DEPTCD
                                  , A.PAY_MTH
                                  , TO_CHAR(A.FRST_REQST_DT, 'YYYY-MM-DD') FRST_REQST_DT
                                  , A.SANCTN_STTUS
                                  , A.SANCTNER_EMPL_NO
                                  , A.QUAY_CD
                                  , A.SANCTN_DT
                                  , A.QUAY_GROUP_CD
                                  , A.REQST_DT
                             FROM ASSETS_RENT_F A
                            WHERE 1=1 
                            
                             <isNotEmpty property="sPrtAtCode">
					             AND A.PRT_AT_CODE = #sPrtAtCode#  
					         </isNotEmpty>
					         
					         <isNotEmpty property="sReqstSeCd">
					             AND A.REQST_SE_CD = #sReqstSeCd#  
					         </isNotEmpty>
					         
					         <isNotEmpty property="sEntrpscd">
					             AND A.ENTRPSCD = #sEntrpscd#  
					         </isNotEmpty>
					         
					         <isNotEmpty property="sGrUsagePdFrom"> 
					             AND A.GR_USAGE_PD_FROM <![CDATA[>=]]> TO_DATE(#sGrUsagePdFrom#||'000000','yyyy-mm-ddhh24miss')
					         </isNotEmpty>
					         
					         <isNotEmpty property="sGrUsagePdTo">
					             AND A.GR_USAGE_PD_TO <![CDATA[<=]]> TO_DATE(#sGrUsagePdTo#||'235959','yyyy-mm-ddhh24miss')
					         </isNotEmpty>
					         
					         <isNotEmpty property="sGrAr">
					             AND A.GR_AR = #sGrAr#
					         </isNotEmpty>
					         
					         <isNotEmpty property="sMngYear">
					             AND A.MNG_YEAR = #sMngYear#
					         </isNotEmpty>
					         
					         <isNotEmpty property="sMngNo">
					             AND A.MNG_NO = #sMngNo#
					         </isNotEmpty>
					         
					         <isNotEmpty property="sMngCnt">
					             AND A.MNG_CNT = #sMngCnt#
					         </isNotEmpty>
					         
					         <isNotEmpty property="sPrmisnYn">
					             AND A.PRMISN_YN = #sPrmisnYn#
					         </isNotEmpty>
                             
                             <isNotEmpty property="sUsagePrposCd">
					             AND (
					                   (PRT_AT_CODE, MNG_YEAR, MNG_NO, MNG_CNT) IN (
					                                                                 SELECT  PRT_AT_CODE
					                                                                       , MNG_YEAR
					                                                                       , MNG_NO
					                                                                       , MNG_CNT 
					                                                                   FROM ASSETS_RENT_DETAIL_F
					                                                                  WHERE USAGE_PRPOS_CD = #sUsagePrposCd#
					                                                               )
					                 ) 
					         </isNotEmpty>
                             
                             <!-- ORDER BY REGIST_DT DESC -->
                             ORDER BY A.MNG_YEAR DESC, A.MNG_NO DESC, A.MNG_CNT DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentListTotCnt_S" parameterClass="gamAssetRentSttusInqireVO" resultClass="int">
            SELECT COUNT(*) totcnt
              FROM ASSETS_RENT_F A
             WHERE 1=1
              
             <isNotEmpty property="sPrtAtCode">
                 AND A.PRT_AT_CODE = #sPrtAtCode#  
             </isNotEmpty>
             
             <isNotEmpty property="sReqstSeCd">
                 AND A.REQST_SE_CD = #sReqstSeCd#  
             </isNotEmpty>
             
             <isNotEmpty property="sEntrpscd">
                 AND A.ENTRPSCD = #sEntrpscd#  
             </isNotEmpty>
             
             <isNotEmpty property="sGrUsagePdFrom"> 
                 AND A.GR_USAGE_PD_FROM <![CDATA[>=]]> TO_DATE(#sGrUsagePdFrom#||'000000','yyyy-mm-ddhh24miss')
             </isNotEmpty>
             
             <isNotEmpty property="sGrUsagePdTo">
                 AND A.GR_USAGE_PD_TO <![CDATA[<=]]> TO_DATE(#sGrUsagePdTo#||'235959','yyyy-mm-ddhh24miss')
             </isNotEmpty>
             
             <isNotEmpty property="sGrAr">
                 AND A.GR_AR = #sGrAr#
             </isNotEmpty>
             
             <isNotEmpty property="sMngYear">
                 AND A.MNG_YEAR = #sMngYear#
             </isNotEmpty>
             
             <isNotEmpty property="sMngNo">
                 AND A.MNG_NO = #sMngNo#
             </isNotEmpty>
             
             <isNotEmpty property="sMngCnt">
                 AND A.MNG_CNT = #sMngCnt#
             </isNotEmpty>
             
             <isNotEmpty property="sPrmisnYn">
                 AND A.PRMISN_YN = #sPrmisnYn#
             </isNotEmpty>
             
             <isNotEmpty property="sUsagePrposCd">
                 AND (
                       (PRT_AT_CODE, MNG_YEAR, MNG_NO, MNG_CNT) IN (
                                                                     SELECT  PRT_AT_CODE
                                                                           , MNG_YEAR
                                                                           , MNG_NO
                                                                           , MNG_CNT 
                                                                       FROM ASSETS_RENT_DETAIL_F
                                                                      WHERE USAGE_PRPOS_CD = #sUsagePrposCd#
                                                                   )
                     ) 
             </isNotEmpty>
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentSum_S" parameterClass="gamAssetRentSttusInqireVO" resultMap="gamAssetRentSumMap">
         SELECT 
                 NVL(COUNT(*),0) SUM_CNT
               , NVL(SUM(A.GR_AR),0) SUM_GR_AR
               , NVL(SUM(A.GR_FEE),0) SUM_GR_FEE
          FROM ASSETS_RENT_F A
         WHERE 1=1
              
         <isNotEmpty property="sPrtAtCode">
             AND A.PRT_AT_CODE = #sPrtAtCode#  
         </isNotEmpty>
         
         <isNotEmpty property="sReqstSeCd">
             AND A.REQST_SE_CD = #sReqstSeCd#  
         </isNotEmpty>
         
         <isNotEmpty property="sEntrpscd">
             AND A.ENTRPSCD = #sEntrpscd#  
         </isNotEmpty>
         
         <isNotEmpty property="sGrUsagePdFrom"> 
             AND A.GR_USAGE_PD_FROM <![CDATA[>=]]> TO_DATE(#sGrUsagePdFrom#||'000000','yyyy-mm-ddhh24miss')
         </isNotEmpty>
         
         <isNotEmpty property="sGrUsagePdTo">
             AND A.GR_USAGE_PD_TO <![CDATA[<=]]> TO_DATE(#sGrUsagePdTo#||'235959','yyyy-mm-ddhh24miss')
         </isNotEmpty>
         
         <isNotEmpty property="sGrAr">
             AND A.GR_AR = #sGrAr#
         </isNotEmpty>
         
         <isNotEmpty property="sMngYear">
             AND A.MNG_YEAR = #sMngYear#
         </isNotEmpty>
         
         <isNotEmpty property="sMngNo">
             AND A.MNG_NO = #sMngNo#
         </isNotEmpty>
         
         <isNotEmpty property="sMngCnt">
             AND A.MNG_CNT = #sMngCnt#
         </isNotEmpty>
         
         <isNotEmpty property="sPrmisnYn">
             AND A.PRMISN_YN = #sPrmisnYn#
         </isNotEmpty>
         
         <isNotEmpty property="sUsagePrposCd">
             AND (
                   (PRT_AT_CODE, MNG_YEAR, MNG_NO, MNG_CNT) IN (
                                                                 SELECT  PRT_AT_CODE
                                                                       , MNG_YEAR
                                                                       , MNG_NO
                                                                       , MNG_CNT 
                                                                   FROM ASSETS_RENT_DETAIL_F
                                                                  WHERE USAGE_PRPOS_CD = #sUsagePrposCd#
                                                               )
                 ) 
         </isNotEmpty>
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentDetailList_D" parameterClass="gamAssetRentSttusInqireVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT 
                                  A.ASSETS_USAGE_SEQ             
                                , A.GIS_ASSETS_CD
                                , A.GIS_ASSETS_SUB_CD
                                , (A.GIS_ASSETS_CD || '-' || A.GIS_ASSETS_SUB_CD) ASSETS_CD_STR
                                
                                , (SELECT F.GIS_ASSETS_NM FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_NM
                                
                                , (SELECT F.GIS_ASSETS_LOCPLC FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_LOCPLC      
                                
                                , (SELECT F.GIS_ASSETS_LNM FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_LNM
                                
                                , (SELECT F.GIS_ASSETS_LNM_SUB FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_LNM_SUB
                                
                                , (SELECT F.GIS_ASSETS_AR FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_AR
                                
                                , (SELECT F.GIS_ASSETS_REAL_RENT_AR FROM GIS_ASSETS_CD_F F 
                                    WHERE F.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE 
                                      AND F.GIS_ASSETS_SUB_CD = A.GIS_ASSETS_SUB_CD 
                                      AND F.GIS_ASSETS_CD = A.GIS_ASSETS_CD 
                                      AND ROWNUM = 1) GIS_ASSETS_REAL_RENT_AR
      
                                , A.USAGE_AR
                                , TO_CHAR(A.USAGE_PD_FROM,'YYYY-MM-DD') USAGE_PD_FROM
                                , TO_CHAR(A.USAGE_PD_TO,'YYYY-MM-DD') USAGE_PD_TO
                                , A.USAGE_PURPS
                                , A.USAGE_DTLS
                                , A.USAGE_PRPOS_CD
                                , A.EXEMPT_SE
                                , (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM009' AND CD.CODE = A.EXEMPT_SE AND ROWNUM = 1) EXEMPT_SE_NM
                                , A.EXEMPT_RSN_CD
                                , A.EXEMPT_RSN
                                , TO_CHAR(A.EXEMPT_PD_FROM,'YYYY-MM-DD') EXEMPT_PD_FROM
                                , TO_CHAR(A.EXEMPT_PD_TO,'YYYY-MM-DD') EXEMPT_PD_TO
                                , A.COMPUT_DTLS
                                , A.OLNLP
                                , A.APPLC_TARIFF
                                , A.APPLC_MTH
                                , A.PACK_SE
                                , A.ENTRPS_SE
                                , A.FEE_CALC_SE
                                , A.RDCXPT_FEE_CALC_SE
                                , A.RDCXPT_FEE
                                , A.FEE
                                , TO_CHAR(A.TRMNAT_DT,'YYYY-MM-DD') TRMNAT_DT
                                , A.TRMNAT_RSN
                                , A.GIS_CD
                                , A.REG_USR
                                , TO_CHAR(A.REGIST_DT,'YYYY-MM-DD') REGIST_DT
                                , A.UPD_USR
                                , TO_CHAR(A.UPDT_DT,'YYYY-MM-DD') UPDT_DT
                                , A.PRT_AT_CODE
                                , (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM019' AND CD.CODE = A.PRT_AT_CODE AND ROWNUM = 1) PRT_AT_CODE_NM
                                , A.GIS_ASSETS_PRT_AT_CODE
                                , A.MNG_YEAR
                                , A.MNG_NO
                                , A.MNG_CNT
                                , A.QUAY_CD
                            FROM ASSETS_RENT_DETAIL_F A
                           WHERE 1=1  
                             AND A.PRT_AT_CODE = #prtAtCode#
                             AND A.MNG_YEAR    = #mngYear#
                             AND A.MNG_NO      = #mngNo#
                             AND A.MNG_CNT     = #mngCnt#
                             
                             ORDER BY REGIST_DT DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentDetailListTotCnt_S" parameterClass="gamAssetRentSttusInqireVO" resultClass="int">
        SELECT COUNT(*) totcnt
          FROM ASSETS_RENT_DETAIL_F A
         WHERE 1=1  
           AND A.PRT_AT_CODE = #prtAtCode#
           AND A.MNG_YEAR    = #mngYear#
           AND A.MNG_NO      = #mngNo#
           AND A.MNG_CNT     = #mngCnt#
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentFileList_D" parameterClass="gamAssetRentSttusInqireVO" resultClass="egovMap">
        SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           
                           SELECT 
                                    A.PHOTO_SEQ
                                  , A.PHOTO_SJ
                                  , A.FILENM_PHYSICL
                                  , A.FILENM_LOGIC
                                  , A.SHOT_DT
                                  , A.REG_USR
                                  , A.REGIST_DT
                                  , A.PRT_AT_CODE
                                  , A.MNG_YEAR
                                  , A.MNG_NO
                                  , A.MNG_CNT
                                  , A.PHOTO_DESC
                             FROM ASSETS_RENT_PHOTO_F A
                            WHERE PRT_AT_CODE = #prtAtCode#
                              AND MNG_YEAR    = #mngYear#
                              AND MNG_NO      = #mngNo#
                              AND MNG_CNT     = #mngCnt#
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamAssetRentSttusInqireDao.selectAssetRentFileListTotCnt_S" parameterClass="gamAssetRentSttusInqireVO" resultClass="int">
            SELECT COUNT(*) totcnt
              FROM ASSETS_RENT_PHOTO_F A
             WHERE PRT_AT_CODE = #prtAtCode#
               AND MNG_YEAR    = #mngYear#
               AND MNG_NO      = #mngNo#
               AND MNG_CNT     = #mngCnt#
    </select>
    
    <insert id="gamAssetRentSttusInqireDao.insertAssetRentFile_S">
        INSERT INTO ASSETS_RENT_PHOTO_F (
                                             PHOTO_SEQ
                                           , PHOTO_SJ
                                           , FILENM_PHYSICL
                                           , FILENM_LOGIC
                                           , SHOT_DT
                                           , REG_USR
                                           , REGIST_DT
                                           , PRT_AT_CODE
                                           , MNG_YEAR
                                           , MNG_NO
                                           , MNG_CNT
                                           , PHOTO_DESC
                                        ) 
                                 VALUES (
                                             (SELECT NVL(MAX(PHOTO_SEQ),0) + 1
                                                FROM ASSETS_RENT_PHOTO_F AF
                                                WHERE  PRT_AT_CODE = #prtAtCode#
                                                AND    MNG_YEAR    = #mngYear#
                                                AND    MNG_NO      = #mngNo#
                                                AND    MNG_CNT     = #mngCnt#)
                                           , #photoSj#
                                           , #filenmPhysicl#
                                           , #filenmLogic#
                                           , #shotDt#
                                           , #regUsr#
                                           , SYSDATE
                                           , #prtAtCode#
                                           , #mngYear#
                                           , #mngNo#
                                           , #mngCnt#
                                           , #photoDesc#
                                        ) 
    </insert>
    
    <delete id="gamAssetRentSttusInqireDao.deleteAssetRentPhotoSingle_S">
        DELETE FROM ASSETS_RENT_PHOTO_F
         WHERE PHOTO_SEQ   = #photoSeq#
           AND PRT_AT_CODE = #prtAtCode#
           AND MNG_YEAR    = #mngYear#
           AND MNG_NO      = #mngNo#
           AND MNG_CNT     = #mngCnt# 
    </delete>
    
</sqlMap>
