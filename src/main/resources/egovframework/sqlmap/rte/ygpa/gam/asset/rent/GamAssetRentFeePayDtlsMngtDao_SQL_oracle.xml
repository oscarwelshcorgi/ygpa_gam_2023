<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.asset.rent">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamAssetRentFeePayDtlsMngtVO" type="egovframework.rte.ygpa.gam.asset.rent.service.GamAssetRentFeePayDtlsMngtVO"/>

    <resultMap id="gamAssetRentFeePayDtlsMngtSumMap" class="gamAssetRentFeePayDtlsMngtVO">
        <result property="sumBillAmnt" column="SUM_BILL_AMNT" columnIndex="1" javaType="string" jdbcType="VARCHAR"/>
        <result property="sumRcvdAmnt" column="SUM_RCVD_AMNT" columnIndex="2" javaType="string" jdbcType="VARCHAR"/>
        <result property="dpTotCnt" column="DP_TOT_CNT" columnIndex="3" javaType="string" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="gamAssetRentFeePayDtlsMngtDao.selectAssetRentFeePayDtlsList_D" parameterClass="gamAssetRentFeePayDtlsMngtVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT
E.PRT_AT_CODE,
      E.FEE_TP,
      E.FISCAL_YR,
      E.BILL_NO,
      E.BZ_RGST_ID,
      E.SSN,
      E.RCVD_TP,
      E.BILL_DT,
      E.DUE_DATE,
      E.RCVD_DT,
      E.BILL_PRT_YN,
      E.VSSL_KEY,
      E.BILL_AMNT,
      E.AMNT_RSN,
      E.AGENT_NAME,
      E.UPDT_UID,
      E.UPDT_DATE,
      E.SALIMI_NO,
      E.AGENT_CODE,
      E.DC_CODE,
      E.DC_RATE,
      E.ACCNT_CODE,
      E.ICHE_STATUS,
      E.RSLT_CODE,
      E.IO_TP,
      E.EXMP_AMNT,
      E.OVER_AMNT,
      E.DC_AMNT,
      E.RECPT_EPDT,
      E.POST_BILL_YN,
      E.NOPAY_LOSS_REAS_CD,
      E.ELCT_BILL_RSLT,
      E.BULL_INFO_INQR_DTIME,
      E.LAST,
      E.FIRST_BILL_DT,
      E.RCVD_NM,
      E.VAT_YN,
      E.VAT,
      E.STR_DATE,
      E.END_DATE,
      E.CALL_LETTER,
      E.CNV_YN
					        FROM  REV_COLL_F@YGPA_PORTMIS E
					             ,LEV_REQEST_F L
					       WHERE E.PRT_AT_CODE=L.PRT_AT_CODE
					       	AND E.FISCAL_YR = L.ACCNUT_YEAR
					       	AND E.FEE_TP = L.CHRGE_KND
					       	AND E.BILL_NO = L.NTICNO
					       <isNotEmpty property="sPrtAtCode">
			                   AND L.PRT_AT_CODE = #sPrtAtCode#
			               </isNotEmpty>
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>

    <select id="gamAssetRentFeePayDtlsMngtDao.selectAssetRentFeePayDtlsListTotCnt_S" parameterClass="gamAssetRentFeePayDtlsMngtVO" resultClass="int">
            SELECT COUNT(*) totcnt
              FROM  REV_COLL_F@YGPA_PORTMIS E
                   ,LEV_REQEST_F L
		       WHERE E.PRT_AT_CODE=L.PRT_AT_CODE
		       	AND E.FISCAL_YR = L.ACCNUT_YEAR
		       	AND E.FEE_TP = L.CHRGE_KND
		       	AND E.BILL_NO = L.NTICNO
		       <isNotEmpty property="sPrtAtCode">
                   AND L.PRT_AT_CODE = #sPrtAtCode#
               </isNotEmpty>
    </select>


    <select id="gamAssetRentFeePayDtlsMngtDao.selectAssetRentFeePayDtlsMngtSum_S" parameterClass="gamAssetRentFeePayDtlsMngtVO" resultMap="gamAssetRentFeePayDtlsMngtSumMap">
            SELECT

            	TRIM(TO_CHAR(COUNT(*), '999,999,999,999')) AS DP_TOT_CNT
            	,TRIM(TO_CHAR(NVL(SUM(E.BILL_AMNT),0), '999,999,999,999')) AS SUM_BILL_AMNT
            	,TRIM(TO_CHAR(NVL(SUM(CASE WHEN E.RCVD_TP = 2 OR E.RCVD_TP = 3 THEN E.BILL_AMNT END),0), '999,999,999,999')) AS SUM_RCVD_AMNT

              FROM  ERP_REV_COLL_F@YGPA_PORTMIS E
                   ,LEV_REQEST_F L
             WHERE E.BILL_NO = L.NTICNO

             <isNotEmpty property="sPrtAtCode">
                 AND L.PRT_AT_CODE = #sPrtAtCode#
             </isNotEmpty>
    </select>

</sqlMap>
