<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="ygpa.gam.mngFee">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltsMngFeeMngVo" type="egovframework.rte.ygpa.gam.mngFee.service.GamFcltsMngFeeMngVo"/>
    <typeAlias alias="gamFcltsMngFeeMngDetailVo" type="egovframework.rte.ygpa.gam.mngFee.service.GamFcltsMngFeeMngDetailVo"/>

    <select id="gamFcltsMngFeeMngDao.selectFcltsMngFeeMngList_D" parameterClass="gamFcltsMngFeeMngVo" resultClass="egovMap">
     SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                            SELECT
									MNG_MT,
									MNG_FEE_JOB_SE,
									MNG_FEE_SJ,
									FCLTY_MNG_FEE,
									ELCTY_FEE,
									WATER_FEE,
									GAS_FEE,
									ENV_FEE,
									MNG_TOTAL_FEE,
									REG_USR,
									UPD_USR,
									TO_CHAR(UPDT_DT, 'YYYY-MM-DD') UPDT_DT,
									TO_CHAR(REGIST_DT, 'YYYY-MM-DD') REGIST_DT
					        FROM FCLTS_MNG_FEE_F
								  WHERE 1=1
						         <isNotEmpty property="sMngMtYear">
						             AND MNG_MT LIKE '%' || #sMngMtYear# || #sMngMtMon# ||'%'
						         </isNotEmpty>

						         <isNotEmpty property="sMngFeeJobSe">
							         AND MNG_FEE_JOB_SE =  #sMngFeeJobSe#
							     </isNotEmpty>
                             ORDER BY MNG_MT
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>

    <select id="gamFcltsMngFeeMngDao.selectFcltsMngFeeMngListTotCnt_S" parameterClass="gamFcltsMngFeeMngVo" resultClass="int">
         SELECT COUNT(*) totcnt
              FROM FCLTS_MNG_FEE_F
                           <![CDATA[  WHERE 1=1 ]]>
	         <isNotEmpty property="sMngMtYear">
	             AND MNG_MT LIKE '%' || #sMngMtYear# || #sMngMtMon# ||'%'
	         </isNotEmpty>

	         <isNotEmpty property="sMngFeeJobSe">
		         AND MNG_FEE_JOB_SE =  #sMngFeeJobSe#
		     </isNotEmpty>
    </select>

	<insert id="gamFcltsMngFeeMngDao.insertFcltsMngFeeMng">
		<![CDATA[
		    INSERT
		      INTO  FCLTS_MNG_FEE_F
		         (
		         	 MNG_MT
					,MNG_FEE_JOB_SE
					,MNG_FEE_SJ
					,FCLTY_MNG_FEE
					,ELCTY_FEE
					,WATER_FEE
					,GAS_FEE
					,ENV_FEE
					,MNG_TOTAL_FEE
					,REG_USR
					,REGIST_DT
		         )
		    VALUES
		         (
		         		#mngMt#
						,#mngFeeJobSe#
						,#mngFeeSj#
						,REPLACE(#fcltyMngFee#,',','')
						,REPLACE(#elctyFee#,',','')
						,REPLACE(#waterFee#,',','')
						,REPLACE(#gasFee#,',','')
						,REPLACE(#envFee#,',','')
						,REPLACE(#mngTotalFee#,',','')
						,#regUsr#
						,sysdate
		         )
		]]>
	</insert>

	<insert id="gamFcltsMngFeeMngDao.insertFcltsMngFeeMngDetail">
		<![CDATA[
		    INSERT
		      INTO  FCLTS_MNG_FEE_DETAIL_F
		         (
		         	 MNG_MT
					,MNG_FEE_JOB_SE
					,ENTRPSCD
					,MNG_FEE
					,ELCTY_FEE
					,WATER_FEE
					,GAS_FEE
					,MNG_TOTAL_FEE
					,REG_USR
					,USAGE_AR
					,REGIST_DT
		         )
		    VALUES
		         (
		         		#mngMt#
						,REPLACE(#mngFeeJobSe#,',','')
						,REPLACE(#entrpscd#,',','')
						,REPLACE(#mngFee#,',','')
						,REPLACE(#elctyFee#,',','')
						,REPLACE(#waterFee#,',','')
						,REPLACE(#gasFee#,',','')
						,REPLACE(#mngTotalFee#,',','')
						,REPLACE(#regUsr#,',','')
						,REPLACE(#usageAr#,',','')
						,sysdate
		         )
		]]>
	</insert>

	<update id="gamFcltsMngFeeMngDao.updateFcltsMngFeeMng">
		<![CDATA[
            UPDATE FCLTS_MNG_FEE_F SET
					 MNG_FEE_SJ         =	#mngFeeSj#
					,FCLTY_MNG_FEE      =	REPLACE(#fcltyMngFee#,',','')
					,ELCTY_FEE          =	REPLACE(#elctyFee#,',','')
					,WATER_FEE          =	REPLACE(#waterFee#,',','')
					,GAS_FEE            =	REPLACE(#gasFee#,',','')
					,ENV_FEE            =	REPLACE(#envFee#,',','')
					,MNG_TOTAL_FEE      =	REPLACE(#mngTotalFee#,',','')
					,UPD_USR            =	#updUsr#
					,UPDT_DT            =	sysdate
					WHERE   MNG_MT     		 = #mngMt#
					AND		MNG_FEE_JOB_SE	 = #mngFeeJobSe#
		]]>
	</update>

	<update id="gamFcltsMngFeeMngDao.updateFcltsMngFeeMngDetail">
		<![CDATA[
            UPDATE FCLTS_MNG_FEE_DETAIL_F SET
					 MNG_FEE        	 =	REPLACE(#mngFee#,',','')
					,ELCTY_FEE          =	REPLACE(#elctyFee#,',','')
					,WATER_FEE          =	REPLACE(#waterFee#,',','')
					,GAS_FEE            =	REPLACE(#gasFee#,',','')
					,MNG_TOTAL_FEE      =	REPLACE(#mngTotalFee#,',','')
					,USAGE_AR    		=	REPLACE(#usageAr#,',','')
					,UPD_USR            =	#updUsr#
					,UPDT_DT            =	sysdate
					WHERE   MNG_MT     		 = #mngMt#
					AND		MNG_FEE_JOB_SE	 = #mngFeeJobSe#
					AND		ENTRPSCD	 	 = #entrpscd#
		]]>
	</update>

	<delete id="gamFcltsMngFeeMngDao.deleteFcltsMngFeeMngDetail">
		<![CDATA[
            DELETE  FCLTS_REL_CTRT_MNG_F
         		    WHERE   MNG_MT     		 = #mngMt#
					AND		MNG_FEE_JOB_SE	 = #mngFeeJobSe#
					AND		ENTRPSCD	 	 = #entrpscd#
		]]>
	</delete>

	<select id="gamFcltsMngFeeMngDao.selectFcltsMngFeeMngDetailList_D" parameterClass="gamFcltsMngFeeMngDetailVo" resultClass="egovMap">
                           SELECT
									 MNG_MT
									,MNG_FEE_JOB_SE
									,ENTRPSCD
									,MNG_FEE
									,ELCTY_FEE
									,WATER_FEE
									,GAS_FEE
									,MNG_TOTAL_FEE
									,REG_USR
									,USAGE_AR
									,TO_CHAR(REGIST_DT, 'YYYY-MM-DD') REGIST_DT
					        FROM FCLTS_MNG_FEE_DETAIL_F
								  WHERE 1=1
						         <isNotEmpty property="mngMt">
						         <![CDATA[AND MNG_MT = #mngMt#]]>
						         </isNotEmpty>

						         <isNotEmpty property="mngFeeJobSe">
							       <![CDATA[AND MNG_FEE_JOB_SE =  #mngFeeJobSe#]]>
							     </isNotEmpty>

						         <isNotEmpty property="entrpscd">
							      <![CDATA[AND ENTRPSCD =  #entrpscd#]]>
							     </isNotEmpty>
                             ORDER BY REGIST_DT
    </select>


   </sqlMap>