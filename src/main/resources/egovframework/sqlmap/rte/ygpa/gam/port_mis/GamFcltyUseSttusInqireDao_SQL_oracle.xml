<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.port_mis">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyUseSttusInqireVO" type="egovframework.rte.ygpa.gam.port_mis.service.GamFcltyUseSttusInqireVO"/>
	
	<select id="gamFcltyUseSttusInqireDao.selectFcltyUseSttusInqireList_D" parameterClass="gamFcltyUseSttusInqireVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT 
							T1.PRT_AT_CODE
							,TO_CHAR(TO_DATE(T1.PRCT_DT,'yyyymmdd'), 'YYYY-MM-DD') AS PRCT_DT
							,T1.FAC_CODE||T1.FAC_SUB_CODE AS FAC_CODE
							,T1.FEE_TP
							,NVL(T1.BILL_AMNT,0) AS BILL_AMNT 
							,NVL(T1.EXMP_AMNT,0) AS EXMP_AMNT 
							,NVL(T1.DC_AMNT,0) AS DC_AMNT 
							,T4.PRT_KOR_NM
							,T3.FEE_TP_KOR_NM
							,T2.FAC_KOR_NM
						FROM 
							P2MGR.PORT_PRODUCTION_FEE@YGPA_P2MGR T1
						LEFT OUTER JOIN 
							P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
						ON 
							(
							T1.PRT_AT_CODE=T4.PRT_AT_CODE
							)
						LEFT OUTER JOIN 
							PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
						ON 
							(
							T1.PRT_AT_CODE=T3.PRT_AT_CODE 
							AND T1.FEE_TP=T3.FEE_TP
							)
						LEFT OUTER JOIN 
							P2MGR.FACIL_NM_F@YGPA_P2MGR T2 
						ON 
							(
							T1.PRT_AT_CODE=T2.PRT_AT_CODE 
							AND T1.FAC_CODE=T2.FAC_CODE 
							AND T1.FAC_SUB_CODE=T2.FAC_SUB_CODE
							)
						WHERE 1 = 1 
						
						<isNotEmpty property="prtAtCode">
		                    AND T1.PRT_AT_CODE = #prtAtCode#
		                </isNotEmpty>
		                
		                <isNotEmpty property="sGrUsagePdFrom">
	                  		<![CDATA[AND T1.PRCT_DT >= #sGrUsagePdFrom#]]>
	                  		<isNotEmpty property="sGrUsagePdTo">
	                  			<![CDATA[AND T1.PRCT_DT <= #sGrUsagePdTo#]]>
	                  		</isNotEmpty>
	                  	</isNotEmpty>
	                  	
	                  	<isNotEmpty property="fac_code">
		                    AND T1.FAC_CODE = #fac_code#                    
		                </isNotEmpty>
		                
		                <isNotEmpty property="fac_sub_code">
		                    AND T1.FAC_SUB_CODE = #fac_sub_code#
		                </isNotEmpty>
		                
		                <isNotEmpty property="chrgeKndCd">
		                    AND T1.FEE_TP = #chrgeKndCd#
		                </isNotEmpty>
						
						ORDER BY T1.PRT_AT_CODE DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>

    </select>
    
    <select id="gamFcltyUseSttusInqireDao.selectFcltyUseSttusInqireListTotCnt_S" parameterClass="gamFcltyUseSttusInqireVO" resultClass="int">
            SELECT 
            	COUNT(*) TOTCNT
            FROM 
				P2MGR.PORT_PRODUCTION_FEE@YGPA_P2MGR T1
			LEFT OUTER JOIN 
				P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
			ON 
				(
				T1.PRT_AT_CODE=T4.PRT_AT_CODE
				)
			LEFT OUTER JOIN 
				PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
			ON 
				(
				T1.PRT_AT_CODE=T3.PRT_AT_CODE 
				AND T1.FEE_TP=T3.FEE_TP
				)
			LEFT OUTER JOIN 
				P2MGR.FACIL_NM_F@YGPA_P2MGR T2 
			ON 
				(
				T1.PRT_AT_CODE=T2.PRT_AT_CODE 
				AND T1.FAC_CODE=T2.FAC_CODE 
				AND T1.FAC_SUB_CODE=T2.FAC_SUB_CODE
				)
			WHERE 1 = 1 
			
			<isNotEmpty property="prtAtCode">
                   AND T1.PRT_AT_CODE = #prtAtCode#
               </isNotEmpty>
               
               <isNotEmpty property="sGrUsagePdFrom">
                		<![CDATA[AND T1.PRCT_DT >= #sGrUsagePdFrom#]]>
                		<isNotEmpty property="sGrUsagePdTo">
                			<![CDATA[AND T1.PRCT_DT <= #sGrUsagePdTo#]]>
                		</isNotEmpty>
                	</isNotEmpty>
                	
                	<isNotEmpty property="fac_code">
                   AND T1.FAC_CODE = #fac_code#                    
               </isNotEmpty>
               
               <isNotEmpty property="fac_sub_code">
                   AND T1.FAC_SUB_CODE = #fac_sub_code#
               </isNotEmpty>
               
               <isNotEmpty property="chrgeKndCd">
                   AND T1.FEE_TP = #chrgeKndCd#
               </isNotEmpty>
    </select>

</sqlMap>
