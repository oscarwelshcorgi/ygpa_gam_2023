<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ygpa.gam.fcltyMng">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyRepairHistInqireVO" type="egovframework.rte.ygpa.gam.fcltyMng.service.GamFcltyRepairHistInqireVO"/>
    
    <!-- 하자보수내역 -->
	<select id="gamFcltyRepairHistInqireDao.selectFcltyRepairHistInqireList_D" parameterClass="gamFcltyRepairHistInqireVO" resultClass="egovMap">
        SELECT A.*
           FROM (
                SELECT ROWNUM RNUM, S.*
                	FROM (
						SELECT
							TO_CHAR(F.FLAW_RPR_START_DT,'YYYY-MM-DD') FLAW_RPR_START_DT
							, TO_CHAR(F.FLAW_RPR_END_DT,'YYYY-MM-DD') FLAW_RPR_END_DT
							, F.FLAW_RPR_AMT
							, F.FLAW_RPR_CONTENTS
							, F.FLAW_RPR_ENTRPS_NM
							, F.FLAW_RPR_TY
							, TO_CHAR(F.FLAW_OCCRRNC_DT,'YYYY-MM-DD') FLAW_OCCRRNC_DT
							, F.FLAW_RPR_COMPT_YN
							, F.FLAW_EXAM_SE
							, F.ENFORCE_YEAR
							, F.FLAW_RPR_NM
							, F.FCLTS_MNG_GROUP_NO
							, F.FCLTS_JOB_SE
							, F.FLAW_RPR_SEQ
							, TO_CHAR(F.FLAW_EXAM_DT,'YYYY-MM-DD') FLAW_EXAM_DT
							, F.FLAW_ENNC
							, F.FLAW_EXAM_RESULT
							, F.RM
							, F.CTRT_NO
							, O.FCLTS_MNG_NO
							, G.PRT_FCLTY_NM
						FROM
							FLAW_RPR_OBJ_FCLTS_F O, FLAW_RPR_DTLS_F F, GIS_PRT_FCLTY_CD_F G
						WHERE 
							O.FCLTS_MNG_GROUP_NO = F.FCLTS_MNG_GROUP_NO
							AND O.FCLTS_MNG_NO = G.FCLTS_MNG_NO
							
						<isNotEmpty property="sFcltsMngNo">
	           				AND G.FCLTS_MNG_NO = #sFcltsMngNo#
	           			</isNotEmpty>
	           			
	           			<isNotEmpty property="sFlawRprEntrpsNm">
	           				AND F.FLAW_RPR_ENTRPS_NM LIKE '%' || #sFlawRprEntrpsNm# || '%'
	           			</isNotEmpty>
	           			
	           			<isNotEmpty property="sFlawRprStartDtFr">
	           				AND 
	           				(
	           					<![CDATA[ F.FLAW_EXAM_DT >= #sFlawRprStartDtFr# ]]>
	           				<isNotEmpty property="sFlawRprStartDtTo">
		           				<![CDATA[ AND F.FLAW_EXAM_DT <= #sFlawRprStartDtTo# ]]>
		           			</isNotEmpty>
		           			)
	           			</isNotEmpty>
	           			
						ORDER BY
							F.FLAW_RPR_START_DT DESC
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>		
	</select>

	<select id="gamFcltyRepairHistInqireDao.selectFcltyRepairHistInqireListTotCnt_S" parameterClass="gamFcltyRepairHistInqireVO" resultClass="int">
		SELECT
			COUNT(*) TOT_CNT
		FROM
			FLAW_RPR_OBJ_FCLTS_F O, FLAW_RPR_DTLS_F F, GIS_PRT_FCLTY_CD_F G
		WHERE
			O.FCLTS_MNG_GROUP_NO = F.FCLTS_MNG_GROUP_NO
			AND O.FCLTS_MNG_NO = G.FCLTS_MNG_NO
		<isNotEmpty property="sFcltsMngNo">
			AND G.FCLTS_MNG_NO = #sFcltsMngNo#
		</isNotEmpty>
	           			
		<isNotEmpty property="sFlawRprEntrpsNm">
			AND F.FLAW_RPR_ENTRPS_NM LIKE '%' || #sFlawRprEntrpsNm# || '%'
		</isNotEmpty>
	           			
		<isNotEmpty property="sFlawRprStartDtFr">
			AND 
			(
				<![CDATA[ F.FLAW_EXAM_DT >= #sFlawRprStartDtFr# ]]>
			<isNotEmpty property="sFlawRprStartDtTo">
				<![CDATA[ AND F.FLAW_EXAM_DT <= #sFlawRprStartDtTo# ]]>
			</isNotEmpty>
			)
		</isNotEmpty>
		
	</select>
	
	
	
	
	<select id="gamFcltyRepairHistInqireDao.selectFcltyRepairHistInqireDetail_S" parameterClass="gamFcltyRepairHistInqireVO" resultClass="egovMap">
		SELECT
			TO_CHAR(F.FLAW_RPR_START_DT,'YYYY-MM-DD') FLAW_RPR_START_DT
			, TO_CHAR(F.FLAW_RPR_END_DT,'YYYY-MM-DD') FLAW_RPR_END_DT
			, F.FLAW_RPR_AMT
			, F.FLAW_RPR_CONTENTS
			, F.FLAW_RPR_ENTRPS_NM
			, F.FLAW_RPR_TY
			, TO_CHAR(F.FLAW_OCCRRNC_DT,'YYYY-MM-DD') FLAW_OCCRRNC_DT
			, F.FLAW_RPR_COMPT_YN
			, F.FLAW_EXAM_SE
			, F.ENFORCE_YEAR
			, F.FLAW_RPR_NM
			, F.FCLTS_MNG_GROUP_NO
			, F.FCLTS_JOB_SE
			, F.FLAW_RPR_SEQ
			, TO_CHAR(F.FLAW_EXAM_DT,'YYYY-MM-DD') FLAW_EXAM_DT
			, F.FLAW_ENNC
			, F.FLAW_EXAM_RESULT
			, F.RM
			, F.CTRT_NO
			, O.FCLTS_MNG_NO
			, G.PRT_FCLTY_NM
		FROM
			FLAW_RPR_DTLS_F F, GIS_PRT_FCLTY_CD_F G, FLAW_RPR_OBJ_FCLTS_F O
		WHERE 
			F.FCLTS_MNG_GROUP_NO = G.FCLTS_MNG_GROUP_NO
			AND G.FCLTS_MNG_NO = O.FCLTS_MNG_NO
			AND F.FCLTS_JOB_SE = #fcltsJobSe#
			AND F.FCLTS_MNG_GROUP_NO = #fcltsMngGroupNo#
			AND F.FLAW_RPR_SEQ = TO_NUMBER(#flawRprSeq#)
			AND O.FCLTS_MNG_NO = #fcltsMngNo#
	</select>
	
	
	

</sqlMap>