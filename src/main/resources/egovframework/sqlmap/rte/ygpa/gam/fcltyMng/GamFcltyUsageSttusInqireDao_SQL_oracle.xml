<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="ygpa.gam.fcltyMng">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="GamFcltyUsageSttusInqireVO" type="egovframework.rte.ygpa.gam.fcltyMng.service.GamFcltyUsageSttusInqireVO"/>

<!-- GIS 항만시설 목록 조회 -->
	<select id="gamFcltyUsageSttusInqireDao.selectFcltyGisPrtFcltyCdList" parameterClass="GamFcltyUsageSttusInqireVO" resultClass="egovMap">
		SELECT A.*
		  FROM (
		      SELECT ROWNUM RNUM, S.*
		        FROM (
					SELECT M.GIS_ASSETS_PRT_AT_CODE AS GIS_ASSETS_PRT_AT_CODE
					      ,M.GIS_ASSETS_CD AS GIS_ASSETS_CD
					      ,M.GIS_ASSETS_SUB_CD AS GIS_ASSETS_SUB_CD
					      ,M.GIS_ASSETS_PRT_AT_CODE||'-'||M.GIS_ASSETS_CD||'-'||M.GIS_ASSETS_SUB_CD AS GIS_ASSETS
					      ,NVL(D.CODE_NM, '') AS PRT_FCLTY_SE
					      ,M.PRT_FCLTY_NM AS PRT_FCLTY_NM
					      ,M.PRT_FCLTY_STNDRD AS PRT_FCLTY_STNDRD
					      ,M.PRT_FCLTY_UNIT AS PRT_FCLTY_UNIT
					      ,TO_CHAR(M.PRT_FCLTY_INSTL_DT, 'YYYY.MM.DD') AS PRT_FCLTY_INSTL_DT
					      ,TO_CHAR(M.PRT_FCLTY_CHANGE_DT, 'YYYY.MM.DD') AS PRT_FCLTY_CHANGE_DT
					      ,GAM_GETENTRPSNM(M.PRT_FCLTY_MNG_ENTRPS_CD,'1') AS PRT_FCLTY_MNG_ENTRPS
					      ,TO_CHAR(M.PRT_FCLTY_EXPR_DT, 'YYYY.MM.DD') AS PRT_FCLTY_EXPR_DT
					      ,M.PRT_PRT_FCLTY_CNT AS PRT_PRT_FCLTY_CNT
					      ,M.PRT_PRT_FCLTY_MNGER AS PRT_PRT_FCLTY_MNGER
					      ,M.FCLTS_MNG_GROUP_NO AS FCLTS_MNG_GROUP_NO
					  FROM GIS_PRT_FCLTY_CD_F M LEFT OUTER JOIN
					       COMTCCMMNDETAILCODE D ON (D.CODE = M.PRT_FCLTY_SE)
					 WHERE D.CODE_ID = 'GAM003'
					<isNotEmpty property="sPrtAtCode" prepend="AND">
						   M.GIS_ASSETS_PRT_AT_CODE = #sPrtAtCode#
					</isNotEmpty>
					<isNotEmpty property="sFcltsJobSe" prepend="AND">
						   D.CODE_NM like '%'||#sFcltsJobSe#||'%'
					</isNotEmpty>

<!--		              SELECT GIS_ASSETS_PRT_AT_CODE AS GIS_ASSETS_PRT_AT_CODE
		              		,GIS_ASSETS_CD AS GIS_ASSETS_CD
		              		,GIS_ASSETS_SUB_CD AS GIS_ASSETS_SUB_CD
		              		,GIS_ASSETS_PRT_AT_CODE||'-'||GIS_ASSETS_CD||'-'||GIS_ASSETS_SUB_CD AS GIS_ASSETS
		                    ,GAM_GETCODENAME('GAM003', PRT_FCLTY_SE) AS PRT_FCLTY_SE
		                    ,PRT_FCLTY_NM AS PRT_FCLTY_NM
		                    ,PRT_FCLTY_STNDRD AS PRT_FCLTY_STNDRD
		                    ,PRT_FCLTY_UNIT AS PRT_FCLTY_UNIT
		                    ,TO_CHAR(PRT_FCLTY_INSTL_DT, 'YYYY.MM.DD') AS PRT_FCLTY_INSTL_DT
		                    ,TO_CHAR(PRT_FCLTY_CHANGE_DT, 'YYYY.MM.DD') AS PRT_FCLTY_CHANGE_DT
		                    ,GAM_GETENTRPSNM(PRT_FCLTY_MNG_ENTRPS_CD,'1') AS PRT_FCLTY_MNG_ENTRPS
		                    ,TO_CHAR(PRT_FCLTY_EXPR_DT, 'YYYY.MM.DD') AS PRT_FCLTY_EXPR_DT
		                    ,PRT_PRT_FCLTY_CNT AS PRT_PRT_FCLTY_CNT
		                    ,PRT_PRT_FCLTY_MNGER AS PRT_PRT_FCLTY_MNGER
		                    ,FCLTS_MNG_GROUP_NO AS FCLTS_MNG_GROUP_NO
		                FROM GIS_PRT_FCLTY_CD_F
 -->
		             ) S
		        ) A

	</select>

	<select id="gamFcltyUsageSttusInqireDao.selectFcltyGisPrtFcltyCdListTotCnt" parameterClass="GamFcltyUsageSttusInqireVo" resultClass="int">
		SELECT COUNT(*) totcnt
	      FROM GIS_PRT_FCLTY_CD_F

	</select>

<!-- 시설물 사용현황 목록 조회 -->
    <select id="gamFcltyUsageSttusInqireDao.selectFcltyAssetsRentList" parameterClass="GamFcltyUsageSttusInqireVO" resultClass="egovMap">
		SELECT A.*
			FROM (
				SELECT  ROWNUM RNUM, S.*
					FROM (
							SELECT GAM_GETCODENAME('GAM019', D.PRT_AT_CODE) AS PRT_AT_CODE
				         		  , D.MNG_YEAR||'-'||D.MNG_NO||'-'||D.MNG_CNT AS MNG_YEAR_NO
								  , D.GIS_ASSETS_PRT_AT_CODE ||'-'|| D.GIS_ASSETS_CD||'-'||D.GIS_ASSETS_SUB_CD AS GIS_ASSETS
								  , M.DOC_NO AS DOC_NO
								  , GAM_GETCODENAME('GAM008', M.NTIC_MTH) AS NTIC_MTH
								  , D.USAGE_PURPS AS USAGE_PURPS
								  , D.USAGE_DTLS AS USAGE_DTLS
								  , D.USAGE_AR AS USAGE_AR
								  , D.FEE AS FEE
								  , TO_CHAR(M.PRMISN_DT,'YYYY.MM.DD') AS PRMISN_DT
						     FROM ASSETS_RENT_DETAIL_F D, ASSETS_RENT_F M
						    WHERE 1=1
						  		  AND D.GIS_ASSETS_PRT_AT_CODE = #gisAssetsPrtAtCode#
		           				  AND D.GIS_ASSETS_CD = #gisAssetsCd#
		           				  AND D.GIS_ASSETS_SUB_CD = #gisAssetsSubCd#

						  		  AND D.PRT_AT_CODE = M.PRT_AT_CODE
								  AND D.MNG_YEAR = M.MNG_YEAR
								  AND D.MNG_NO = M.MNG_NO
								  AND D.MNG_CNT = M.MNG_CNT

								  ORDER BY D.PRT_AT_CODE DESC, D.MNG_YEAR DESC, D.MNG_NO, D.MNG_CNT

					) S
			) A
		<![CDATA[
		WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex#
		]]>

    </select>

	<select id="gamFcltyUsageSttusInqireDao.selectFcltyAssetsRentListTotCnt" parameterClass="GamFcltyUsageSttusInqireVO" resultClass="int">
		SELECT COUNT(*) totcnt
	      FROM ASSETS_RENT_DETAIL_F D, ASSETS_RENT_F M
	     WHERE 1=1
			   AND D.GIS_ASSETS_PRT_AT_CODE = #gisAssetsPrtAtCode#
     		   AND D.GIS_ASSETS_CD = #gisAssetsCd#
     		   AND D.GIS_ASSETS_SUB_CD = #gisAssetsSubCd#

	  		   AND D.PRT_AT_CODE = M.PRT_AT_CODE
			   AND D.MNG_YEAR = M.MNG_YEAR
			   AND D.MNG_NO = M.MNG_NO
			   AND D.MNG_CNT = M.MNG_CNT

	</select>

<!-- 점검 관리 내역, 점검 관리 대상 시설물 -->

	<select id="gamFcltyUsageSttusInqireDao.selectQcMngList" parameterClass="GamFcltyUsageSttusInqireVO" resultClass="egovMap">
		SELECT A.*
			FROM (
				SELECT  ROWNUM RNUM, S.*
				  FROM (
		                SELECT FCLTS_MNG_GROUP_NO
							  ,GAM_GET_FCLTS_JOB_SE_NM(FCLTS_JOB_SE) AS FCLTS_JOB_SE
						      ,QC_MNG_SEQ
						      ,ENFORCE_YEAR
						      ,QC_MNG_NM
						      ,TO_CHAR(QC_INSP_DT, 'YYYY.MM.DD') AS QC_INSP_DT
						      ,QC_INSP_SE
						      ,QC_INSP_INSTT_NM
						      ,RESPON_ENGINEER_NM
						      ,TO_CHAR(QC_BEGIN_DT, 'YYYY.MM.DD') AS QC_BEGIN_DT
						      ,TO_CHAR(QC_END_DT, 'YYYY.MM.DD') AS QC_END_DT
						      ,QC_INSP_AMT
						      ,GAM_GET_STTUS_EVL_LVL_NM(STTUS_EVL_LVL) AS STTUS_EVL_LVL
						      ,QC_INSP_RESULT
						      ,ACTION_CN
						      ,RM
		                  FROM QC_MNG_DTLS_F
 					) S
				) A
	</select>
<!-- 점검 관리 대상 시설물 -->
	<select id="gamFcltyUsageSttusInqireDao.selectQcMngDetailList" parameterClass="GamFcltyUsageSttusInqireVO" resultClass="egovMap">
		SELECT A.*
			FROM (
				SELECT  ROWNUM RNUM, S.*
				  FROM (
		              SELECT M.FCLTS_MNG_NO
		                    ,GAM_GET_STTUS_EVL_LVL_NM(M.STTUS_EVL_LVL) AS STTUS_EVL_LVL
		                    ,TO_CHAR(M.QC_INSP_DT,'YYYY.MM.DD') AS QC_INSP_DT
		                    ,M.INSPECTOR
		                    ,M.QC_INSP_RESULT
		                    ,M.RM
		                    ,S.QC_ITEM_CD
		                    ,S.SEQ
		                    ,S.INSP_RESULT_CHK
		                    ,S.INSP_RESULT_CN
		               FROM QC_MNG_OBJ_FCLTS_F M LEFT OUTER JOIN
		               		QC_MNG_RESULT_ITEM_F S ON (M.FCLTS_MNG_GROUP_NO = S.FCLTS_MNG_GROUP_NO
		                AND M.FCLTS_JOB_SE = S.FCLTS_JOB_SE
		                AND M.QC_MNG_SEQ = S.QC_MNG_SEQ)
<!--
					  WHERE
		                AND M.FCLTS_MNG_GROUP_NO = #fcltsMngGroupNo#
		                AND M.FCLTS_JOB_SE = #fcltsJobSe#
		                AND M.QC_MNG_SEQ = #qcMngSeq#
-->
              		) S
         		 ) A
	</select>
</sqlMap>

<!--
	<resultMap id="GamFcltyUsageMngMap" class="egov framework.rte.ygpa.gam.ctrt.service.GamFcltyUsageSttusInqireVO">
		<result property="prtAtCode" column="PRT_AT_CODE" columnIndex="1" />
		<result property="mngYearNo" column="MNG_YEAR_NO" columnIndex="2" />
		<result property="gisAssets" column="GIS_ASSETS" columnIndex="3" />
		<result property="docNo" column="DOC_NO" columnIndex="4" />
		<result property="nticMth" column="NTIC_MTH" columnIndex="5" />
		<result property="usagePurps" column="USAGE_PURPS" columnIndex="6" />
		<result property="usageDtls" column="USAGE_DTLS" columnIndex="7" />
		<result property="usageAr" column="USAGE_AR" columnIndex="8" />
		<result property="fee" column="FRR" columnIndex="9" />
		<result property="prmisnDt" column="PRMISN_DT" columnIndex="10" />
	</resultMap>
 -->

<!-- GIS 항만 시설코드
SELECT GIS_ASSETS_PRT_AT_CODE||'-'||GIS_ASSETS_CD||'-'||GIS_ASSETS_SUB_CD AS GIS_ASSETS
      ,GAM_GETCODENAME('GAM003', PRT_FCLTY_SE) AS PRT_FCLTY_SE
      ,PRT_FCLTY_NM AS PRT_FCLTY_NM
      ,PRT_FCLTY_STNDRD AS PRT_FCLTY_STNDRD
      ,PRT_FCLTY_UNIT AS PRT_FCLTY_UNIT
      ,TO_CHAR(PRT_FCLTY_INSTL_DT, 'YYYY.MM.DD') AS PRT_FCLTY_INSTL_DT
      ,TO_CHAR(PRT_FCLTY_CHANGE_DT, 'YYYY.MM.DD') AS PRT_FCLTY_CHANGE_DT
      ,GAM_GETENTRPSNM(PRT_FCLTY_MNG_ENTRPS_CD,'1') AS PRT_FCLTY_MNG_ENTRPS
      ,TO_CHAR(PRT_FCLTY_EXPR_DT, 'YYYY.MM.DD') AS PRT_FCLTY_EXPR_DT
      ,PRT_PRT_FCLTY_CNT AS PRT_PRT_FCLTY_CNT
      ,PRT_PRT_FCLTY_MNGER AS PRT_PRT_FCLTY_MNGER
      ,FCLTS_MNG_GROUP_NO AS FCLTS_MNG_GROUP_NO
  FROM GIS_PRT_FCLTY_CD_F
 WHERE PRT_FCLTY_STNDRD IS NOT NULL

 -->