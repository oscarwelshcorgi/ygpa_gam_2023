<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="rte.ygpa.gam.cmmn.fclty">

  <typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
  <typeAlias alias="hashMap" type="java.util.HashMap"/>

  <select id="gamNticRequestMngtDAO.selectLevRequestByPk_S" parameterClass="hashMap" resultClass="egovMap">
    SELECT
      NTIC_CNT,
      PRT_AT_CODE,
      MNG_YEAR,
      MNG_NO,
      MNG_CNT,
      CHRGE_KND,
      FCLTY_SE,
      ENTRPSCD,
      ENTRPS_NM,
      NTIC_PD_FROM,
      NTIC_PD_TO,
      ACCNUT_YEAR,
      NTICNO,
      NTIC_DT,
      PAY_TMLMT,
      SANCTN_STTUS,
      SANCTNER_EMPL_NO,
      SANCTN_DT,
      OLNLP,
      FEE,
      VAT_YN,
      VAT,
      NTIC_AMT,
      RM,
      RCIV_SE,
      RCIV_DT,
      NHT_ISUE_YN,
      ARRRG_NO,
      ARRRG_AMT,
      REQEST_SEQ,
      DEPTCD,
      NTIC_MTH,
      NHT_PRINT_YN,
      REG_USR,
      REGIST_DT,
      UPD_USR,
      UPDT_DT
      FROM LEV_REQEST_PD_BY_STATS_F
      WHERE  PRT_AT_CODE=#prtAtCode#
        AND MNG_YEAR=#mngYear#
        AND MNG_NO=#mngNo#
        AND MNG_CNT=#mngCnt#
        AND NTIC_CNT=#nticCnt#
        AND CHRGE_KND=#chrgeKnd#
  </select>

  <select id="gamNticRequestMngtDAO.selectLevRequestList_D" parameterClass="hashMap" resultClass="egovMap">
    SELECT
      NTIC_CNT,
      PRT_AT_CODE,
      MNG_YEAR,
      MNG_NO,
      MNG_CNT,
      CHRGE_KND,
      FCLTY_SE,
      ENTRPSCD,
      ENTRPS_NM,
      NTIC_PD_FROM,
      NTIC_PD_TO,
      ACCNUT_YEAR,
      NTICNO,
      NTIC_DT,
      PAY_TMLMT,
      SANCTN_STTUS,
      SANCTNER_EMPL_NO,
      SANCTN_DT,
      OLNLP,
      FEE,
      VAT_YN,
      VAT,
      NTIC_AMT,
      RM,
      RCIV_SE,
      RCIV_DT,
      NHT_ISUE_YN,
      ARRRG_NO,
      ARRRG_AMT,
      REQEST_SEQ,
      DEPTCD,
      NTIC_MTH,
      NHT_PRINT_YN,
      REG_USR,
      REGIST_DT,
      UPD_USR,
      UPDT_DT
      FROM LEV_REQEST_PD_BY_STATS_F
      WHERE  PRT_AT_CODE=#prtAtCode#
        AND MNG_YEAR=#mngYear#
        AND MNG_NO=#mngNo#
        AND MNG_CNT=#mngCnt#
        AND NTIC_CNT=#nticCnt#
        <isNotEmpty prepend="AND" property="chrgeKnd">
          CHRGE_KND=#chrgeKnd#
        </isNotEmpty>
  </select>

    <insert id="gamNticRequestMngtDAO.insertNticRequestRevCollF" parameterClass="hashMap" >
        INSERT INTO REV_COLL_F (
      PRT_AT_CODE,
      FEE_TP,
      WORK_CODE,
      FISCAL_YR, BILL_NO,
      AGENT_CODE, BZ_RGST_ID, AGENT_NAME, SSN,
      BILL_DT, DUE_DATE, BILL_PRT_YN,
      BILL_AMNT, EXMP_AMNT, OVER_AMNT, DC_AMNT,
		RCVD_TP,
      UPDT_UID, UPDT_DATE, FIRST_BILL_DT, VAT_YN, VAT, STR_DATE, END_DATE,
      DEPT,USER_NAME
      )
        SELECT
      L.PRT_AT_CODE,
      GAM_GET_FEE_TP(#chrgeKnd#) FEE_TP,
      GAM_GET_WORK_CODE(#prtAtCode#, #mngYear#, #mngNo#, #mngCnt#, #nticCnt#, #chrgeKnd#)  WORK_CODE,
      #accnutYear# FISCAL_YR, #nticno# BILL_NO,
      L.ENTRPSCD,
      (SELECT BIZRNO FROM ENTRPS_INFO_F E WHERE L.ENTRPSCD=ENTRPSCD) BZ_RGST_ID,
      (SELECT ENTRPS_NM FROM ENTRPS_INFO_F E WHERE L.ENTRPSCD=ENTRPSCD) AGENT_NAME,
      '' SSN,
      SYSDATE, TO_DATE(NVL(#payTmlmt#, TO_CHAR(SYSDATE+15, 'YYYY-MM-DD')), 'YYYY-MM-DD'), L.NHT_PRINT_YN,
      L.FEE, L.RDCXPT_FEE, 0, 0,
		'0',
      #updUsr#, SYSDATE, SYSDATE, L.VAT_YN, L.VAT, L.NTIC_PD_FROM, L.NTIC_PD_TO,
      #deptCd#,
      #userName#
      FROM LEV_REQEST_F L
      WHERE PRT_AT_CODE=#prtAtCode#
      	AND MNG_YEAR=#mngYear#
      	AND MNG_NO=#mngNo#
      	AND MNG_CNT=#mngCnt#
      	AND NTIC_CNT=#nticCnt#
      	AND CHRGE_KND=#chrgeKnd#
    </insert>

    <insert id="gamNticRequestMngtDAO.insertNticRequestRevCollFC1" parameterClass="hashMap" >
        INSERT INTO UNPAID_F (
      PRT_AT_CODE, FEE_TP, FISCAL_YR, BILL_NO,
      DLY_SER_NO, DLY_BILL_AMNT, DLY_BILL_DT, DLY_DUE_DT, DLY_RCVD_DT, DLY_BILL_PRT_YN, DLY_RCVD_TP,
      FIRST_BILL_DT, DBILL_AMNT,
      BZ_RGST_ID, DLY_BILL_RSN,UPDT_UID,UPDT_DATE, AGENT_CODE,
      ACCNT_CODE,ICHE_STATUS,POST_BILL_YN,STR_DATE,END_DATE,
      DEPT
      )
      SELECT
              L.PRT_AT_CODE, L.CHRGE_KND, L.ACCNUT_YEAR, L.NTICNO,
      (SELECT LPAD(NVL(MAX(DLY_SER_NO), 0)+1, 2, '0') FROM UNPAID_F WHERE PRT_AT_CODE=L.PRT_AT_CODE
      	AND FEE_TP=L.CHRGE_KND AND FISCAL_YR=L.ACCNUT_YEAR AND BILL_NO=L.NTICNO) DLY_BILL_NO,
      	L.ARRRG_AMT, SYSDATE, TO_DATE(#newPayTmlmt#, 'YYYY-MM-DD') PAY_TMLMT, null, 'N', '1',
      	L.NTIC_DT, L.ARRRG_AMT,
      	(SELECT BZ_RGST_ID FROM P2MGR.SHP_OWOP_F@YGPA_P2MGR WHERE AGENT_CODE=L.ENTRPSCD),
      	'(' || TO_CHAR(L.NTIC_AMT, '999,999,999,999') || '*' || TO_CHAR(L.ARRRG_TARIFF, '999,999,999,999') || '*' || TO_CHAR(L.ARRRG_PAY_DATES,'9,999') || '/365' || ')',
      	#updUSr#, SYSDATE, L.ENTRPSCD, '194', 'N', 'N',TO_CHAR(L.NTIC_PD_FROM,'YYYYMMDD'),TO_CHAR(L.NTIC_PD_TO,'YYYYMMDD'),
      	#deptCd#
      FROM LEV_REQEST_F L
      WHERE PRT_AT_CODE=#prtAtCode#
      	AND MNG_YEAR=#mngYear#
      	AND MNG_NO=#mngNo#
      	AND MNG_CNT=#mngCnt#
      	AND NTIC_CNT=#nticCnt#
      	AND CHRGE_KND=#chrgeKnd#
    </insert>

    <delete id="gamNticRequestMngtDAO.removeNticRequestRevCollFC1" parameterClass="hashMap" >
            DELETE FROM UNPAID_F WHERE FEE_TP='C1' AND (PRT_AT_CODE, FISCAL_YR, BILL_NO) IN
     (
     	SELECT
              PRT_AT_CODE, ACCNUT_YEAR, NTICNO
		FROM LEV_REQEST_F
      	WHERE PRT_AT_CODE=#prtAtCode#
	      	AND MNG_YEAR=#mngYear#
	      	AND MNG_NO=#mngNo#
	      	AND MNG_CNT=#mngCnt#
	      	AND NTIC_CNT=#nticCnt#
      	)
    </delete>

      <select id="gamNticRequestMngtDAO.selectNticNoAccnutYear_S" parameterClass="hashMap" resultClass="egovMap">
		SELECT LPAD(NVL(MAX(BILL_NO), 0) + 1, 6, '0') NTICNO,
		       TO_CHAR(SYSDATE, 'YYYY') ACCNUT_YEAR
		FROM REV_COLL_F
		WHERE PRT_AT_CODE = #prtAtCode# AND FEE_TP = GAM_GET_FEE_TP(#chrgeKnd#) AND FISCAL_YR = TO_CHAR(SYSDATE, 'YYYY')
		</select>


      <select id="gamNticRequestMngtDAO.selectNticRequestRcvdTp_S" parameterClass="hashMap" resultClass="egovMap">
		SELECT BILL_NO,
				RCVD_TP,
		       RCVD_DT,
		       BILL_PRT_YN
		FROM REV_COLL_F P,
				(
					SELECT PRT_AT_CODE, ACCNUT_YEAR, NTICNO, CHRGE_KND
					FROM LEV_REQEST_F
					WHERE PRT_AT_CODE=#prtAtCode# AND MNG_YEAR=#mngYear# AND MNG_NO=#mngNo# AND MNG_CNT=#mngCnt# AND NTIC_CNT=#nticCnt# AND CHRGE_KND=#chrgeKnd#
				) L
		WHERE P.PRT_AT_CODE = L.PRT_AT_CODE
			AND P.FISCAL_YR=L.ACCNUT_YEAR
			AND P.FEE_TP = GAM_GET_FEE_TP(L.CHRGE_KND)
			AND BILL_NO=L.NTICNO
		</select>

      <delete id="gamNticRequestMngtDAO.deleteNticRequestRevCollF">
        DELETE FROM REV_COLL_F P
			WHERE EXISTS (
				SELECT '1' FROM (SELECT PRT_AT_CODE, CHRGE_KND, ACCNUT_YEAR, NTICNO
					FROM LEV_REQEST_F
					WHERE PRT_AT_CODE=#prtAtCode# AND MNG_YEAR=#mngYear# AND MNG_NO=#mngNo# AND MNG_CNT=#mngCnt# AND NTIC_CNT=#nticCnt# AND CHRGE_KND=#chrgeKnd#
					) L
				WHERE P.PRT_AT_CODE = L.PRT_AT_CODE
					AND P.FEE_TP = GAM_GET_FEE_TP(L.CHRGE_KND)
					AND P.FISCAL_YR = L.ACCNUT_YEAR
					AND P.BILL_NO=L.NTICNO
					)
    </delete>

    <update id="gamNticRequestMngtDAO.updateLevReqestArrrgAmt" parameterClass="hashMap">
        UPDATE LEV_REQEST_F SET
        	PAY_TMLMT=TO_DATE(#newPayTmlmt#, 'YYYY-MM-DD'),
      		ARRRG_NO=(SELECT NVL(ARRRG_NO,0)+1 FROM LEV_REQEST_F WHERE PRT_AT_CODE=#prtAtCode#
		      	AND MNG_YEAR=#mngYear#
		      	AND MNG_NO=#mngNo#
		      	AND MNG_CNT=#mngCnt#
		      	AND NTIC_CNT=#nticCnt#
		        AND CHRGE_KND=#chrgeKnd#),
      		ARRRG_AMT=TO_NUMBER(#arrrgAmt#),
      		ARRRG_TARIFF=TO_NUMBER(#arrrgTariff#)/100,
      		ARRRG_PAY_DATES=TO_NUMBER(#arrrgPayDates#),
      		UPD_USR=#updUsr#,
      		UPDT_DT=SYSDATE
     	WHERE
			PRT_AT_CODE=#prtAtCode#
	      	AND MNG_YEAR=#mngYear#
	      	AND MNG_NO=#mngNo#
	      	AND MNG_CNT=#mngCnt#
	      	AND NTIC_CNT=#nticCnt#
	      	AND CHRGE_KND=#chrgeKnd#
  </update>

    <update id="gamNticRequestMngtDAO.updateLevReqestIssueYn" parameterClass="hashMap">
        UPDATE LEV_REQEST_F SET
      		NHT_ISUE_YN=#nhtIsueYn#,
      		NTICNO=#nticno#,
      		ACCNUT_YEAR=#accnutYear#,
      		NHT_PRINT_YN = #nhtPrintYn#
       <isNotEmpty prepend="," property="payTmlmt">
       		PAY_TMLMT=#payTmlmt#
     	</isNotEmpty>
       <isEqual prepend="," property="nhtIsueYn" compareValue="Y">
       		NTIC_DT=SYSDATE
     	</isEqual>
       <isNotEqual prepend="," property="nhtIsueYn" compareValue="Y">
       		NTIC_DT=''
     	</isNotEqual>
     	WHERE
			PRT_AT_CODE=#prtAtCode#
	      	AND MNG_YEAR=#mngYear#
	      	AND MNG_NO=#mngNo#
	      	AND MNG_CNT=#mngCnt#
	      	AND NTIC_CNT=#nticCnt#
	      	AND CHRGE_KND=#chrgeKnd#
  </update>

  <update id="gamNticRequestMngtDAO.updateLevReqestNhtPrintYn" parameterClass="hashMap">
        UPDATE LEV_REQEST_F SET
      		NHT_PRINT_YN=#nhtPrintYn#
      		WHERE
			PRT_AT_CODE=#prtAtCode#
      	AND MNG_YEAR=#mngYear#
      	AND MNG_NO=#mngNo#
      	AND MNG_CNT=#mngCnt#
      	AND NTIC_CNT=#nticCnt#
	    AND CHRGE_KND=#chrgeKnd#
      	<!-- AND CHRGE_KND=#chrgeKnd# -->
  </update>

  <update id="gamNticRequestMngtDAO.updateRevCollFBillPrintYn" parameterClass="hashMap">
        UPDATE REV_COLL_F SET
      		BILL_PRT_YN=#nhtPrintYn#
      		WHERE
	      		PRT_AT_CODE=#prtAtCode#
	      		AND FEE_TP=GAM_GET_FEE_TP(#chrgeKnd#)
	      		AND FISCAL_YR=(SELECT ACCNUT_YEAR FROM LEV_REQEST_F WHERE PRT_AT_CODE=#prtAtCode#
			      	AND MNG_YEAR=#mngYear#
			      	AND MNG_NO=#mngNo#
			      	AND MNG_CNT=#mngCnt#
			      	AND NTIC_CNT=#nticCnt#
			      	AND CHRGE_KND=#chrgeKnd#)
	     		AND BILL_NO=(SELECT NTICNO FROM LEV_REQEST_F WHERE PRT_AT_CODE=#prtAtCode#
			      	AND MNG_YEAR=#mngYear#
			      	AND MNG_NO=#mngNo#
			      	AND MNG_CNT=#mngCnt#
			      	AND NTIC_CNT=#nticCnt#
			      	AND CHRGE_KND=#chrgeKnd#)
  </update>

  <delete id="gamNticRequestMngtDAO.deleteAssetsUsagePdByStats_D" parameterClass="hashMap">
    <![CDATA[
      DELETE FROM USAGE_PD_BY_STATS_F
      WHERE PRT_AT_CODE=#prtAtCode#
        AND MNG_YEAR=#mngYear#
        AND MNG_NO=#mngNo#
        AND MNG_CNT=#mngCnt#
    ]]>
  </delete>

      <insert id="gamNticRequestMngtDAO.insertLevReqestPdByStats">
    <![CDATA[
        INSERT INTO LEV_REQEST_PD_BY_STATS_F (
      NTIC_YEAR,
      NTIC_QU,
      NTIC_MT,
      NTIC_CNT,
      PRT_AT_CODE,
      MNG_YEAR,
      MNG_NO,
      MNG_CNT,
      CHRGE_KND,
      ENTRPSCD,
      ACCNUT_YEAR,
      NTICNO,
      NTIC_DT,
      NTIC_PD_FROM,
      NTIC_PD_TO,
      FEE,
      RDCXPT_FEE,
      DEPTCD,
      REG_USR,
      REGIST_DT,
      UPD_USR,
      UPDT_DT
    )
    SELECT
    TO_CHAR(START_DATE, 'YYYY'),
    DECODE(TO_CHAR(START_DATE, 'MM'),'01','1','02','1','03','1','04','2','05','2','06','2','07','3','08','3', '09','3','4'),
     TO_CHAR(START_DATE, 'MM'),
     LPAD(NTIC_CNT, 2, '0'),
    #prtAtCode#, #mngYear#, #mngNo#, #mngCnt#, FEE_TP, #entrpscd# ENTRPSCD, ACCNUT_YEAR,
    NTICNO,NTIC_DT,NTIC_PD_FROM,NTIC_PD_TO,
    RNTFEE,
    0,
    #deptcd#,
    #regUsr#,
    #registDt#,
    #updUsr#, SYSDATE
    from (
      SELECT A.FEE_TP, NTIC_CNT, DECODE(A.FEE_TP, #chrgeKnd#, RNTFEE, 'A3', TRUNC(REFE*(RATE_DAY)/365*A.RATE, -1)) RNTFEE, REFE, START_DATE, PREV_DUE_DATE, DUE_DATE, END_DATE
      FROM (
      SELECT #chrgeKnd# FEE_TP, 1 RATE FROM dual
      UNION ALL SELECT 'A3', TO_NUMBER(#payinstIntrrate#, '0.0000') FROM dual
      ) A, (
      SELECT ROWNUM                                                                                                                                                     AS NTIC_CNT,
          TRUNC(#fee#                                                                    / (TRUNC(MONTHS_BETWEEN(TO_DATE(#nticPdTo#,'YYYY-MM-DD'), TO_DATE(#nticPdFrom#,'YYYY-MM-DD')) / 1)+1), -1)                          AS RNTFEE,
          TRUNC(#fee#                                                                    - ((#fee#/(TRUNC(MONTHS_BETWEEN(TO_DATE(#nticPdTo#,'YYYY-MM-DD'), TO_DATE(#nticPdFrom#,'YYYY-MM-DD')) / 1)+1)) * (ROWNUM-1)), -1) AS REFE,
          ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1                      * (ROWNUM-1))                                                                                                                                     AS START_DATE,
          DECODE(ROWNUM, 1, 0, ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1 * (ROWNUM-1))-ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1 * (ROWNUM-1)-1))                                                        AS RATE_DAY,
          LAG(ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1                  * (ROWNUM-1))+14) OVER (ORDER BY ROWNUM)                                                                                                          AS PREV_DUE_DATE,
          ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1                      * (ROWNUM-1))+14                                                                                                                                  AS DUE_DATE,
          (
          CASE
            WHEN TO_DATE(#nticPdTo#,'YYYY-MM-DD') < ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1 * ROWNUM) - 1
            THEN TO_DATE(#nticPdTo#,'YYYY-MM-DD')
            ELSE ADD_MONTHS(TO_DATE(#nticPdFrom#,'YYYY-MM-DD'), 1 * ROWNUM) - 1
          END ) AS END_DATE
        FROM COMTCCMMNDETAILCODE
        WHERE ROWNUM <= (TRUNC(MONTHS_BETWEEN(TO_DATE(#nticPdTo#,'YYYY-MM-DD'), TO_DATE(#nticPdFrom#,'YYYY-MM-DD')) / 1)+1)
         ) B
    )
    WHERE RNTFEE<>0
    ]]>

    </insert>

  <delete id="gamNticRequestMngtDAO.deleteLevReqestPdByStats" parameterClass="hashMap">
    <![CDATA[
      DELETE FROM LEV_REQEST_PD_BY_STATS_F
      WHERE PRT_AT_CODE=#prtAtCode#
        AND MNG_YEAR=#mngYear#
        AND MNG_NO=#mngNo#
        AND MNG_CNT=#mngCnt#
	    AND CHRGE_KND=#chrgeKnd#
    ]]>
  </delete>

    <select id="gamNticRequestMngtDAO.selectRevCollF" parameterClass="map" resultClass="egovMap">
        /*+ gamNticRequestMngtDAO.selectRevCollF */
        /* [전자고지] 고지 정보 조회 eunsungj */
        SELECT
			R.PRT_AT_CODE,
			R.FEE_TP,
			R.FISCAL_YR,
			R.BILL_NO,
			R.VSSL_KEY,
			R.YR,
			R.SER_NO,
			R.ACCNT_CODE,
			R.AGENT_CODE,
			R.BILL_AMNT,
			R.BILL_AMNT_R3,
			R.BILL_AMNT_R2,
			R.BILL_AMNT_R1,
			TO_CHAR(R.BILL_DT, 'YYYYMMDD') BILL_DT,
			R.BILL_PRT_YN,
			R.AMNT_RSN,
			R.SSN,
			TO_CHAR(R.DUE_DATE, 'YYYYMMDD') DUE_DATE,
			TO_CHAR(R.FIRST_BILL_DT, 'YYYYMMDD') FIRST_BILL_DT,
			R.ICHE_STATUS,
			R.BZ_RGST_ID,
			R.AGENT_NAME,
			R.IO_TP,
			TO_CHAR(R.RCVD_DT, 'YYYYMMDD') RCVD_DT,
			R.RCVD_TP,
			R.RSLT_CODE,
			R.VSSL_KOR_NM,
			TO_CHAR(R.UPDT_DATE, 'YYYYMMDD') UPDT_DATE,
			R.UPDT_UID,
			R.EXMP_AMNT,
			R.OVER_AMNT,
			R.SALIMI_NO,
			TO_CHAR(R.IO_DT, 'YYYYMMDD') IO_DT,
			R.DC_AMNT,
			R.DC_CODE,
			R.DC_RATE,
			R.RCVD_NM,
			TO_CHAR(R.RECPT_EPDT, 'YYYYMMDD') RECPT_EPDT,
			R.POST_BILL_YN,
			R.NOPAY_LOSS_REAS_CD,
			R.ELCT_BILL_RSLT,
			TO_CHAR(R.BULL_INFO_INQR_DTIME, 'YYYYMMDD') BULL_INFO_INQR_DTIME,
			R.LAST,
			R.VAT,
			R.VAT_YN,
			R.JINGSUJA,
			R.JIRO_RCVD_TP,
			R.JIRO_RCVD_BR,
			R.COMMISSION,
			R.MAGAM_FLAG,
			TO_CHAR(R.OCR_DT, 'YYYYMMDD') OCR_DT,
			R.DEPT,
			R.EMPL,
			R.WORK_CODE,
			R.ORIGIN_FEE_TP,
			R.ORIGIN_FISCAL_YR,
			R.ORIGIN_BILL_NO,
			R.CYBER_VAT,
			R.VACCT_NO,
			TO_CHAR(R.END_DATE, 'YYYYMMDD') END_DATE,
			R.FAC_CODE,
			R.FAC_SUB_CODE,
			TO_CHAR(R.STR_DATE, 'YYYYMMDD') STR_DATE,
			R.CALL_LETTER,
			R.CNV_YN,
			R.INPUT_YN,
			R.FINAL_FLAG,
			R.RESPONSE_DESC1,
			R.RESPONSE_DESC2,
			R.LOGIS_CONFIRM_NAME,
			R.LOGIS_SEND_YN,
			R.SENDING_COUNT,
			R.BILL_COUNT,
			R.RCVD_COUNT,
			R.TAX_CODE,
			R.TAX_MODIFY_CODE,
			R.VAT1,
			R.VAT2,
			R.VAT3,
			R.SMALL_BILL_NO_INFO,
			R.SMALL_BILL_NO,
			R.SMALL_FISCAL_YR,
			R.SMALL_BILL_YN,
			R.BILL_AMNT_BF,
			R.USER_NAME
        FROM REV_COLL_F R, LEV_REQEST_F L
        WHERE 1=1
          AND L.PRT_AT_CODE=#prtAtCode#
          AND L.MNG_YEAR=#mngYear#
          AND L.MNG_NO=#mngNo#
          AND L.MNG_CNT=#mngCnt#
          AND L.NTIC_CNT=#nticCnt#
          AND L.CHRGE_KND=#chrgeKnd#
          AND R.PRT_AT_CODE = L.PRT_AT_CODE
          AND R.FEE_TP = GAM_GET_FEE_TP(L.CHRGE_KND)
          AND R.FISCAL_YR = L.ACCNUT_YEAR
          AND R.BILL_NO = L.NTICNO
          <!--
          AND R.DLY_SER_NO = L.ARRRG_NO
 			-->
    </select>

      <insert id="gamNticRequestMngtDAO.insertEgiroPrint" parameterClass="map">
        /* gamNticRequestMngtDAO.insertEgiroPrint */
        /* 전자고지 체계 구축 고지출력 kang (EGIRO) */
        INSERT INTO PAYEOSU.EGIRO@YGPA_PORTMIS (
           PRT_AT_CODE
         , TRANID
         , WORK_DT
         , PRINT_DT
         , CANCEL_DT
         , EGIRO_TYPE
         , DATA_TYPE
         , SEQ_NUM
         , CUSTOMER_NUM
         , AMOUNT
         , AMOUNT_AF
         , DATA_FORMAT
         , DUE_DATE
         , CLOSE_DATE
         , GIRO_NUM
         , EGIRO_NUM
         , AGENT_CODE
         , BILL_TYPE
         , ETC_TYPE
         , KOR_NM
         , BZ_RGST_ID
         , BILL_YYYYMM
         , ADDR
         , RET_CODE
         , RCVD_SEQ
         , CHENAP_TIME
         , CHENAP_MM
         , ETC_COUNT
         , ETC_TITLE
         , ETC_TXT
         , SEND_YN
         , FEE_TP
         , FISCAL_YR
         , BILL_NO
         , DLY_SER_NO)
        VALUES (
           #prtAtCode#
         , TO_CHAR(SYSTIMESTAMP,'YYYYMMDDHH24MISSSSSFF')||RPAD(NVL(#prtAtCode#,' '),3)
         , TO_CHAR(SYSDATE, 'YYYYMMDD')
         , #printDt#
         , #cancelDt#
         , 'GR6533'
         , '22'
         , ''
         , #makedigit#
         , #amount#
         , #amouuntAf#
         , 'A'
         , #dueDate#
         , TO_CHAR(ADD_MONTHS(to_date(#closeDate#,'yyyymmdd'),1),'YYYYMMDD')
         , #giroNum#
         , #egiroNum#
         , #agentCode#
         , #billType#
         , '00'
         , #korNm#
         , #bzRgstId#
         , #billYyyymm#
         , #addr#
         , ' '
         , '0'
         , ''
         , ''
         , '00'
         , ''
         , ''
         , ''
         , #feeTp#
         , #fiscalYr#
         , #billNo#
         , #dlySerNo#
        )
    </insert>

    <update id="gamNticRequestMngtDAO.updateEgiroPrintCancel" parameterClass="map">
        /*+ ygpam.fdr.rev.mgt.updateEgiroPrintCancel */
        /* 전자고지 체계 구축 고지출력취소 kang */
        UPDATE PAYEOSU.EGIRO@YGPA_PORTMIS
        SET CANCEL_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
          , DUE_DATE = TO_CHAR(SYSDATE+1, 'YYYYMMDD')
        WHERE PRT_AT_CODE = #prtAtCode#
          AND FEE_TP      = #feeTp#
          AND FISCAL_YR   = #fiscalYr#
          AND BILL_NO     = #billNo#
          AND DLY_SER_NO  = #dlySerNo#
          AND TRANID	  = #tranId#
    </update>

    <select id="gamNticRequestMngtDAO.getWorkDtSysdateInfo" parameterClass="map" resultClass="egovMap">
        /*+ gamNticRequestMngtDAO.getEgiroAgentInfo */
        /* [전자고지] 당일고지발행했다가 취소하는 건인지 구분 kang */
        SELECT TRANID, WORK_DT, CANCEL_DT, PRINT_DT, TO_CHAR(SYSDATE, 'YYYYMMDD') CURR_DT
        FROM PAYEOSU.EGIRO@YGPA_PORTMIS
        WHERE PRT_AT_CODE = #prtAtCode#
          AND FEE_TP = #feeTp#
          AND FISCAL_YR = #fiscalYr#
          AND BILL_NO = #billNo#
          AND DLY_SER_NO = #dlySerNo#
          AND CANCEL_DT IS NULL
    </select>

    <select id="gamNticRequestMngtDAO.getEgiroAgentInfo" parameterClass="map" resultClass="egovMap">
        /*+ gamNticRequestMngtDAO.getEgiroAgentInfo */
        /* [전자고지] 업체의 대표자명, 주소를 찾아오는 쿼리 kang */
        SELECT e.rprsntv_nm KOR_NM, e.adres ADDR
		FROM REV_COLL_F R, ENTRPS_INFO_F E
		WHERE R.AGENT_CODE=e.entrpscd
          AND R.PRT_AT_CODE = #prtAtCode#
          AND R.FEE_TP      = #feeTp#
          AND R.FISCAL_YR   = #fiscalYr#
          AND R.BILL_NO     = #billNo#
          <!--
        SELECT DECODE(REV_COLL_F.AGENT_CODE,'XXX9999',SF_BILL_PRT_NM_KOR_PRT(REV_COLL_F.PRT_AT_CODE, NULL, 'XXX9999', NULL, CALL_LETTER), SHP_OWOP_F.KOR_NM) AS KOR_NM
             , DECODE(REV_COLL_F.AGENT_CODE,'XXX9999',SF_BILL_PRT_ADDR_KOR_PRT(REV_COLL_F.PRT_AT_CODE, NULL, 'XXX9999', NULL, CALL_LETTER), SHP_OWOP_F.ADDR) AS ADDR
        FROM PAYEOSU.REV_COLL_F, SHP_OWOP_F
        WHERE REV_COLL_F.AGENT_CODE = SHP_OWOP_F.AGENT_CODE
          AND REV_COLL_F.PRT_AT_CODE = #prtAtCode#
          AND REV_COLL_F.FEE_TP      = #feeTp#
          AND REV_COLL_F.FISCAL_YR   = #fiscalYr#
          AND REV_COLL_F.BILL_NO     = #billNo#
           -->
    </select>

    <select id="gamNticRequestMngtDAO.getEgiroFeeTpMap" parameterClass="map" resultClass="egovMap">
        /*+ gamNticRequestMngtDAO.getEgiroFeeTpMap */
        /* [전자고지] 요금종류코드(3자리) kang */
        SELECT FEE_TP_MAP
        FROM P2MGR.FEE_TP_F@YGPA_PORTMIS
        WHERE PRT_AT_CODE = #prtAtCode#
          AND FEE_TP = #feeTp#
    </select>

	<select id="gamNticRequestMngtDAO.getSfMakeDigit" parameterClass="map" resultClass="egovMap">
	        /*+ gamNticRequestMngtDAO.getSfMakeDigit */
	        select
	        SF_MAKEDIGIT( #prtAtCode# || TO_CHAR(ASCII(SUBSTR(#feeTp#,1,1))) || SUBSTR(#feeTp#,2,1) || #fiscalYr# || #billNo# || #customerNum#, 'BILLNO')
	        AS MAKEDIGIT
	        from dual
	    </select>


</sqlMap>

