<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.port_mis">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamCustTpSalesSttutsCreatVO" type="egovframework.rte.ygpa.gam.port_mis.service.GamCustTpSalesSttutsCreatVO"/>
	
	<procedure id="gamCustTpSalesSttutsCreatDao.createCustTpSalesSttuts" parameterClass="gamCustTpSalesSttutsCreatVO">
		
	</procedure>

	<select id="gamCustTpSalesSttutsCreatDao.selectPortMisCostvalStatsList_D" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           	SELECT 
                           		T1.PRTCD
                           		, T1.YRMT
                           		, MAX(T1.UPDT_DT)
                           		, COUNT(*)
  								FROM PORT_MIS_COSTVAL_STATS_F T1
  								GROUP BY T1.PRTCD, T1.YRMT
								HAVING 1 = 1 					       
					        		<isNotEmpty property="prtAtCode">
			                    		AND T1.PRTCD = #prtAtCode#
			                		</isNotEmpty>
					        		<isNotEmpty property="startYrMt">
			                    		AND T1.YRMT = #startYrMt#
			                		</isNotEmpty>
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>

    <select id="gamCustTpSalesSttutsCreatDao.selectPortMisCostvalStatsListTotCnt_S" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="int">
            SELECT 
            	COUNT(*) TOTCNT
            FROM (
                           	SELECT 
                           		T1.PRTCD
                           		, T1.YRMT
                           		, MAX(T1.UPDT_DT)
                           		, COUNT(*)
  								FROM PORT_MIS_COSTVAL_STATS_F T1
  								GROUP BY T1.PRTCD, T1.YRMT
								HAVING 1 = 1 					       
					        		<isNotEmpty property="prtAtCode">
			                    		AND T1.PRTCD = #prtAtCode#
			                		</isNotEmpty>
					        		<isNotEmpty property="startYrMt">
			                    		AND T1.YRMT = #startYrMt#
			                		</isNotEmpty>            
            )
    </select>
	
	<select id="gamCustTpSalesSttutsCreatDao.selectCustAgentSalesSttutsList_D" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           	SELECT 
                           		T1.PRTCD
                           		, T1.ENTRPSCD
                           		, T1.YRMT
                           		, T1.CHRGEKNDCD
                           		, T1.COSTVAL
                           		, T4.PRT_KOR_NM
                           		, T2.FIRM_KOR_NM
                           		, T3.FEE_TP_KOR_NM
  								FROM PORT_MIS_COSTVAL_STATS_F T1
								LEFT OUTER JOIN 
									P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
										ON (T1.PRTCD=T4.PRT_AT_CODE)
								LEFT OUTER JOIN 
									PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
										ON (T1.PRTCD=T3.PRT_AT_CODE AND T1.CHRGEKNDCD=T3.FEE_TP)
								LEFT OUTER JOIN 
									P2MGR.SHP_OWOP_F@YGPA_P2MGR T2 ON (T1.ENTRPSCD=T2.AGENT_CODE)
								WHERE 1 = 1 					       
					        		<isNotEmpty property="prtAtCode">
			                    		AND T1.PRTCD = #prtAtCode#
			                		</isNotEmpty>
					        		<isNotEmpty property="startYrMt">
			                    		<![CDATA[AND T1.YRMT >= #startYrMt#]]>
			                    		<isNotEmpty property="endYrMt">
			                    			<![CDATA[AND T1.YRMT <= #endYrMt#]]>
			                    		</isNotEmpty>
			                		</isNotEmpty>
					        		<isNotEmpty property="chrgeKndCd">
			                    		AND T1.CHRGEKNDCD = #chrgeKndCd#
			                		</isNotEmpty>
					        		<isNotEmpty property="entrpsCd">
			                    		AND T1.ENTRPSCD = #entrpsCd#
			                		</isNotEmpty>			                		
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamCustTpSalesSttutsCreatDao.selectCustAgentSalesSttutsListTotCnt_S" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="int">
            SELECT 
            	COUNT(*) TOTCNT
            FROM PORT_MIS_COSTVAL_STATS_F T1
				LEFT OUTER JOIN 
					P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
						ON (T1.PRTCD=T4.PRT_AT_CODE)
				LEFT OUTER JOIN 
					PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
						ON (T1.PRTCD=T3.PRT_AT_CODE AND T1.CHRGEKNDCD=T3.FEE_TP)
				LEFT OUTER JOIN 
					P2MGR.SHP_OWOP_F@YGPA_P2MGR T2 
						ON (T1.ENTRPSCD=T2.AGENT_CODE)
			WHERE 1 = 1 					       
				<isNotEmpty property="prtAtCode">
			    	AND T1.PRTCD = #prtAtCode#
			    </isNotEmpty>
				<isNotEmpty property="startYrMt">
			        <![CDATA[AND T1.YRMT >= #startYrMt#]]>
			    	<isNotEmpty property="endYrMt">
			        	<![CDATA[AND T1.YRMT <= #endYrMt#]]>
			    	</isNotEmpty>
			    </isNotEmpty>
				<isNotEmpty property="chrgeKndCd">
			        AND T1.CHRGEKNDCD = #chrgeKndCd#
			    </isNotEmpty>
				<isNotEmpty property="entrpsCd">
			       	AND T1.ENTRPSCD = #entrpsCd#
			    </isNotEmpty>			                		
    </select>

	<select id="gamCustTpSalesSttutsCreatDao.selectCustTpSalesSttutsList_D" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
						SELECT T1.PRTCD
							,T1.ENTRPSCD
							,T1.YRMT
							,T1.CHRGEKNDCD
							,T1.COSTVAL
							,T4.PRT_KOR_NM
							,T2.FIRM_KOR_NM
							,T3.FEE_TP_KOR_NM
  						FROM PORT_MIS_COSTVAL_STATS_F T1
							LEFT OUTER JOIN 
								P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
									ON (T1.PRTCD=T4.PRT_AT_CODE)
							LEFT OUTER JOIN 
								PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
									ON (T1.PRTCD=T3.PRT_AT_CODE AND T1.CHRGEKNDCD=T3.FEE_TP)
							LEFT OUTER JOIN 
								P2MGR.SHP_OWOP_F@YGPA_P2MGR T2 
									ON (T1.ENTRPSCD=T2.AGENT_CODE)
						WHERE 1 = 1 
					        <isNotEmpty property="prtAtCode">
			                    AND T1.PRTCD = #prtAtCode#
			                </isNotEmpty>
			                AND T1.ENTRPSCD IN (SELECT AGENT_CODE
                      								FROM P2MGR.SHP_OWOP_F@YGPA_P2MGR
                    								WHERE CSTMR_TP IN ('11','12','43')) 					       
					        <isNotEmpty property="startYrMt">
			                    <![CDATA[AND T1.YRMT >= #startYrMt#]]>
			                    <isNotEmpty property="endYrMt">
			                    	<![CDATA[AND T1.YRMT <= #endYrMt#]]>
			                    </isNotEmpty>
			                </isNotEmpty>
					        <isNotEmpty property="chrgeKndCd">
			                    AND T1.CHRGEKNDCD = #chrgeKndCd#
			                </isNotEmpty>
					        <isNotEmpty property="entrpsCd">
			                    AND T1.ENTRPSCD = #entrpsCd#
			                </isNotEmpty>			                		
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>
    
    <select id="gamCustTpSalesSttutsCreatDao.selectCustTpSalesSttutsListTotCnt_S" parameterClass="gamCustTpSalesSttutsCreatVO" resultClass="int">
            SELECT 
            	COUNT(*) TOTCNT
  						FROM PORT_MIS_COSTVAL_STATS_F T1
							LEFT OUTER JOIN 
								P2MGR.PRT_AT_CODE_F@YGPA_P2MGR T4 
									ON (T1.PRTCD=T4.PRT_AT_CODE)
							LEFT OUTER JOIN 
								PAYEOSU.FEE_TP_F@YGPA_PORTMIS T3 
									ON (T1.PRTCD=T3.PRT_AT_CODE AND T1.CHRGEKNDCD=T3.FEE_TP)
							LEFT OUTER JOIN 
								P2MGR.SHP_OWOP_F@YGPA_P2MGR T2 
									ON (T1.ENTRPSCD=T2.AGENT_CODE)
						WHERE 1 = 1 
					        <isNotEmpty property="prtAtCode">
			                    AND T1.PRTCD = #prtAtCode#
			                </isNotEmpty>
			                AND T1.ENTRPSCD IN (SELECT AGENT_CODE
                      								FROM P2MGR.SHP_OWOP_F@YGPA_P2MGR
                    								WHERE CSTMR_TP IN ('11','12','43')) 					       
					        <isNotEmpty property="startYrMt">
			                    <![CDATA[AND T1.YRMT >= #startYrMt#]]>
			                    <isNotEmpty property="endYrMt">
			                    	<![CDATA[AND T1.YRMT <= #endYrMt#]]>
			                    </isNotEmpty>
			                </isNotEmpty>
					        <isNotEmpty property="chrgeKndCd">
			                    AND T1.CHRGEKNDCD = #chrgeKndCd#
			                </isNotEmpty>
					        <isNotEmpty property="entrpsCd">
			                    AND T1.ENTRPSCD = #entrpsCd#
			                </isNotEmpty>			                		
    </select>

</sqlMap>
