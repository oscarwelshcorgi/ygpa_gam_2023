<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.asset.sts">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>

    <select id="gamGisAssetSttusInqireDao.selectGisAssetSttusAssetList_D" parameterClass="hashMap" resultClass="egovMap">
	SELECT Z.*
	FROM (
	SELECT ROWNUM RNUM, S.*
	FROM (
	SELECT
	G.GIS_ASSETS_SUB_CD
	, G.GIS_ASSETS_CD
	, G.GIS_ASSETS_NM
	, G.GIS_ASSETS_MNG_DEPT_CD
	, G.GIS_ASSETS_OPER_DEPT_CD
	, G.GIS_ASSETS_LOCPLC
	, G.GIS_ASSETS_LNM
	, G.GIS_ASSETS_LNM_SUB
	, G.GIS_ASSETS_PRT_AT_CODE
	, G.GIS_ASSETS_AR
	, G.GIS_ASSETS_USAGE_YN
	, G.GIS_ASSETS_ACQ_PRI
	, G.GIS_ASSETS_STNDRD
	, G.GIS_ASSETS_BLDDATE
	, TO_CHAR(G.GIS_ASSETS_BLD_DT, 'YYYY-MM-DD') GIS_ASSETS_BLD_DT
	, G.GIS_ASSETS_RM
	, G.REG_USR
	, TO_CHAR(G.REGISTDT, 'YYYY-MM-DD') REGISTDT
	, G.UPD_USR
	, TO_CHAR(G.UPDTDT, 'YYYY-MM-DD') UPDTDT
	, G.GIS_ASSETS_QUAY_GROUP_CD
	, G.GIS_ASSETS_LOC_CD
	, G.GIS_ASSETS_SE_CD
	, G.GIS_ASSETS_PRPRTY_SE_CD
	, G.GIS_ASSETS_INVSTMNT_MTHD
	, G.GIS_ASSETS_GIS_CD
	, G.GIS_ASSETS_REAL_RENT_AR
	, G.DRW_LST_REGIST_YEAR
	, G.DRW_LST_SEQ
	, G.GIS_ASSETS_VAL_AMT
	, TO_CHAR(G.GIS_ASSETS_VAL_INQIRE_DT, 'YYYY-MM-DD')
	GIS_ASSETS_VAL_INQIRE_DT
	, G.ERP_ASSETS_CLS
	, G.ERP_ASSETS_NO
	, G.ERP_ASSETS_NO_SEQ
	, G.ERP_ASSETS_DISUSE_REGIST_YN
	, G.ERP_ASSETS_DISUSE_RSN
	, G.GIS_ASSETS_QUAY_CD
	, C.USAGE_AR
	, C.FEE
	, C.RDCXPT_FEE
	, CASE
	WHEN NVL(C.USAGE_AR,0) > 0 AND NVL(G.GIS_ASSETS_AR,0) > 0
	THEN
	(NVL(C.USAGE_AR,0) / NVL(G.GIS_ASSETS_AR,0))
	ELSE
	0
	END USAGE_RATIO
	, TO_CHAR(C.USAGE_PD_FROM, 'YYYY-MM-DD') USAGE_PD_FROM
	, TO_CHAR(C.USAGE_PD_TO, 'YYYY-MM-DD') USAGE_PD_TO
	, C.PRT_AT_CODE
	, C.MNG_YEAR || '-' || C.MNG_NO || '-' || C.MNG_CNT AS RENT_MNG_NO
	, GAM_GETCODENAME('GAM019', C.PRT_AT_CODE) PRT_AT_CODE_NM
	, C.ENTRPSCD
	, GAM_GETENTRPSNM(C.ENTRPSCD, '1') ENTRPS_NM
	, NVL(C.GR_FEE,0) GR_FEE
	, NVL(C.GR_RDCXPT_FEE,0) GR_RDCXPT_FEE
	, (G.GIS_ASSETS_CD || '-' || G.GIS_ASSETS_SUB_CD) ASSETS_CD_STR
	, GAM_GETCODENAME('GAM001', G.GIS_ASSETS_PRPRTY_SE_CD)
	GIS_ASSETS_PRPRTY_SE_CD_NM
	, GAM_GETCODENAME('GAM002', G.GIS_ASSETS_LOC_CD) GIS_ASSETS_LOC_CD_NM
	, GAM_GETCODENAME('GAM003', G.GIS_ASSETS_QUAY_CD) GIS_ASSETS_QUAY_CD_NM
	, GAM_GETCODENAME('GAM007', C.USAGE_PRPOS_CD) USAGE_PRPOS_CD_NM
	FROM GIS_ASSETS_CD_F G LEFT OUTER JOIN
	(SELECT A.PRT_AT_CODE, A.MNG_YEAR, A.MNG_NO, A.MNG_CNT, MAX(A.ENTRPSCD) ENTRPSCD, MAX(A.GR_FEE) GR_FEE, MAX(A.GR_RDCXPT_FEE) GR_RDCXPT_FEE,
		MAX(B.GIS_ASSETS_PRT_AT_CODE) GIS_ASSETS_PRT_AT_CODE, MAX(B.GIS_ASSETS_CD) GIS_ASSETS_CD, MAX(B.GIS_ASSETS_SUB_CD) GIS_ASSETS_SUB_CD,
	SUM(B.USAGE_AR) USAGE_AR,SUM(B.FEE) FEE, SUM(B.RDCXPT_FEE) RDCXPT_FEE, SUM(B.USAGE_PRPOS_CD) USAGE_PRPOS_CD, MIN(B.USAGE_PD_FROM) USAGE_PD_FROM,
	MAX(B.USAGE_PD_TO) USAGE_PD_TO
	FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F B
	WHERE A.PRT_AT_CODE = B.PRT_AT_CODE
	AND A.MNG_YEAR = B.MNG_YEAR
	AND A.MNG_NO = B.MNG_NO
	AND A.MNG_CNT = B.MNG_CNT
		<isNotEmpty property="sUsagePdFrom" prepend="AND">
			A.GR_USAGE_PD_FROM <![CDATA[>=]]>
			TO_DATE(#sUsagePdFrom#,'yyyy-mm-dd')
		</isNotEmpty>

		<isNotEmpty property="sUsagePdTo" prepend="AND">
			A.GR_USAGE_PD_TO <![CDATA[<=]]>
			TO_DATE(#sUsagePdTo#,'yyyy-mm-dd')+1
		</isNotEmpty>
		group by A.PRT_AT_CODE, A.MNG_YEAR, A.MNG_NO, A.MNG_CNT
	) C
	ON C.GIS_ASSETS_PRT_AT_CODE = G.GIS_ASSETS_PRT_AT_CODE
							   AND C.GIS_ASSETS_CD          = G.GIS_ASSETS_CD
							   AND C.GIS_ASSETS_SUB_CD      = G.GIS_ASSETS_SUB_CD
	WHERE C.GIS_ASSETS_PRT_AT_CODE = G.GIS_ASSETS_PRT_AT_CODE
	AND C.GIS_ASSETS_CD = G.GIS_ASSETS_CD
	AND C.GIS_ASSETS_SUB_CD = G.GIS_ASSETS_SUB_CD
	<isNotEmpty property="sGisAssetsNm">
		AND G.GIS_ASSETS_NM LIKE '%' || #sGisAssetsNm# || '%'
	</isNotEmpty>
	<isNotEmpty property="sGisAssetsLocplc">
		AND G.GIS_ASSETS_LOCPLC LIKE '%' || #sGisAssetsLocplc# || '%'
	</isNotEmpty>
	<isNotEmpty property="sGisAssetsLnm">
		AND G.GIS_ASSETS_LNM = #sGisAssetsLnm#
	</isNotEmpty>
		<isNotEmpty property="sGisAssetsLnmSub">
		AND G.GIS_ASSETS_LNM_SUB = #sGisAssetsLnmSub#
	</isNotEmpty>
	ORDER BY G.GIS_ASSETS_PRT_AT_CODE, G.GIS_ASSETS_CD, G.GIS_ASSETS_SUB_CD
	) S
	) Z
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>
    </select>

    <select id="gamGisAssetSttusInqireDao.selectGisAssetSttusAssetDetailList_D" parameterClass="hashMap" resultClass="egovMap">
	    SELECT GIS_ASSETS_PRT_AT_CODE, GIS_ASSETS_CD, GIS_ASSETS_SUB_CD,
			USAGE_AR,FEE, RDCXPT_FEE, USAGE_PRPOS_CD, USAGE_PD_FROM,
			USAGE_PD_TO
		FROM ASSETS_RENT_DETAIL_F
		WHERE #prtAtCode# = PRT_AT_CODE
		AND #mngYear# = MNG_YEAR
		AND #mngNo# = MNG_NO
		AND #mngCnt# = MNG_CNT
	</select>

    <select id="gamGisAssetSttusInqireDao.selectGisAssetSttusAssetListTotCnt_S" parameterClass="hashMap" resultClass="int">
	SELECT COUNT(*) totcnt
	FROM GIS_ASSETS_CD_F G LEFT OUTER JOIN
	(SELECT A.*, B.GIS_ASSETS_PRT_AT_CODE, B.GIS_ASSETS_CD, B.GIS_ASSETS_SUB_CD,
	B.USAGE_AR,B.FEE, B.RDCXPT_FEE, B.USAGE_PRPOS_CD, B.USAGE_PD_FROM,
	B.USAGE_PD_TO
	FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F B
	WHERE A.PRT_AT_CODE = B.PRT_AT_CODE
	AND A.MNG_YEAR = B.MNG_YEAR
	AND A.MNG_NO = B.MNG_NO
	AND A.MNG_CNT = B.MNG_CNT
	<!--
	<isNotEmpty property="sUsagePdFrom" prepend="AND">
		A.GR_USAGE_PD_FROM <![CDATA[>=]]>
		TO_DATE(#sUsagePdFrom#,'yyyy-mm-dd')
	</isNotEmpty>

	<isNotEmpty property="sUsagePdTo" prepend="AND">
		A.GR_USAGE_PD_TO <![CDATA[<=]]>
		TO_DATE(#sUsagePdTo#,'yyyy-mm-dd')+1
	</isNotEmpty>
	 -->
	) C ON C.GIS_ASSETS_PRT_AT_CODE = G.GIS_ASSETS_PRT_AT_CODE
	AND C.GIS_ASSETS_CD = G.GIS_ASSETS_CD
	AND C.GIS_ASSETS_SUB_CD = G.GIS_ASSETS_SUB_CD
	WHERE 1=1
		<!--
	<isNotEmpty property="sPrtAtCode">
		AND G.PRT_AT_CODE = #sPrtAtCode#
	</isNotEmpty>
	<isNotEmpty property="sGisAssetsCd">
		AND G.GIS_ASSETS_CD = UPPER(#sGisAssetsCd#)
	</isNotEmpty>
	<isNotEmpty property="sGisAssetsSubCd">
		AND G.GIS_ASSETS_SUB_CD = #sGisAssetsSubCd#
	</isNotEmpty>
	 -->

    </select>

    <select id="gamGisAssetSttusInqireDao.selectGisAssetSttusAssetListTotSum_S" parameterClass="hashMap" resultClass="egovMap">
            SELECT
				     TRIM(TO_CHAR(NVL(COUNT(*),0), '999,999,999,999')) SUM_CNT
				   , TRIM(TO_CHAR(NVL(SUM(B.USAGE_AR),0), '999,999,999,999')) SUM_AR
				   , TRIM(TO_CHAR(NVL(SUM(B.FEE),0), '999,999,999,999')) SUM_FEE
				   , TRIM(TO_CHAR(NVL(SUM(B.RDCXPT_FEE),0), '999,999,999,999')) SUM_RDCXPT_FEE
              FROM ASSETS_RENT_F A
                 , ASSETS_RENT_DETAIL_F B
                 , GIS_ASSETS_CD_F G
             WHERE A.PRT_AT_CODE = B.PRT_AT_CODE
               AND A.MNG_YEAR    = B.MNG_YEAR
               AND A.MNG_NO      = B.MNG_NO
               AND A.MNG_CNT     = B.MNG_CNT
               AND B.GIS_ASSETS_PRT_AT_CODE = G.GIS_ASSETS_PRT_AT_CODE
               AND B.GIS_ASSETS_CD          = G.GIS_ASSETS_CD
               AND B.GIS_ASSETS_SUB_CD      = G.GIS_ASSETS_SUB_CD

<!--
               <isNotEmpty property="sPrtAtCode">
                   AND A.PRT_AT_CODE = #sPrtAtCode#
               </isNotEmpty>

               <isNotEmpty property="sGisAssetsCd">
                   AND G.GIS_ASSETS_CD = UPPER(#sGisAssetsCd#)
               </isNotEmpty>

               <isNotEmpty property="sGisAssetsSubCd">
                   AND G.GIS_ASSETS_SUB_CD = #sGisAssetsSubCd#
               </isNotEmpty>

               <isNotEmpty property="sQuayCd">
                   AND B.QUAY_CD = #sQuayCd#
               </isNotEmpty>

               <isNotEmpty property="sEntrpscd">
                   AND A.ENTRPSCD = #sEntrpscd#
               </isNotEmpty>

               <isNotEmpty property="sPrmisnYn">
                   AND A.PRMISN_YN = #sPrmisnYn#
               </isNotEmpty>

               <isNotEmpty property="deptcd">
                   AND A.DEPTCD = #deptcd#
               </isNotEmpty>

               <isNotEmpty property="sUsagePdFrom">
                   AND A.GR_USAGE_PD_FROM <![CDATA[>=]]> TO_DATE(#sUsagePdFrom#||'000000','yyyy-mm-ddhh24miss')
               </isNotEmpty>

               <isNotEmpty property="sUsagePdTo">
                   AND A.GR_USAGE_PD_FROM <![CDATA[<=]]> TO_DATE(#sUsagePdTo#||'235959','yyyy-mm-ddhh24miss')
               </isNotEmpty>
                -->
    </select>


    <!-- 자산 종류 별 자산가액 -->
        <select id="gamGisAssetSttusInqireDao.selectGisAssetValAmtByPrprtSeList_S" parameterClass="hashMap" resultClass="egovMap">
    		SELECT GAM_GETCODENAME('GAM003', gac.GIS_ASSETS_QUAY_CD), SUM(gac.GIS_ASSETS_VAL_AMT)
			FROM gis_assets_cd_f gac
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_PRPRTY_SE_CD
		</select>

	<!-- 시설 위치별 자산가액 -->
        <select id="gamGisAssetSttusInqireDao.selectGisAssetValAmtByLocCdList_S" parameterClass="hashMap" resultClass="egovMap">
			SELECT GAM_GETCODENAME('GAM002', gac.GIS_ASSETS_LOC_CD), SUM(gac.GIS_ASSETS_VAL_AMT)
			FROM gis_assets_cd_f gac
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_LOC_CD
		</select>

	<!-- 시설 부두별 자산가액 -->
        <select id="gamGisAssetSttusInqireDao.selectGisAssetValAmtByQuayCdList_S" parameterClass="hashMap" resultClass="egovMap">
			SELECT GAM_GETCODENAME('GAM003', gac.GIS_ASSETS_QUAY_CD), SUM(gac.GIS_ASSETS_VAL_AMT)
			FROM gis_assets_cd_f gac
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_QUAY_CD
		</select>


	<!-- 시설 전체 사용 현황 -->
        <select id="gamGisAssetSttusInqireDao.selectGisAssetUsageSttusList_S" parameterClass="hashMap" resultClass="egovMap">
			SELECT SUM(gac.GIS_ASSETS_REAL_RENT_AR), SUM(B.USAGE_AR)
			FROM gis_assets_cd_f gac left outer join (
			  SELECT GIS_ASSETS_PRT_AT_CODE, gis_assets_cd, gis_assets_sub_cd, USAGE_AR FROM ASSETS_RENT_DETAIL_F
			  WHERE  1=1
			  <isNotEmpty property="searchDt" prepend="AND">
			  	TO_DATE(#searchDt#, 'YYYY-MM-DD') BETWEEN USAGE_PD_FROM AND USAGE_PD_TO
			  </isNotEmpty>
			  ) B ON gac.GIS_ASSETS_PRT_AT_CODE=b.GIS_ASSETS_PRT_AT_CODE and gac.gis_assets_cd=b.gis_assets_cd and gac.gis_assets_sub_cd=B.gis_assets_sub_cd
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
		</select>

		<!-- 시설 종류별 사용현황 -->
        <select id="gamGisAssetSttusInqireDao.selectGisAssetUsageByPrprtySeSttusList_D" parameterClass="hashMap" resultClass="egovMap">
			SELECT GAM_GETCODENAME('GAM001', gac.GIS_ASSETS_PRPRTY_SE_CD), SUM(gac.GIS_ASSETS_REAL_RENT_AR), SUM(B.USAGE_AR)
			FROM gis_assets_cd_f gac left outer join (
			  SELECT GIS_ASSETS_PRT_AT_CODE, gis_assets_cd, gis_assets_sub_cd, USAGE_AR FROM ASSETS_RENT_DETAIL_F
			  WHERE  1=1
			  <isNotEmpty property="searchDt" prepend="AND">
			  	TO_DATE(#searchDt#, 'YYYY-MM-DD') BETWEEN USAGE_PD_FROM AND USAGE_PD_TO
			  </isNotEmpty>
			  ) B ON gac.GIS_ASSETS_PRT_AT_CODE=b.GIS_ASSETS_PRT_AT_CODE and gac.gis_assets_cd=b.gis_assets_cd and gac.gis_assets_sub_cd=B.gis_assets_sub_cd
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_PRPRTY_SE_CD
		</select>

	<!-- 시설 위치별 사용현황 -->
		<select id="gamGisAssetSttusInqireDao.selectGisAssetUsageByLocCdSttusList_D" parameterClass="hashMap" resultClass="egovMap">
			SELECT GAM_GETCODENAME('GAM002', gac.GIS_ASSETS_LOC_CD), SUM(gac.GIS_ASSETS_REAL_RENT_AR), SUM(B.USAGE_AR)
			FROM gis_assets_cd_f gac left outer join (
			  SELECT GIS_ASSETS_PRT_AT_CODE, gis_assets_cd, gis_assets_sub_cd, USAGE_AR FROM ASSETS_RENT_DETAIL_F
			  WHERE  1=1
			  <isNotEmpty property="searchDt" prepend="AND">
			  	TO_DATE(#searchDt#, 'YYYY-MM-DD') BETWEEN USAGE_PD_FROM AND USAGE_PD_TO
			  </isNotEmpty>
			  ) B ON gac.GIS_ASSETS_PRT_AT_CODE=b.GIS_ASSETS_PRT_AT_CODE and gac.gis_assets_cd=b.gis_assets_cd and gac.gis_assets_sub_cd=B.gis_assets_sub_cd
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_LOC_CD
		</select>

	<!-- 시설 부두별 사용현황 -->
		<select id="gamGisAssetSttusInqireDao.selectGisAssetUsageByQuayCdSttusList_D" parameterClass="hashMap" resultClass="egovMap">
			SELECT GAM_GETCODENAME('GAM003', gac.GIS_ASSETS_QUAY_CD), SUM(gac.GIS_ASSETS_REAL_RENT_AR), SUM(B.USAGE_AR)
			FROM gis_assets_cd_f gac left outer join (
			  SELECT GIS_ASSETS_PRT_AT_CODE, gis_assets_cd, gis_assets_sub_cd, USAGE_AR FROM ASSETS_RENT_DETAIL_F
			  WHERE  1=1
			  <isNotEmpty property="searchDt" prepend="AND">
			  	TO_DATE(#searchDt#, 'YYYY-MM-DD') BETWEEN USAGE_PD_FROM AND USAGE_PD_TO
			  </isNotEmpty>
			  ) B ON gac.GIS_ASSETS_PRT_AT_CODE=b.GIS_ASSETS_PRT_AT_CODE and gac.gis_assets_cd=b.gis_assets_cd and gac.gis_assets_sub_cd=B.gis_assets_sub_cd
			WHERE gac.GIS_ASSETS_USAGE_YN='Y'
			GROUP BY gac.GIS_ASSETS_QUAY_CD
		</select>

	<!-- 업체별 사용현황 -->
		<select id="gamGisAssetSttusInqireDao.selectGisAssetUsageByEntrpsSttusList_D" parameterClass="hashMap" resultClass="egovMap">
		<![CDATA[
			select decode(rnum, 7, '기타', MAX(entrps_nm)) entrps_nm, sum(usage_ar)
			from (
			select case when rownum<7 then rownum else 7 end rnum, entrps_nm, USAGE_AR from (
			SELECT entrps_nm, USAGE_AR
			from (
			  SELECT GAM_GETENTRPSNM(A.entrpscd, '1') entrps_nm,SUM(D.USAGE_AR) USAGE_AR FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F D
			  WHERE  1=1
		  ]]>
			  <isNotEmpty property="searchDt" prepend="AND">
			  	TO_DATE(#searchDt#, 'YYYY-MM-DD') BETWEEN USAGE_PD_FROM AND USAGE_PD_TO
			  </isNotEmpty>
		<![CDATA[
			  and a.mng_year=d.mng_year and a.mng_no=d.mng_no and a.mng_cnt=d.mng_cnt
			GROUP BY A.entrpscd
			)
			order by USAGE_AR desc
			)
			)
			group by rnum
		  ]]>
		</select>

</sqlMap>
