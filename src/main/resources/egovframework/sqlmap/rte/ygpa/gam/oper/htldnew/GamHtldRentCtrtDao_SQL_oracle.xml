<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="ygpa.gam.oper.htldnew">
	
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
	<typeAlias alias="GamHtldRentCtrtVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentCtrtVO"/>
	<typeAlias alias="GamHtldRentCtrtDetailVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentCtrtDetailVO"/>
    <typeAlias alias="GamHtldRentFeeVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentFeeVO"/>
	
	<resultMap id="gamHtldRentCtrtMngKeyMap" class="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentCtrtVO">
        <result property="mngYear" column="MNG_YEAR" columnIndex="1"/>
        <result property="mngNo" column="MNG_NO" columnIndex="2"/>
        <result property="mngSeq" column="MNG_SEQ" columnIndex="3"/>
	</resultMap>
		
	<!--  배후단지 임대계약 조회-->
	<select id="gamHtldRentCtrtDao.selectHtldRentCtrt_S" parameterClass="GamHtldRentCtrtVO" resultClass="egovMap">
		SELECT
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,ENTRPS_CD
		  ,(SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = ENTRPS_CD) ENTRPS_NM
		  ,(SELECT SUBSTR(E.BIZRNO, 0,3)||'-'||SUBSTR(E.BIZRNO, 4,2)||'-'||SUBSTR(E.BIZRNO, 6,5) FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = ENTRPS_CD) BIZRNO
		  ,BOUND_CD
		  ,CHRGE_KND_CD
		  ,GR_RENT_AR
		  ,PAY_SE
		  ,TO_CHAR(CTRT_BEGIN_DT, 'YYYY-MM-DD') CTRT_BEGIN_DT
		  ,TO_CHAR(CTRT_END_DT, 'YYYY-MM-DD') CTRT_END_DT
		  ,TO_CHAR(CTRT_DT, 'YYYY-MM-DD') CTRT_DT
		  ,TO_CHAR(TERMN_DT, 'YYYY-MM-DD') TERMN_DT
		  ,DECODE(TERMN_DT, NULL, 'N', 'Y') TERMN_YN
		  ,TERMN_RSN
		FROM HTLD_RENT_F
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</select>
	
	<!--  배후단지 임대계약 상세목록 조회 -->
	<select id="gamHtldRentCtrtDao.selectHtldRentCtrtDetailList_D" parameterClass="GamHtldRentCtrtVO" resultClass="egovMap">
		SELECT
			D.MNG_YEAR
			,D.MNG_NO
			,D.MNG_SEQ
			,D.REGIST_SEQ
			,D.GIS_ASSETS_PRT_AT_CODE
			,D.GIS_ASSETS_CD
			,D.GIS_ASSETS_SUB_CD
			,TO_CHAR(D.DETAIL_PD_BEGIN, 'YYYY-MM-DD') DETAIL_PD_BEGIN
			,TO_CHAR(D.DETAIL_PD_END, 'YYYY-MM-DD') DETAIL_PD_END
			,D.RENT_AR
			,D.RENT_AR_SE
			,D.APPLC_RNTFEE
			,D.ASSETS_NM
			,D.PRICE_SE
			,D.RM
			,F.GIS_ASSETS_LOCPLC
			,F.GIS_ASSETS_LNM
			,F.GIS_ASSETS_LNM_SUB
		FROM
		  HTLD_RENT_DETAIL_F D
		LEFT OUTER JOIN GIS_ASSETS_CD_F F 
		ON
			D.GIS_ASSETS_PRT_AT_CODE = F.GIS_ASSETS_PRT_AT_CODE AND D.GIS_ASSETS_CD = F.GIS_ASSETS_CD AND D.GIS_ASSETS_SUB_CD = F.GIS_ASSETS_SUB_CD
		WHERE
			D.MNG_YEAR = #mngYear#
			AND D.MNG_NO = #mngNo#
			AND D.MNG_SEQ = #mngSeq#
		ORDER BY
			D.REGIST_SEQ ASC
	</select>
	
	<!-- 자산관리코드(관리년도, 관리번호, 관리순번) 생성 (일반부두의 자산관리코드와 LEV_REQEST_F에 공유되므로 겹치지 않도록 함, 향후 일반부두에도 적용시켜야 함 ) -->
	<select id="gamHtldRentCtrtDao.selectMngKeyValues_S" resultMap="gamHtldRentCtrtMngKeyMap">
		SELECT
		  TO_CHAR(SYSDATE, 'YYYY') MNG_YEAR
		  ,GREATEST( (SELECT LPAD(NVL(MAX(MNG_NO),0) + 1,'3','0') MNG_NO FROM ASSETS_RENT_F WHERE PRT_AT_CODE='622' AND MNG_YEAR = TO_CHAR(SYSDATE, 'YYYY'))
		    , (SELECT LPAD(NVL(MAX(MNG_NO),0) + 1,'3','0') MNG_NO FROM HTLD_RENT_F WHERE MNG_YEAR = TO_CHAR(SYSDATE, 'YYYY')) ) MNG_NO
		  , '01' MNG_SEQ
		FROM
		  DUAL		
	</select>
	
	<!-- 배후단지 임대계약 등록 -->	
	<insert id="gamHtldRentCtrtDao.insertHtldRentCtrt_S" parameterClass="GamHtldRentCtrtVO" >
		INSERT INTO HTLD_RENT_F (
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,ENTRPS_CD
		  ,BOUND_CD
		  ,CHRGE_KND_CD
		  ,GR_RENT_AR
		  ,PAY_SE
		  ,CTRT_BEGIN_DT
		  ,CTRT_END_DT
		  ,CTRT_DT
		  ,REG_USR
		  ,REGIST_DT
		  ,UPD_USR
		  ,UPDT_DT
		) VALUES (
		  #mngYear#
		  ,#mngNo#
		  ,#mngSeq#
		  ,#entrpsCd#
		  ,#boundCd#
		  ,#chrgeKndCd#
		  ,TO_NUMBER(#grRentAr#)
		  ,#paySe#
		  ,TO_DATE(#ctrtBeginDt#, 'YYYY-MM-DD')
		  ,TO_DATE(#ctrtEndDt#, 'YYYY-MM-DD')
		  ,TO_DATE(#ctrtDt#, 'YYYY-MM+DD')
		  ,#regUsr#
		  ,SYSDATE
		  ,#regUsr#
		  ,SYSDATE
		)
	</insert>
	
	<!-- 배후단지 임대계약 수정 -->
	<update id="gamHtldRentCtrtDao.updateHtldRentCtrt_S" parameterClass="GamHtldRentCtrtVO">
		UPDATE HTLD_RENT_F SET
		  ENTRPS_CD = #entrpsCd#
		  ,BOUND_CD = #boundCd#
		  ,CHRGE_KND_CD = #chrgeKndCd#
		  ,GR_RENT_AR = TO_NUMBER(#grRentAr#)
		  ,PAY_SE = #paySe#
		  ,CTRT_BEGIN_DT = TO_DATE(#ctrtBeginDt#, 'YYYY-MM-DD')
		  ,CTRT_END_DT = TO_DATE(#ctrtEndDt#, 'YYYY-MM-DD')
		  ,CTRT_DT = TO_DATE(#ctrtDt#, 'YYYY-MM+DD')
		  ,UPD_USR = #updUsr#
		  ,UPDT_DT = SYSDATE
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</update>
	
	<!-- 배후단지 임대계약 해지 -->
	<update id="gamHtldRentCtrtDao.terminateHtldRentCtrt_S" parameterClass="GamHtldRentCtrtVO">
		UPDATE HTLD_RENT_F
		SET
		  TERMN_DT = TO_DATE(#termnDt#, 'YYYY-MM-DD')
		  ,TERMN_RSN = #termnRsn#
		  ,UPD_USR = #updUsr#
		  ,UPDT_DT = SYSDATE
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</update>
	
	<!-- 배후단지 임대계약 상세번호 생성 -->
	<select id="gamHtldRentCtrtDao.selectNextRegistSeq_S" parameterClass="GamHtldRentCtrtVO" resultClass="java.lang.String">
   		SELECT
   		  	LPAD(NVL(MAX(REGIST_SEQ),0) + 1,'3','0')
   		FROM
   		  	HTLD_RENT_DETAIL_F
   		WHERE
			MNG_YEAR=#mngYear# 
			AND MNG_NO=#mngNo# 
			AND MNG_SEQ=#mngSeq#
	</select>
	
	<!-- 배후단지 임대계약 상세목록 등록 -->
	<insert id="gamHtldRentCtrtDao.insertHtldRentCtrtDetail_S" parameterClass="GamHtldRentCtrtDetailVO">
		INSERT INTO HTLD_RENT_DETAIL_F (
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,REGIST_SEQ
		  ,GIS_ASSETS_PRT_AT_CODE
		  ,GIS_ASSETS_CD
		  ,GIS_ASSETS_SUB_CD
		  ,DETAIL_PD_BEGIN
		  ,DETAIL_PD_END
		  ,RENT_AR
		  ,RENT_AR_SE
		  ,APPLC_RNTFEE
		  ,ASSETS_NM
		  ,PRICE_SE
		  ,RM
		  ,REG_USR
		  ,REGIST_DT
		  ,UPD_USR
		  ,UPDT_DT
		) VALUES (
		  #mngYear#
		  ,#mngNo#
		  ,#mngSeq#
		  ,#registSeq#
		  ,#gisAssetsPrtAtCode#
		  ,#gisAssetsCd#
		  ,#gisAssetsSubCd#
		  ,TO_DATE(#detailPdBegin#, 'YYYY-MM-DD')
		  ,TO_DATE(#detailPdEnd#, 'YYYY-MM-DD')
		  ,TO_NUMBER(#rentAr#)
		  ,#rentArSe#
		  ,TO_NUMBER(#applcRntfee#)
		  ,#assetsNm#
		  ,#priceSe#
		  ,#rm#
		  ,#regUsr#
		  ,SYSDATE
		  ,#regUsr#
		  ,SYSDATE
		)
	</insert>
	
	<!-- 배후단지 임대계약 상세목록 수정 -->
	<update id="gamHtldRentCtrtDao.updateHtldRentCtrtDetail_S" parameterClass="GamHtldRentCtrtDetailVO">
		UPDATE HTLD_RENT_DETAIL_F
		SET
		  GIS_ASSETS_PRT_AT_CODE = #gisAssetsPrtAtCode#
		  ,GIS_ASSETS_CD = #gisAssetsCd#
		  ,GIS_ASSETS_SUB_CD = #gisAssetsSubCd#
		  ,DETAIL_PD_BEGIN = TO_DATE(#detailPdBegin#, 'YYYY-MM-DD')
		  ,DETAIL_PD_END = TO_DATE(#detailPdEnd#, 'YYYY-MM-DD')
		  ,RENT_AR = TO_NUMBER(#rentAr#)
		  ,RENT_AR_SE = #rentArSe#
		  ,APPLC_RNTFEE = TO_NUMBER(#applcRntfee#)
		  ,ASSETS_NM = #assetsNm#
		  ,PRICE_SE = #priceSe#
		  ,RM = #rm#  
		  ,UPD_USR = #updUsr#
		  ,UPDT_DT = SYSDATE
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
		  AND REGIST_SEQ = #registSeq#
	</update>
	
	<!-- 배후단지 임대계약 상세목록 삭제 -->
	<delete id="gamHtldRentCtrtDao.deleteHtldRentCtrtDetail_S" parameterClass="GamHtldRentCtrtDetailVO">
		DELETE FROM HTLD_RENT_DETAIL_F
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
		  AND REGIST_SEQ = #registSeq#
	</delete>

	<!--  배후단지 임대계약 최신이력번호 조회 -->
	<select id="gamHtldRentCtrtDao.selectHtldRentCtrtMaxHistSeq_S" parameterClass="GamHtldRentCtrtVO" resultClass="java.lang.String">
		SELECT 
		  NVL(MAX(HIST_SEQ), '0000') MAX_HIST_SEQ
		FROM HTLD_RENT_HIST_F
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</select>

	<!-- 배후단지 임대계약 이력번호 생성 -->
	<select id="gamHtldRentCtrtDao.selectNextHistSeq_S" parameterClass="GamHtldRentCtrtVO" resultClass="java.lang.String">
		SELECT 
			LPAD(NVL(MAX(HIST_SEQ),0) + 1,'4','0') AS NEXT_HIST_SEQ
		FROM 
			HTLD_RENT_HIST_F 
		WHERE 
			MNG_YEAR=#mngYear# 
			AND MNG_NO=#mngNo# 
			AND MNG_SEQ=#mngSeq#
	</select>

	<!--  배후단지 임대계약 변경시 이력등록 -->
	<insert id="gamHtldRentCtrtDao.insertHtldRentCtrtHist_S" parameterClass="GamHtldRentCtrtVO">
		INSERT INTO HTLD_RENT_HIST_F (
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,HIST_SEQ
		  ,ENTRPS_CD
		  ,BOUND_CD
		  ,CHRGE_KND_CD
		  ,GR_RENT_AR
		  ,PAY_SE
		  ,CTRT_BEGIN_DT
		  ,CTRT_END_DT
		  ,CTRT_DT
		  ,TERMN_DT
		  ,TERMN_RSN
		  ,REG_USR
		  ,REGIST_DT
		  ,UPD_USR
		  ,UPDT_DT
		)
		SELECT
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,#histSeq# AS HIST_SEQ
		  ,ENTRPS_CD
		  ,BOUND_CD
		  ,CHRGE_KND_CD
		  ,GR_RENT_AR
		  ,PAY_SE
		  ,CTRT_BEGIN_DT
		  ,CTRT_END_DT
		  ,CTRT_DT
		  ,TERMN_DT
		  ,TERMN_RSN
		  ,REG_USR
		  ,REGIST_DT
		  ,UPD_USR
		  ,UPDT_DT
		FROM HTLD_RENT_F
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</insert>

	<!--  배후단지 임대관리 상세목록 변경시 이력등록 -->
	<insert id="gamHtldRentCtrtDao.insertHtldRentCtrtDetailHist_D" parameterClass="GamHtldRentCtrtVO">
		INSERT INTO HTLD_RENT_DETAIL_HIST_F (
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,REGIST_SEQ
		  ,HIST_SEQ
		  ,GIS_ASSETS_PRT_AT_CODE
		  ,GIS_ASSETS_CD
		  ,GIS_ASSETS_SUB_CD
		  ,DETAIL_PD_BEGIN
		  ,DETAIL_PD_END
		  ,RENT_AR
		  ,RENT_AR_SE
		  ,APPLC_RNTFEE
		  ,ASE_RNTFEE
		  ,ASE_APPLC_BEGIN
		  ,ASE_APPLC_END
		  ,APPLC_RSN
		  ,ASSETS_NM
		  ,PRICE_SE
		  ,RM
		  ,REG_USR
		  ,REGIST_DT
		)
		SELECT 
		  MNG_YEAR
		  ,MNG_NO
		  ,MNG_SEQ
		  ,REGIST_SEQ
		  ,#histSeq# AS HIST_SEQ
		  ,GIS_ASSETS_PRT_AT_CODE
		  ,GIS_ASSETS_CD
		  ,GIS_ASSETS_SUB_CD
		  ,DETAIL_PD_BEGIN
		  ,DETAIL_PD_END
		  ,RENT_AR
		  ,RENT_AR_SE
		  ,APPLC_RNTFEE
		  ,ASE_RNTFEE
		  ,ASE_APPLC_BEGIN
		  ,ASE_APPLC_END
		  ,APPLC_RSN
		  ,ASSETS_NM
		  ,PRICE_SE
		  ,RM
		  ,REG_USR
		  ,REGIST_DT
		FROM
		  HTLD_RENT_DETAIL_F
		WHERE
		  MNG_YEAR = #mngYear#
		  AND MNG_NO = #mngNo#
		  AND MNG_SEQ = #mngSeq#
	</insert>
	
	<!-- 배후단지 임대료 상세번호 생성 -->
	<select id="gamHtldRentCtrtDao.selectNextRentFeeSeq_S" parameterClass="GamHtldRentCtrtVO" resultClass="java.lang.String">
   		SELECT
   		  	LPAD(NVL(MAX(RNTFEE_SEQ),0) + 1,'3','0')
   		FROM
   		  	HTLD_RNTFEE_F
   		WHERE
			MNG_YEAR=#mngYear# 
			AND MNG_NO=#mngNo# 
			AND MNG_SEQ=#mngSeq#
	</select>
	
	<!-- 임대료 등록 -->
    <insert id="gamHtldRentCtrtDao.insertHtldRentFee_S"  parameterClass="GamHtldRentFeeVO">
    	INSERT INTO HTLD_RNTFEE_F (
    		MNG_YEAR
    		,MNG_NO
    		,MNG_SEQ
    		,RNTFEE_SEQ
    		,RENT_DETAIL_REGIST_SEQ
    		,RNTFEE_SE
    		,NTIC_BEGIN_DT
    		,NTIC_END_DT
    		,RNTFEE
    		,PAYINST_INTR
    		,SUP_AMT
    		,VAT
    		,PAY_AMT
    		,REG_USR
    		,REGIST_DT
    		,UPD_USR
    		,UPDT_DT
    	) VALUES (
    		#mngYear#
    		,#mngNo#
    		,#mngSeq#
    		,#rntfeeSeq#
    		,#rentDetailRegistSeq#
    		,#rntfeeSe#
    		,TO_DATE(#nticBeginDt#, 'YYYY-MM-DD')
    		,TO_DATE(#nticEndDt#, 'YYYY-MM-DD')
    		,TO_NUMBER(#rntfee#)
    		,TO_NUMBER(#payinstIntr#)
    		,TO_NUMBER(#supAmt#)
    		,TO_NUMBER(#vat#)
    		,TO_NUMBER(#payAmt#)
    		,#regUsr#
    		,SYSDATE
    		,#regUsr#
    		,SYSDATE    		
    	)    	
    </insert>
    
    <!-- 임대료 수정 -->
    <update id="gamHtldRentCtrtDao.updateHtldRentFee_S"  parameterClass="GamHtldRentFeeVO">
    	UPDATE HTLD_RNTFEE_F
    	SET
    		RNTFEE = TO_NUMBER(#rntfee#)
    		,PAYINST_INTR = TO_NUMBER(#payinstIntr#)
    		,SUP_AMT = TO_NUMBER(#supAmt#)
    		,VAT = TO_NUMBER(#vat#)
    		,PAY_AMT = TO_NUMBER(#payAmt#)
    		,UPD_USR = #updUsr#
    		,UPDT_DT = SYSDATE
    	WHERE
    	    MNG_YEAR = #mngYear#
    		AND MNG_NO = #mngNo#
    		AND MNG_SEQ = #mngSeq#
    		AND RNTFEE_SEQ = #rntfeeSeq#
    </update>
</sqlMap>