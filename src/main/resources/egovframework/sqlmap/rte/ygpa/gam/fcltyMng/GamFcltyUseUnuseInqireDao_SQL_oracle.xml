<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ygpa.gam.fcltyMng">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyUseUnuseSttusInqireVO" type="egovframework.rte.ygpa.gam.fcltyMng.service.GamFcltyUseUnuseSttusInqireVO"/>


	<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireList_D" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="egovMap">
            SELECT Z.*
           FROM (
                SELECT ROWNUM RNUM, S.*
                	FROM (  
	 SELECT
		A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	,(SELECT CODE_NM FROM COMTCCMMNDETAILCODE WHERE CODE_ID = 'GAM019' AND CODE = A.GIS_ASSETS_PRT_AT_CODE) AS GIS_ASSETS_PRT_AT_NAME
    ,A.GIS_ASSETS_NM
	,A.GIS_ASSETS_LOCPLC || NVL2(GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM || '-' || GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM) AS GIS_ASSETS_LNMS
	,TO_CHAR(NVL(A.GIS_ASSETS_AR,0)) AS GIS_ASSETS_AR
  	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR,0)) AS GIS_ASSETS_REAL_RENT_AR
  	,TO_CHAR(NVL(SUM(C.USAGE_AR),0)) AS USAGE_AR
	,NVL(TO_CHAR(C.USAGE_PD_FROM,'YYYY-MM-DD'),0) AS USAGE_PD_FROM
    ,NVL(TO_CHAR(C.USAGE_PD_TO,'YYYY-MM-DD'),0) AS USAGE_PD_TO
	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR-SUM(C.USAGE_AR),0)) AS NO_USAGE_AR
  	,RTRIM(TO_CHAR(NVL(ROUND((SUM(C.USAGE_AR)/NULLIF(A.GIS_ASSETS_REAL_RENT_AR,0))*100,2),0),'FM9990D99'),'.' ) AS USAGE_AR_PER
	
  
	
  
	
	FROM
		 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN ( 
      SELECT 
     B.PRMISN_YN
    ,D.GIS_ASSETS_PRT_AT_CODE
    ,D.GIS_ASSETS_CD
    ,D.GIS_ASSETS_SUB_CD
    ,D.USAGE_AR
    ,D.USAGE_PD_FROM
    ,D.USAGE_PD_TO
   
    FROM ASSETS_RENT_DETAIL_F D,ASSETS_RENT_F B
    WHERE B.PRT_AT_CODE = D.PRT_AT_CODE
    AND B.MNG_YEAR = D.MNG_YEAR
    AND B.MNG_NO = D.MNG_NO
    AND B.MNG_CNT = D.MNG_CNT
    ) C
	ON  A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
    AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
    AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
  
  
 	WHERE
 			A.GIS_ASSETS_AR IS NOT NULL
 		AND A.GIS_ASSETS_USAGE_YN='Y'
    	AND C.PRMISN_YN='Y'
    
  <isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>  
		
	 					
	GROUP BY 
	  A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	, A.GIS_ASSETS_LOCPLC
	, A.GIS_ASSETS_NM
	, A.GIS_ASSETS_LNM
	, A.GIS_ASSETS_LNM_SUB
	, A.GIS_ASSETS_AR
	, A.GIS_ASSETS_REAL_RENT_AR
  	, C.PRMISN_YN
	, C.USAGE_PD_FROM
	, C.USAGE_PD_TO
	
	
	ORDER BY
	   	  GIS_ASSETS_PRT_AT_NAME
		, A.GIS_ASSETS_NM
		, GIS_ASSETS_LNMS 
		, C.USAGE_PD_FROM
		, C.USAGE_PD_TO
	
		DESC
		)S
	)Z
  
  

        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>      		



</select>
 <!-- 소재지 지번 자산명 총면적 사용면적 실제임대면적 NVL(SUM(gac.GIS_ASSETS_REAL_RENT_AR)- SUM(B.USAGE_AR),0) -->
 
<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireListTotCnt_S" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="int">
	
	
SELECT count(*) FROM (

	 SELECT
		A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	,(SELECT CODE_NM FROM COMTCCMMNDETAILCODE WHERE CODE_ID = 'GAM019' AND CODE = A.GIS_ASSETS_PRT_AT_CODE) AS GIS_ASSETS_PRT_AT_NAME
    ,A.GIS_ASSETS_NM
	,A.GIS_ASSETS_LOCPLC || NVL2(GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM || '-' || GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM) AS GIS_ASSETS_LNMS
	,TO_CHAR(NVL(A.GIS_ASSETS_AR,0)) AS GIS_ASSETS_AR
  	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR,0)) AS GIS_ASSETS_REAL_RENT_AR
  	,TO_CHAR(NVL(SUM(C.USAGE_AR),0)) AS USAGE_AR
	,NVL(TO_CHAR(C.USAGE_PD_FROM,'YYYY-MM-DD'),0) AS USAGE_PD_FROM
    ,NVL(TO_CHAR(C.USAGE_PD_TO,'YYYY-MM-DD'),0) AS USAGE_PD_TO
	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR-SUM(C.USAGE_AR),0)) AS NO_USAGE_AR
  	,RTRIM(TO_CHAR(NVL(ROUND((SUM(C.USAGE_AR)/NULLIF(A.GIS_ASSETS_REAL_RENT_AR,0))*100,2),0),'FM9990D99'),'.' ) AS USAGE_AR_PER
	
	FROM
		 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN ( 
      SELECT 
     B.PRMISN_YN
    ,D.GIS_ASSETS_PRT_AT_CODE
    ,D.GIS_ASSETS_CD
    ,D.GIS_ASSETS_SUB_CD
    ,D.USAGE_AR
    ,D.USAGE_PD_FROM
    ,D.USAGE_PD_TO
   
    FROM ASSETS_RENT_DETAIL_F D,ASSETS_RENT_F B
    WHERE B.PRT_AT_CODE = D.PRT_AT_CODE
    AND B.MNG_YEAR = D.MNG_YEAR
    AND B.MNG_NO = D.MNG_NO
    AND B.MNG_CNT = D.MNG_CNT
    ) C
	ON  A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
    AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
    AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
  
  
 	WHERE
 			A.GIS_ASSETS_AR IS NOT NULL
 		AND A.GIS_ASSETS_USAGE_YN='Y'
    	AND C.PRMISN_YN='Y'
    
  <isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>  
		
	 					
	GROUP BY 
	  A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	, A.GIS_ASSETS_LOCPLC
	, A.GIS_ASSETS_NM
	, A.GIS_ASSETS_LNM
	, A.GIS_ASSETS_LNM_SUB
	, A.GIS_ASSETS_AR
	, A.GIS_ASSETS_REAL_RENT_AR
  	, C.PRMISN_YN
	, C.USAGE_PD_FROM
	, C.USAGE_PD_TO
	)
  
	
	
</select> 

<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireDetailList_D" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="egovMap">

 
	 
SELECT A.GIS_ASSETS_NM ,
  GAM_GETENTRPSNM(C.ENTRPSCD, '1') ENTRPS_NM ,
  NVL(C.USAGE_AR,0)                     AS USAGE_AR ,
  TO_CHAR(C.USAGE_PD_FROM,'YYYY-MM-DD') AS USAGE_PD_FROM ,
  TO_CHAR(C.USAGE_PD_TO,'YYYY-MM-DD')   AS USAGE_PD_TO ,
  C.USAGE_PURPS ,
  USAGE_DTLS ,
  ENTRPS_SE ,
  EXEMPT_SE ,
  EXEMPT_RSN ,
  TO_CHAR(C.EXEMPT_PD_FROM,'YYYY-MM-DD') AS EXEMPT_PD_FROM ,
  TO_CHAR(C.EXEMPT_PD_TO,'YYYY-MM-DD')   AS EXEMPT_PD_TO ,
  C.COMPUT_DTLS                          AS COMPUT_DTLS ,
  NVL(C.OLNLP,0)                         AS OLNLP ,
  NVL(C.APPLC_PRICE,0)                   AS APPLC_PRICE ,
  NVL(C.APPLC_TARIFF,0)                  AS APPLC_TARIFF ,
  APPLC_MTH ,
  NVL(C.RDCXPT_FEE,0)               AS RDCXPT_FEE ,
  NVL(C.FEE,0)                      AS FEE ,
  TO_CHAR(C.TRMNAT_DT,'YYYY-MM-DD') AS TRMNAT_DT ,
  C.TRMNAT_RSN ,
   C.GIS_ASSETS_PRT_AT_CODE,
  C.GIS_ASSETS_CD,
  C.GIS_ASSETS_SUB_CD

  
  
FROM GIS_ASSETS_CD_F A

LEFT OUTER JOIN
  (SELECT F.ENTRPSCD ,
    GAM_GETENTRPSNM(F.ENTRPSCD, '1') ENTRPS_NM ,
    D.USAGE_AR ,
    D.USAGE_PD_FROM ,
    D.USAGE_PD_TO ,
    D.USAGE_PURPS ,
    D.USAGE_DTLS ,
    D.ENTRPS_SE ,
    D.EXEMPT_SE ,
    D.EXEMPT_RSN ,
    D.EXEMPT_PD_FROM ,
    D.EXEMPT_PD_TO ,
    D.COMPUT_DTLS ,
    D.OLNLP ,
    D.APPLC_PRICE ,
    D.APPLC_TARIFF ,
    D.APPLC_MTH ,
    D.RDCXPT_FEE ,
    D.FEE ,
    D.TRMNAT_DT ,
    D.TRMNAT_RSN,
    D.GIS_ASSETS_PRT_AT_CODE ,
    D.GIS_ASSETS_CD ,
    D.GIS_ASSETS_SUB_CD
  FROM ASSETS_RENT_F F,
    ASSETS_RENT_DETAIL_F D
  WHERE F.PRT_AT_CODE = D.PRT_AT_CODE
  AND F.MNG_YEAR      = D.MNG_YEAR
  AND F.MNG_NO        = D.MNG_NO
  AND F.MNG_CNT       = D.MNG_CNT
  AND F.PRMISN_YN='Y'
  )C
ON C.GIS_ASSETS_PRT_AT_CODE    = A.GIS_ASSETS_PRT_AT_CODE
AND C.GIS_ASSETS_CD            = A.GIS_ASSETS_CD
AND C.GIS_ASSETS_SUB_CD        = A.GIS_ASSETS_SUB_CD

WHERE C.GIS_ASSETS_PRT_AT_CODE = A.GIS_ASSETS_PRT_AT_CODE
AND C.GIS_ASSETS_CD            = A.GIS_ASSETS_CD
AND C.GIS_ASSETS_SUB_CD        = A.GIS_ASSETS_SUB_CD

 							<isNotEmpty property="gisAssetsPrtAtCode">
					             AND C.GIS_ASSETS_PRT_AT_CODE = #gisAssetsPrtAtCode#
					             </isNotEmpty>
					             <isNotEmpty property="gisAssetsCd">
						             AND C.GIS_ASSETS_CD = #gisAssetsCd#
						         </isNotEmpty>
						         
						         <isNotEmpty property="gisAssetsSubCd">
						             AND C.GIS_ASSETS_SUB_CD = #gisAssetsSubCd#
						         </isNotEmpty>
						         
						  
						  <isNotEmpty property="usagePdFrom">
						 <![CDATA[ AND USAGE_PD_FROM >= TO_DATE(#usagePdFrom#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="usagePdTo">
						<![CDATA[ AND USAGE_PD_TO < TO_DATE(#usagePdTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty> 
  





GROUP BY A.GIS_ASSETS_NM ,
  C.ENTRPSCD ,
  USAGE_AR ,
  USAGE_PD_FROM ,
  USAGE_PD_TO ,
  USAGE_PURPS ,
  USAGE_DTLS ,
  ENTRPS_SE ,
  EXEMPT_SE ,
  EXEMPT_RSN ,
  EXEMPT_PD_FROM ,
  EXEMPT_PD_TO ,
  COMPUT_DTLS ,
  OLNLP ,
  APPLC_PRICE ,
  APPLC_TARIFF ,
  APPLC_MTH ,
  RDCXPT_FEE ,
  FEE ,
  TRMNAT_DT ,
  TRMNAT_RSN,
    C.GIS_ASSETS_PRT_AT_CODE,
  C.GIS_ASSETS_CD,
  C.GIS_ASSETS_SUB_CD
  
  
  
  
  ORDER BY
  GIS_ASSETS_NM
  ,ENTRPS_NM
  ,USAGE_PD_FROM
  ,USAGE_AR

    
    
</select>


</sqlMap>






