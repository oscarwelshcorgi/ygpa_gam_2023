<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ygpa.gam.fcltyMng">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyUseUnuseSttusInqireVO" type="egovframework.rte.ygpa.gam.fcltyMng.service.GamFcltyUseUnuseSttusInqireVO"/>


	<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireList_D" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="egovMap">
            SELECT Z.*
           FROM (
                SELECT ROWNUM RNUM, S.*
                	FROM (  
	SELECT
		A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	,(SELECT CODE_NM FROM COMTCCMMNDETAILCODE WHERE CODE_ID = 'GAM019' AND CODE = A.GIS_ASSETS_PRT_AT_CODE) AS GIS_ASSETS_PRT_AT_NAME
    ,A.GIS_ASSETS_NM
	,A.GIS_ASSETS_LOCPLC || NVL2(GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM || '-' || GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM) AS GIS_ASSETS_LNMS
	,TO_CHAR(NVL(A.GIS_ASSETS_AR,0)) AS GIS_ASSETS_AR
  	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR,0)) AS GIS_ASSETS_REAL_RENT_AR
  	,TO_CHAR(NVL(SUM(C.USAGE_AR),0)) AS USAGE_AR
	,TO_CHAR(C.USAGE_PD_FROM,'YYYY-MM-DD') AS USAGE_PD_FROM
	,TO_CHAR(C.USAGE_PD_TO,'YYYY-MM-DD') AS USAGE_PD_TO
	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR-SUM(C.USAGE_AR),0)) AS NO_USAGE_AR
  	,RTRIM(TO_CHAR(NVL(ROUND((SUM(C.USAGE_AR)/NULLIF(A.GIS_ASSETS_REAL_RENT_AR,0))*100,2),0),'FM9990D99'),'.' ) AS USAGE_AR_PER
	
  
	
	
	FROM
		 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN ( 
      SELECT 
     B.PRMISN_YN
    ,D.GIS_ASSETS_PRT_AT_CODE
    ,D.GIS_ASSETS_CD
    ,D.GIS_ASSETS_SUB_CD
    ,D.USAGE_AR
    ,D.USAGE_PD_FROM
    ,D.USAGE_PD_TO
   
    FROM ASSETS_RENT_DETAIL_F D,ASSETS_RENT_F B
    WHERE B.PRT_AT_CODE = D.PRT_AT_CODE
    AND B.MNG_YEAR = D.MNG_YEAR
    AND B.MNG_NO = D.MNG_NO
    AND B.MNG_CNT = D.MNG_CNT
    ) C
	ON  A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
    AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
    AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
  
  
 	WHERE
 			A.GIS_ASSETS_AR IS NOT NULL
 		AND A.GIS_ASSETS_USAGE_YN='Y'
    	AND C.PRMISN_YN='Y'
  
  	<isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>  
  
		

	GROUP BY 
	  A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	, A.GIS_ASSETS_LOCPLC
	, A.GIS_ASSETS_NM
	, A.GIS_ASSETS_LNM
	, A.GIS_ASSETS_LNM_SUB
	, A.GIS_ASSETS_AR
	, A.GIS_ASSETS_REAL_RENT_AR
  	, C.PRMISN_YN
  ,GIS_ASSETS_AR
	,C.USAGE_PD_FROM
	,C.USAGE_PD_TO
	
	
	ORDER BY
	   GIS_ASSETS_PRT_AT_NAME
		,A.GIS_ASSETS_NM
		,GIS_ASSETS_LNMS 
		DESC
	
		)S
	)Z
  
  

        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>      		



</select>
 <!-- 소재지 지번 자산명 총면적 사용면적 실제임대면적 NVL(SUM(gac.GIS_ASSETS_REAL_RENT_AR)- SUM(B.USAGE_AR),0) -->
 
<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireListTotCnt_S" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="int">
	
	
SELECT count(*) FROM (
SELECT
		A.GIS_ASSETS_PRT_AT_CODE
	,A.GIS_ASSETS_CD
	,A.GIS_ASSETS_SUB_CD
	,(SELECT CODE_NM FROM COMTCCMMNDETAILCODE WHERE CODE_ID = 'GAM019' AND CODE = A.GIS_ASSETS_PRT_AT_CODE) AS GIS_ASSETS_PRT_AT_NAME
    ,A.GIS_ASSETS_NM
	,A.GIS_ASSETS_LOCPLC || NVL2(GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM || '-' || GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM) AS GIS_ASSETS_LNMS
	,RTRIM(TO_CHAR(NVL(A.GIS_ASSETS_AR,0),'FM999,999,999.9999'),'.') AS GIS_ASSETS_AR
  	,RTRIM(TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR,0),'FM999,999,999.9999'),'.') AS GIS_ASSETS_REAL_RENT_AR
  	,RTRIM(TO_CHAR(NVL(SUM(C.USAGE_AR),0),'FM999,999,999.9999'),'.') AS USAGE_AR
	,TO_CHAR(MIN(C.USAGE_PD_FROM),'YYYY-MM-DD') AS USAGE_PD_FROM
	,TO_CHAR(MAX(C.USAGE_PD_TO),'YYYY-MM-DD') AS USAGE_PD_TO
	,TO_CHAR(NVL(A.GIS_ASSETS_REAL_RENT_AR-SUM(C.USAGE_AR),0)) AS NO_USAGE_AR
  	,RTRIM(TO_CHAR(NVL(ROUND((SUM(C.USAGE_AR)/NULLIF(A.GIS_ASSETS_REAL_RENT_AR,0))*100,2),0),'FM9990D99'),'.' ) AS USAGE_AR_PER
	
	
	FROM
		 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN ( 
      SELECT 
     B.PRMISN_YN
    ,D.GIS_ASSETS_PRT_AT_CODE
    ,D.GIS_ASSETS_CD
    ,D.GIS_ASSETS_SUB_CD
    ,D.USAGE_AR
    ,USAGE_PD_FROM
    ,USAGE_PD_TO
    FROM ASSETS_RENT_DETAIL_F D,ASSETS_RENT_F B
    WHERE B.PRT_AT_CODE = D.PRT_AT_CODE
    AND B.MNG_YEAR = D.MNG_YEAR
    AND B.MNG_NO = D.MNG_NO
    AND B.MNG_CNT = D.MNG_CNT
    ) C
	ON  A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
    AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
    AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
  
  
 	WHERE
 			A.GIS_ASSETS_AR IS NOT NULL
 		AND A.GIS_ASSETS_USAGE_YN='Y'
    	AND C.PRMISN_YN='Y'
  
						<isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>  


	GROUP BY 
	  A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_CD
	, A.GIS_ASSETS_SUB_CD
	, A.GIS_ASSETS_LOCPLC
	, A.GIS_ASSETS_NM
	, A.GIS_ASSETS_LNM
	, A.GIS_ASSETS_LNM_SUB
	, A.GIS_ASSETS_AR
	, A.GIS_ASSETS_REAL_RENT_AR
  	, C.PRMISN_YN
	
	)
  
	
	
</select> 

<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireDetailList_D" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="egovMap">

 
	SELECT 
   A.ENTRPSCD
  ,NVL(A.QUAY_GROUP_CD,0) AS QUAY_GROUP_CD
  ,GAM_GETENTRPSNM(A.ENTRPSCD, '1') ENTRPS_NM
  ,NVL(D.USAGE_AR,0) AS USAGE_AR
  ,TO_CHAR(D.USAGE_PD_FROM,'YYYY-MM-DD') AS USAGE_PD_FROM
  ,TO_CHAR(D.USAGE_PD_TO,'YYYY-MM-DD') AS USAGE_PD_TO
  ,NVL(D.USAGE_PURPS,0)AS USAGE_PURPS
  ,NVL(D.USAGE_DTLS,0)AS USAGE_DTLS
  ,NVL(D.ENTRPS_SE,0)AS ENTRPS_SE
  ,NVL(D.EXEMPT_SE,0)AS EXEMPT_SE
  ,NVL(D.EXEMPT_RSN,0)AS EXEMPT_RSN
  ,NVL(TO_CHAR(D.EXEMPT_PD_FROM,'YYYY-MM-DD') AS EXEMPT_PD_FROM
  ,NVL(TO_CHAR(D.EXEMPT_PD_TO,'YYYY-MM-DD') AS EXEMPT_PD_TO
  ,NVL(D.COMPUT_DTLS,0)AS COMPUT_DTLS
  ,NVL(D.OLNLP,0)AS OLNLP
  ,NVL(D.APPLC_PRICE,0)AS APPLC_PRICE
  ,NVL(D.APPLC_TARIFF,0)AS APPLC_TARIFF
  ,NVL(D.APPLC_MTH,0)AS APPLC_MTH
  ,NVL(D.RDCXPT_FEE,0)AS RDCXPT_FEE
  ,NVL(D.FEE,0)AS FEE
  ,NVL(TO_CHAR(D.TRMNAT_DT,'YYYY-MM-DD'),0) AS TRMNAT_DT
  ,NVL(D.TRMNAT_RSN,0)AS TRMNAT_RSN
    
    
    FROM ASSETS_RENT_DETAIL_F  D
    
    LEFT OUTER JOIN ASSETS_RENT_F A
    
    ON 
     D.PRT_AT_CODE = A.PRT_AT_CODE
    AND D.MNG_YEAR = A.MNG_YEAR
    AND D.MNG_NO = A.MNG_NO
    AND D.MNG_CNT = A.MNG_CNT
    
    
    WHERE 1=1	
  
    
           <isNotEmpty property="gisAssetsPrtAtCode">
					             AND D.GIS_ASSETS_PRT_AT_CODE = #gisAssetsPrtAtCode#
					             </isNotEmpty>
					             <isNotEmpty property="gisAssetsCd">
						             AND D.GIS_ASSETS_CD = #gisAssetsCd#
						         </isNotEmpty>
						         
						         <isNotEmpty property="gisAssetsSubCd">
						             AND D.GIS_ASSETS_SUB_CD = #gisAssetsSubCd#
						         </isNotEmpty>
						         
						  
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty> 


	    ORDER BY D.ASSETS_USAGE_SEQ
	
    
    
</select>


</sqlMap>






