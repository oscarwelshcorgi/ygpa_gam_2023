<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ygpa.gam.fcltyMng">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamFcltyUseUnuseSttusInqireVO" type="egovframework.rte.ygpa.gam.fcltyMng.service.GamFcltyUseUnuseSttusInqireVO"/>


	<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireList_D" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="egovMap">
           SELECT B.*
           FROM (
                SELECT ROWNUM RNUM, S.*
                	FROM (

	SELECT
	A.GIS_ASSETS_PRT_AT_CODE
	,A.GIS_ASSETS_NM
	,A.GIS_ASSETS_LOCPLC || NVL2(GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM || '-' || GIS_ASSETS_LNM_SUB,GIS_ASSETS_LNM)  GIS_ASSETS_LNMS
	,A.GIS_ASSETS_AR
	,A.GIS_ASSETS_REAL_RENT_AR
	,SUM(C.USAGE_AR) AS USAGE_AR
	,TO_CHAR(C.USAGE_PD_FROM,'YYYY-MM-DD') AS USAGE_PD_FROM
	,TO_CHAR(C.USAGE_PD_TO,'YYYY-MM-DD') AS USAGE_PD_TO
	,(SELECT CODE_NM FROM COMTCCMMNDETAILCODE WHERE CODE_ID = 'GAM019' AND CODE =
	A.GIS_ASSETS_PRT_AT_CODE) AS GIS_ASSETS_PRT_AT_NAME
	
	FROM
		 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN 
		ASSETS_RENT_DETAIL_F C
	ON 	
		A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
	AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
	AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
 	WHERE
 	<!-- A.GIS_ASSETS_AR IS NOT NULL -->
 	A.GIS_ASSETS_USAGE_YN='Y'

	 					<isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>
	GROUP BY A.GIS_ASSETS_PRT_AT_CODE
	, A.GIS_ASSETS_LOCPLC
	, A.GIS_ASSETS_NM
	, A.GIS_ASSETS_LNM
	, A.GIS_ASSETS_LNM_SUB
	, A.GIS_ASSETS_AR
	, A.GIS_ASSETS_REAL_RENT_AR
	, USAGE_PD_FROM
	, USAGE_PD_TO

	ORDER BY
	GIS_ASSETS_PRT_AT_NAME
	,A.GIS_ASSETS_NM
	,GIS_ASSETS_LNMS
	,GIS_ASSETS_AR
	,GIS_ASSETS_REAL_RENT_AR
   	 ) S
 ) B
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>        			
	           			

<!-- 소재지 지번 자산명 총면적 사용면적 실제임대면적 NVL(SUM(gac.GIS_ASSETS_REAL_RENT_AR)- SUM(B.USAGE_AR),0) -->

</select>


<select id="gamFcltyUseUnuseSttusInqireDao.selectFcltyUseUnuseSttusInqireListTotCnt_S" parameterClass="gamFcltyUseUnuseSttusInqireVO" resultClass="int">
		SELECT 
    	  COUNT(*) TOTCNT
    	FROM
    	 GIS_ASSETS_CD_F A
	LEFT OUTER JOIN 
		ASSETS_RENT_DETAIL_F C
	ON 	
		A.GIS_ASSETS_PRT_AT_CODE = C.GIS_ASSETS_PRT_AT_CODE
	AND A.GIS_ASSETS_CD = C.GIS_ASSETS_CD
	AND A.GIS_ASSETS_SUB_CD = C.GIS_ASSETS_SUB_CD
 	WHERE
 	A.GIS_ASSETS_AR IS NOT NULL

	 					<isNotEmpty property="searchPrtAtCode">
	           				AND A.GIS_ASSETS_PRT_AT_CODE = #searchPrtAtCode#
	           			</isNotEmpty>
						  <isNotEmpty property="searchFcltyNm">
						  	AND A.GIS_ASSETS_NM LIKE '%' || #searchFcltyNm# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchLoc">
						    AND A.GIS_ASSETS_LOCPLC LIKE '%' || #searchLoc# || '%'
						  </isNotEmpty>
						  <isNotEmpty property="searchDtFr">
						 <![CDATA[ AND C.USAGE_PD_FROM >= TO_DATE(#searchDtFr#, 'yyyy-mm-dd') ]]>
					        </isNotEmpty>
					        <isNotEmpty property="searchDtTo">
						<![CDATA[ AND C.USAGE_PD_TO < TO_DATE(#searchDtTo#, 'yyyy-mm-dd') + 1 ]]>
								        </isNotEmpty>
</select>


</sqlMap>






