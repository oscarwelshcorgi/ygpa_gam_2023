<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="ygpa.gam.soc">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamSocExmpMngtVO" type="egovframework.rte.ygpa.gam.soc.service.GamSocExmpMngtVO" />
	
	<resultMap id="gamSocExmpMngtSearchMap" class="egovframework.rte.ygpa.gam.soc.service.GamSocExmpMngtVO">
		<result property="appPrtAtCode" column="APP_PRT_AT_CODE" columnIndex="1"/>
		<result property="appPrtAtKorNm" column="APP_PRT_AT_KOR_NM" columnIndex="2"/>
		<result property="feeTp" column="FEE_TP" columnIndex="3"/>
		<result property="fiscalYr" column="FISCAL_YR" columnIndex="4"/>
		<result property="socNo" column="SOC_NO" columnIndex="5"/>
		<result property="appAgentCode" column="APP_AGENT_CODE" columnIndex="6"/>
		<result property="appAgentName" column="APP_AGENT_NAME" columnIndex="7"/>
		<result property="useNo" column="USE_NO" columnIndex="8"/>
        <result property="prtAtCode" column="PRT_AT_CODE" columnIndex="9"/>
		<result property="prtAtKorNm" column="PRT_AT_KOR_NM" columnIndex="10"/>
		<result property="cmplYr" column="CMPL_YR" columnIndex="11"/>
		<result property="constNo" column="CONST_NO" columnIndex="12"/>
		<result property="exmpAgentCode" column="EXMP_AGENT_CODE" columnIndex="13"/>
		<result property="exmpAgentName" column="EXMP_AGENT_NAME" columnIndex="14"/>
		<result property="vsslKey" column="VSSL_KEY" columnIndex="15"/>
		<result property="yr" column="YR" columnIndex="16"/>
		<result property="serNo" column="SER_NO" columnIndex="17"/>
		<result property="billNo" column="BILL_NO" columnIndex="18"/>
		<result property="exmpAmnt" column="EXMP_AMNT" columnIndex="19"/>
		<result property="inOut" column="IN_OUT" columnIndex="20"/>
		<result property="inOutName" column="IN_OUT_NM" columnIndex="21"/>
		<result property="billUseNo" column="BILL_USE_NO" columnIndex="22"/>
		<result property="facCode" column="FAC_CODE" columnIndex="23"/>
		<result property="facSubCode" column="FAC_SUB_CODE" columnIndex="24"/>
		<result property="facKorNm" column="FAC_KOR_NM" columnIndex="25"/>
		<result property="ioDt" column="IO_DT" columnIndex="26"/>
		<result property="dcCode" column="DC_CODE" columnIndex="27"/>
		<result property="dcRate" column="DC_RATE" columnIndex="28"/>
		<result property="billDt" column="BILL_DT" columnIndex="29"/>
		<result property="standardFee" column="STANDARD_FEE" columnIndex="30"/>
		<result property="realTn" column="REAL_TN" columnIndex="31"/>
		<result property="remark" column="REMARK" columnIndex="32"/>
		<result property="exmpType" column="EXMP_TYPE" columnIndex="33"/>
		<result property="updtUid" column="UPDT_UID" columnIndex="34" />
		<result property="updtDate" column="UPDT_DATE" columnIndex="35"/>
		<result property="callLetter" column="CALL_LETTER" columnIndex="36"/>
		<result property="callLetterNm" column="CALL_LETTER_NM" columnIndex="37"/>
		<result property="dcRateNm" column="DC_RATE_NM" columnIndex="38"/>
		<result property="exmpPrtAtCode" column="EXMP_PRT_AT_CODE" columnIndex="39"/>
		<result property="exmpPrtAtKorNm" column="EXMP_PRT_AT_KOR_NM" columnIndex="40"/>
		<result property="jingsuja" column="JINGSUJA" columnIndex="41"/>
	</resultMap>
	
	<select id="gamSocExmpMngtDAO.selectSocExmpMngtDetail_D" parameterClass="gamSocExmpMngtVO" resultMap="gamSocExmpMngtSearchMap">
		SELECT
				E.APP_PRT_AT_CODE
				, P2MGR.SF_PRT_AT_NM(E.APP_PRT_AT_CODE) APP_PRT_AT_KOR_NM
				, E.FEE_TP
				, E.FISCAL_YR
				, E.SOC_NO
				, E.APP_AGENT_CODE
		  		, P2MGR.SF_AGENT_NM(E.APP_AGENT_CODE) APP_AGENT_NAME
				, E.USE_NO
				, E.PRT_AT_CODE
		  		, P2MGR.SF_PRT_AT_NM(E.PRT_AT_CODE) PRT_AT_KOR_NM
		  		, E.CMPL_YR
		  		, E.CONST_NO
		  		, E.EXMP_AGENT_CODE
		  		, P2MGR.SF_AGENT_NM(E.EXMP_AGENT_CODE) EXMP_AGENT_NAME
		  		, E.VSSL_KEY
		  		, E.YR
		  		, E.SER_NO
		  		, E.BILL_NO
		  		, NVL(E.EXMP_AMNT, 0) EXMP_AMNT
		  		, E.IN_OUT
		  		, DECODE(E.FEE_TP, 'L0', DECODE(E.IN_OUT, '1', '외항입항', '2', '외항출항', '3', '내항입항', '4','내항출항',''),
		  			DECODE(E.IN_OUT, '1', '외항', '2', '내항', '') ) IN_OUT_NM
		  		, E.BILL_USE_NO
		  		, E.FAC_CODE
		  		, E.FAC_SUB_CODE
		  		, P2MGR.SF_FACIL_NM(E.PRT_AT_CODE, E.FAC_CODE, E.FAC_SUB_CODE) FAC_KOR_NM
		  		, TO_CHAR(E.IO_DT, 'YYYY-MM-DD') AS IO_DT
		  		, E.DC_CODE
		  		, E.DC_RATE
		  		, TO_CHAR(E.BILL_DT, 'YYYY-MM-DD') AS BILL_DT
		  		, NVL(E.STANDARD_FEE, 0) STANDARD_FEE
		  		, TO_CHAR(E.REAL_TN) AS REAL_TN
		  		, E.REMARK
		  		, E.EXMP_TYPE
		  		, E.UPDT_UID
		  		, TO_CHAR(E.UPDT_DATE, 'YYYY-MM-DD') AS UPDT_DATE
		  		, E.CALL_LETTER
		  		, (SELECT VSSL_KOR_NM FROM P2MGR.VSSL_F@YGPA_P2MGR WHERE VSSL_KEY = E.CALL_LETTER) CALL_LETTER_NM
		  		, E.DC_RATE_NM
		  		, E.EXMP_PRT_AT_CODE
		  		, P2MGR.SF_PRT_AT_NM(E.EXMP_PRT_AT_CODE) EXMP_PRT_AT_KOR_NM
		  		, E.JINGSUJA
		FROM 
				P2MGR.SOC_EXMP_F@YGPA_P2MGR E
		WHERE 
				1 = 1
			  <isNotEmpty prepend="AND" property="sAppPrtAtCode">
				E.APP_PRT_AT_CODE=#sAppPrtAtCode#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="sFeeTp">
				E.FEE_TP=#sFeeTp#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="sFiscalYr">
				E.FISCAL_YR=#sFiscalYr#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="sSocNo">
				E.SOC_NO=#sSocNo#
			  </isNotEmpty>
	</select>

	<select id="gamSocExmpMngtDAO.selectSocExmpMngtDetailTotCnt_S" parameterClass="gamSocExmpMngtVO" resultClass="int">
		SELECT
				COUNT(*) TOTCNT
		FROM
				P2MGR.SOC_EXMP_F@YGPA_P2MGR E
		WHERE 
				1 = 1
			  <isNotEmpty prepend="AND" property="appPrtAtCode">
				E.APP_PRT_AT_CODE=#appPrtAtCode#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="feeTp">
				E.FEE_TP=#feeTp#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="fiscalYr">
				E.FISCAL_YR=#fiscalYr#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="socNo">
				E.SOC_NO=#socNo#
			  </isNotEmpty>
	</select>

	<select id="gamSocExmpMngtDAO.selectSocExmpMngtGetNextSocNo" parameterClass="gamSocExmpMngtVO" resultClass="String">
		SELECT LPAD(NVL(MAX(TO_NUMBER(SOC_NO)),0) + 1,'6','0')				
		FROM
				P2MGR.SOC_EXMP_F@YGPA_P2MGR E
		WHERE 
				1 = 1
			  <isNotEmpty prepend="AND" property="sAppPrtAtCode">
				E.APP_PRT_AT_CODE=#sAppPrtAtCode#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="sFeeTp">
				E.FEE_TP=#sFeeTp#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="sFiscalYr">
				E.FISCAL_YR=#sFiscalYr#
			  </isNotEmpty>
	</select>
	
	<insert id="gamSocExmpMngtDAO.insertSocExmpMngtDetail" parameterClass="gamSocExmpMngtVO">
		INSERT INTO P2MGR.SOC_EXMP_F@YGPA_P2MGR
			(
				APP_PRT_AT_CODE
				, FEE_TP
				, FISCAL_YR
				, SOC_NO
				, APP_AGENT_CODE
				, USE_NO
				, PRT_AT_CODE
				, CMPL_YR
				, CONST_NO
				, UPDT_DATE
				, EXMP_AGENT_CODE
				, VSSL_KEY
				, YR
				, SER_NO
				, BILL_NO
				, EXMP_AMNT
				, IN_OUT
				, BILL_USE_NO
				, FAC_CODE
				, FAC_SUB_CODE
				, IO_DT
				, DC_CODE
				, DC_RATE
				, BILL_DT
				, STANDARD_FEE
				, REAL_TN
				, REMARK
				, EXMP_TYPE
				, UPDT_UID
				, CALL_LETTER
				, DC_RATE_NM
				, EXMP_PRT_AT_CODE
				, JINGSUJA
			) 
		VALUES
			(
				#appPrtAtCode#
				, #feeTp#
				, #fiscalYr#
				, #socNo#
				, #appAgentCode#
				, #useNo#
				, #prtAtCode#
				, #cmplYr#
				, #constNo#
				, SYSDATE
				, #exmpAgentCode#
				, #vsslKey#
				, #yr#
				, #serNo#
				, #billNo#
				, TO_NUMBER(REPLACE(#exmpAmnt#, ',', ''))
				, #inOut#
				, #billUseNo#
				, #facCode#
				, #facSubCode#
				, TO_DATE(#ioDt#, 'YYYY-MM-DD')
				, #dcCode#
				, #dcRate#
				, TO_DATE(#billDt#, 'YYYY-MM-DD')
				, TO_NUMBER(REPLACE(#standardFee#, ',', ''))
				, TO_NUMBER(REPLACE(#realTn#, ',', ''))
				, #remark#
				, #exmpType#
				, #updtUid#
				, #callLetter#
				, #dcRateNm#
				, #exmpPrtAtCode#
				, #jingsuja#
			)
	</insert>
	
	<update id="gamSocExmpMngtDAO.updateSocExmpMngtDetail" parameterClass="gamSocExmpMngtVO">
		UPDATE P2MGR.SOC_EXMP_F@YGPA_P2MGR SET
				APP_AGENT_CODE = #appAgentCode#
				, USE_NO = #useNo#
				, PRT_AT_CODE = #prtAtCode#
				, CMPL_YR = #cmplYr#
				, CONST_NO = #constNo#
				, UPDT_DATE = SYSDATE
				, EXMP_AGENT_CODE = #exmpAgentCode#
				, VSSL_KEY = #vsslKey#
				, YR = #yr#
				, SER_NO = #serNo#
				, BILL_NO = #billNo#
				, EXMP_AMNT = TO_NUMBER(REPLACE(#exmpAmnt#, ',', ''))
				, IN_OUT = #inOut#
				, BILL_USE_NO = #billUseNo#
				, FAC_CODE = #facCode#
				, FAC_SUB_CODE = #facSubCode#
				, IO_DT = #ioDt#
				, DC_CODE = #dcCode#
				, DC_RATE = #dcRate#
				, BILL_DT = #billDt#
				, STANDARD_FEE = TO_NUMBER(REPLACE(#standardFee#, ',', ''))
				, REAL_TN = TO_NUMBER(REPLACE(#realTn#, ',', ''))
				, REMARK = #remark#
				, EXMP_TYPE = #exmpType#
				, UPDT_UID = #updtUid#
				, CALL_LETTER = #callLetter#
				, DC_RATE_NM = #dcRateNm#
				, EXMP_PRT_AT_CODE = #exmpPrtAtCode#
				, JINGSUJA = #jingsuja#
		WHERE
				APP_PRT_AT_CODE=#appPrtAtCode#
				AND FEE_TP=#feeTp#
				AND FISCAL_YR=#fiscalYr#
				AND SOC_NO=#socNo#			
	</update>
	
	<delete id="gamSocExmpMngtDAO.deleteSocExmpMngtDetail" parameterClass="gamSocExmpMngtVO">
		DELETE FROM 
				P2MGR.SOC_EXMP_F@YGPA_P2MGR
		WHERE
				APP_PRT_AT_CODE=#appPrtAtCode#
				AND FEE_TP=#feeTp#
				AND FISCAL_YR=#fiscalYr#
				AND SOC_NO=#socNo#
	</delete>
</sqlMap>