<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ygpa.gam.oper.gnrl">

    <typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="gamPrtFcltyUsageConfmInqireVO" type="egovframework.rte.ygpa.gam.oper.gnrl.service.GamPrtFcltyUsageConfmInqireVO"/>

    <select id="gamPrtFcltyUsageConfmInqireDao.selectPrtFcltyUsageConfmInqireList_D" parameterClass="gamPrtFcltyUsageConfmInqireVO" resultClass="egovMap">
           SELECT A.*
           FROM (
                   SELECT  ROWNUM RNUM, S.*
                     FROM (
                           SELECT
							 A.PRT_AT_CODE,
							 (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM019' AND CD.CODE = A.PRT_AT_CODE AND ROWNUM = 1) PRT_AT_CODE_NM,
							 ( SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = A.ENTRPSCD AND ROWNUM = 1 ) AS ENTRPS_NM,
							 ( SELECT E.BIZRNO FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = A.ENTRPSCD AND ROWNUM = 1 ) AS BIZRNO,
							 ( SELECT E.RPRSNTV_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = A.ENTRPSCD AND ROWNUM = 1 ) AS RPRSNTV_NM,
							 (SELECT CONCAT(CONCAT(G.GIS_ASSETS_LOCPLC, ' '), CONCAT(G.GIS_ASSETS_LNM, NVL2(G.GIS_ASSETS_LNM_SUB, CONCAT('-', G.GIS_ASSETS_LNM_SUB), ''))) FROM GIS_ASSETS_CD_F G WHERE B.GIS_ASSETS_PRT_AT_CODE=G.GIS_ASSETS_PRT_AT_CODE AND B.GIS_ASSETS_CD=G.GIS_ASSETS_CD AND B.GIS_ASSETS_SUB_CD=G.GIS_ASSETS_SUB_CD) GIS_ASSETS_LOCPLC,
							B.USAGE_PURPS,
							 (SELECT DECODE(GIS_ASSETS_PRPRTY_SE_CD, 'L','부지','W','수역') FROM GIS_ASSETS_CD_F G WHERE B.GIS_ASSETS_PRT_AT_CODE=G.GIS_ASSETS_PRT_AT_CODE AND B.GIS_ASSETS_CD=G.GIS_ASSETS_CD AND B.GIS_ASSETS_SUB_CD=G.GIS_ASSETS_SUB_CD) GIS_ASSETS_PRPRTY_SE_CD_NM,
							 (SELECT CD.CODE_NM FROM COMTCCMMNDETAILCODE CD WHERE CD.CODE_ID = 'GAM011' AND CD.CODE = A.REQST_SE_CD AND ROWNUM = 1) REQST_SE_CD_NM,
							  NVL(A.GR_AR,0) GR_AR,
							  NVL(A.GR_FEE,0) GR_FEE,
							  TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-4, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-3, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1) PASS4,
							  TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-3, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-2, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1) PASS3,
							  TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-2, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-1, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1) PASS2,
							  TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-1, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY'), '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1) PASS1,
							  TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY'), '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')+1, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1) CURR_YEAR_FEE,
							  TO_CHAR((SELECT GR_USAGE_PD_FROM FROM ASSETS_RENT_F AR WHERE A.PRT_AT_CODE=AR.PRT_AT_CODE AND A.MNG_YEAR=AR.MNG_YEAR AND A.MNG_NO=AR.MNG_NO AND '01'=AR.MNG_CNT AND A.QUAY_GROUP_CD='G'), 'YYYY-MM-DD') FRST_USAGE_PD_FROM,
							  TO_CHAR(GR_USAGE_PD_FROM, 'YYYY-MM-DD') GR_USAGE_PD_FROM,
							  TO_CHAR(GR_USAGE_PD_TO, 'YYYY-MM-DD') GR_USAGE_PD_TO,
							  TRUNC(GR_USAGE_PD_TO-GR_USAGE_PD_FROM) USAGE_DAYS,
							  (SELECT EMP.USER_NM FROM COMTNEMPLYRINFO EMP WHERE EMP.EMPLYR_ID=A.PRMISN_USR) PRMISN_USR_NM
							FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F B
							WHERE 1=1
							  AND A.PRT_AT_CODE=B.PRT_AT_CODE
							  AND A.MNG_YEAR=B.MNG_YEAR
							  AND A.MNG_NO=B.MNG_NO
							  AND A.MNG_CNT=B.MNG_CNT
							  AND A.QUAY_GROUP_CD='G'
							  AND B.ASSETS_USAGE_SEQ='1'
							  AND GR_USAGE_PD_TO-GR_USAGE_PD_FROM>0
							  <isEmpty property="referYear">
							  <![CDATA[
							  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
							  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
							  ]]>
							  </isEmpty>
							  <isNotEmpty property="referYear">
							  <![CDATA[
							  AND TO_DATE(CONCAT(#referYear#-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
							  AND TO_DATE(CONCAT(#referYear#+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
							  ]]>
							  </isNotEmpty>
                             <isNotEmpty property="prtAtCode">
					             AND A.PRT_AT_CODE = #prtAtCode#
					         </isNotEmpty>
							ORDER BY A.PRT_AT_CODE
                ) S
             ) A
        <![CDATA[ WHERE ROWNUM <= #recordCountPerPage# and RNUM > #firstIndex# ]]>

    </select>

    <select id="gamPrtFcltyUsageConfmInqireDao.selectPrtFcltyUsageConfmInqireListTotCnt_S" parameterClass="gamPrtFcltyUsageConfmInqireVO" resultClass="int">
            SELECT COUNT(*) TOTCNT
			FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F B
			WHERE 1=1
			  AND A.PRT_AT_CODE=B.PRT_AT_CODE
			  AND A.MNG_YEAR=B.MNG_YEAR
			  AND A.MNG_NO=B.MNG_NO
			  AND A.MNG_CNT=B.MNG_CNT
			  AND A.QUAY_GROUP_CD='G'
			  AND B.ASSETS_USAGE_SEQ='1'
			  AND GR_USAGE_PD_TO-GR_USAGE_PD_FROM>0
			  <isEmpty property="referYear">
			  <![CDATA[
			  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
			  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
			  ]]>
			  </isEmpty>
			  <isNotEmpty property="referYear">
			  <![CDATA[
			  AND TO_DATE(CONCAT(#referYear#-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
			  AND TO_DATE(CONCAT(#referYear#+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
			  ]]>
		  </isNotEmpty>
			<isNotEmpty property="prtAtCode">
				AND A.PRT_AT_CODE = #prtAtCode#
			</isNotEmpty>
    </select>

    <select id="gamPrtFcltyUsageConfmInqireDao.selectPrtFcltyUsageConfmInqireSum_S" parameterClass="gamPrtFcltyUsageConfmInqireVO" resultClass="egovMap">
		SELECT
		  SUM(NVL(A.GR_AR,0)) GR_AR,
		  SUM(NVL(A.GR_FEE,0)) GR_FEE,
		  SUM(TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-4, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-3, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1)) PASS4,
		  SUM(TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-3, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-2, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1)) PASS3,
		  SUM(TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-2, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-1, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1)) PASS2,
		  SUM(TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')-1, '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY'), '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1)) PASS1,
		  SUM(TRUNC(GR_FEE/(GR_USAGE_PD_TO-GR_USAGE_PD_FROM)*GAM_GET_DIST_DAYS(TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY'), '0101'), 'YYYYMMDD'), TO_DATE(CONCAT(TO_CHAR(SYSDATE, 'YYYY')+1, '0101'), 'YYYYMMDD'), GR_USAGE_PD_FROM, GR_USAGE_PD_TO), -1)) CURR_YEAR
		FROM ASSETS_RENT_F A, ASSETS_RENT_DETAIL_F B
		WHERE 1=1
		  AND A.PRT_AT_CODE=B.PRT_AT_CODE
		  AND A.MNG_YEAR=B.MNG_YEAR
		  AND A.MNG_NO=B.MNG_NO
		  AND A.MNG_CNT=B.MNG_CNT
		  AND A.QUAY_GROUP_CD='G'
		  AND B.ASSETS_USAGE_SEQ='1'
		  AND GR_USAGE_PD_TO-GR_USAGE_PD_FROM>0
		  <isEmpty property="referYear">
		  <![CDATA[
		  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
		  AND TO_DATE(CONCAT(TO_CHAR(SYSDATE,'YYYY')+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
		  ]]>
		  </isEmpty>
		  <isNotEmpty property="referYear">
		  <![CDATA[
		  AND TO_DATE(CONCAT(#referYear#-5, '0101'), 'YYYYMMDD')<A.GR_USAGE_PD_TO
		  AND TO_DATE(CONCAT(#referYear#+1, '0101'), 'YYYYMMDD')>A.GR_USAGE_PD_FROM
		  ]]>
		  </isNotEmpty>
		<isNotEmpty property="prtAtCode">
			AND A.PRT_AT_CODE = #prtAtCode#
		</isNotEmpty>
    </select>

</sqlMap>