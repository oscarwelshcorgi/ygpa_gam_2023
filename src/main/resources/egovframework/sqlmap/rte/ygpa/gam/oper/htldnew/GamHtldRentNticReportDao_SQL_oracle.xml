<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ygpa.gam.oper.htldnew">
	
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    
	<typeAlias alias="gamHtldRentNticDefaultVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentNticDefaultVO"/>
	
	<!-- 원고지 마스터 출력 -->
	<select id="gamHtldRentNticReportDao.selectNticPrintMaster_S" parameterClass="gamHtldRentNticDefaultVO" resultClass="egovMap">
		  SELECT
		    P2MGR.sf_makedigit@YGPA_P2MGR(N.PRT_AT_CODE
		      || ASCII(SUBSTR(N.FEE_TP,1,1))
		      || SUBSTR(N.FEE_TP,2,1)
		      || N.FISCAL_YR
		      || N.BILL_NO
		      || NVL(N.ARRRG_NO, '0'),'BILLNO') CSTMR_REF_CODE
		    ,(
		        SELECT DECODE(N.PRT_AT_CODE, '620', '1', '621', '2', '3')
				      || FEE_TP_MAP
				      || SUBSTR(N.FISCAL_YR, 3,2)
				      || N.BILL_NO
				      || NVL(N.ARRRG_NO, '00')
				    FROM P2MGR.FEE_TP_F@YGPA_P2MGR
				    WHERE PRT_AT_CODE = N.PRT_AT_CODE
		          AND FEE_TP      = N.FEE_TP
		    ) ELEC_PAY_NO
		    ,DECODE(N.PRT_AT_CODE, '622', '6374594', '6374604') GIRO_NO
		    ,P2MGR.sf_makedigit@YGPA_P2MGR(N.BILL_AMNT, 'AMT') ELEC_NTIC_AMT
		    ,N.*
		  FROM  
		  (
		    SELECT
		      R.PRT_AT_CODE
		      ,R.FISCAL_YR
		      ,R.FEE_TP
		      ,R.BILL_NO
		      ,R.BILL_AMNT
		      ,N.SUP_AMT
		      ,N.VAT
		      ,N.RM
		      ,R.AGENT_CODE
		      ,R.AGENT_NAME
		      ,TO_CHAR(N.NTIC_PD_FROM, 'YYYY-MM-DD') NTIC_PD_FROM
		      ,TO_CHAR(N.NTIC_PD_TO, 'YYYY-MM-DD') NTIC_PD_TO
		      ,TO_CHAR(R.BILL_DT, 'YYYY-MM-DD') NTIC_DT
		      ,'00' ARRRG_NO
		      ,NVL(N.INTR_RATE, 0) * 100 INTR_RATE 
		      ,(SELECT RPRSNTV_NM FROM ENTRPS_INFO_F WHERE ENTRPSCD=R.AGENT_CODE) RPRSNTV_NM
		      ,(SELECT ADRES FROM ENTRPS_INFO_F WHERE ENTRPSCD=R.AGENT_CODE) ADRES
		      ,(SELECT ADRES2 FROM ENTRPS_INFO_F WHERE ENTRPSCD=R.AGENT_CODE) ADRES2
		      ,(SELECT ZIP FROM ENTRPS_INFO_F WHERE ENTRPSCD=R.AGENT_CODE) ZIP
		      ,GAM_GET_FEE_TP_NM(R.PRT_AT_CODE, 'H', DECODE(R.FEE_TP, 'V2', 'A3',R.WORK_CODE)) CHRGE_KND_NM
		      ,R.BZ_RGST_ID
		      ,TO_CHAR(R.BILL_DT, 'YYYY-MM-DD') BILL_DT
		      ,TO_CHAR(R.DUE_DATE, 'YYYY-MM-DD') DUE_DATE
		      ,N.PAY_SE  
		      ,DECODE(RPAD(TO_CHAR(TO_DATE(TO_CHAR(N.NTIC_PD_FROM, 'YYYYMMDDhh24MISS'), 'YYYYMMDDhh24MISS'),'q'), 3, '/4'), '1/4', '1', '2/4', '2', '3/4', '3', '4/4', '4') QUARTER
		    FROM
		      HTLD_NTIC_DTLS_F N, REV_COLL_F R
		    WHERE
		      R.PRT_AT_CODE = '622'
		      AND N.ACCNUT_YEAR = R.FISCAL_YR
		      AND GAM_GET_HTLD_FEE_TP(N.CHRGE_KND_CD) = R.FEE_TP
		      AND N.NTIC_NO = R.BILL_NO
		      AND N.ACCNUT_YEAR = #accnutYear#
		      AND N.RNTFEE_NTIC_NO = #rntfeeNticNo#
		      AND N.NTIC_SEQ = #nticSeq#
		  ) N	
	</select>

	<!-- 연체고지 마스터 출력 -->
	<select id="gamHtldRentNticReportDao.selectArrrgNticPrintMaster_S" parameterClass="gamHtldRentNticDefaultVO" resultClass="egovMap">
		  SELECT
		    P2MGR.sf_makedigit@YGPA_P2MGR(N.PRT_AT_CODE
		    || ASCII(SUBSTR(N.FEE_TP,1,1))
		    || SUBSTR(N.FEE_TP,2,1)
		    || N.FISCAL_YR
		    || N.BILL_NO
		    || NVL(N.ARRRG_NO, '0'),'BILLNO') CSTMR_REF_CODE,
		    (SELECT DECODE(N.PRT_AT_CODE, '620', '1', '621', '2', '3')
		      || FEE_TP_MAP
		      || SUBSTR(N.FISCAL_YR, 3,2)
		      || N.BILL_NO
		      || NVL(N.ARRRG_NO, '00')
		    FROM P2MGR.FEE_TP_F@YGPA_P2MGR
		    WHERE PRT_AT_CODE = N.PRT_AT_CODE
		    AND FEE_TP        = N.FEE_TP
		    ) ELEC_PAY_NO,
		    DECODE(N.PRT_AT_CODE, '622', '6374594', '6374604') GIRO_NO,
		    P2MGR.sf_makedigit@YGPA_P2MGR(N.BILL_AMNT, 'AMT') ELEC_NTIC_AMT,
		    N.*
		  FROM  
		  (
		    SELECT
		      U.PRT_AT_CODE
		      ,U.FISCAL_YR
		      ,U.FEE_TP
		      ,U.BILL_NO
		      ,U.DLY_BILL_AMNT ARRRG_AMT
		      ,U.DJIRO_AMNT BILL_AMNT
		      ,U.DLY_BILL_RSN
		      ,N.SUP_AMT
		      ,N.VAT
		      ,N.RM
		      ,U.AGENT_CODE
		      ,(SELECT ENTRPS_NM FROM ENTRPS_INFO_F WHERE ENTRPSCD = U.AGENT_CODE) AGENT_NAME
		      ,TO_CHAR(N.NTIC_PD_FROM, 'YYYY-MM-DD') NTIC_PD_FROM
		      ,TO_CHAR(N.NTIC_PD_TO, 'YYYY-MM-DD') NTIC_PD_TO
		      ,TO_CHAR(U.DLY_BILL_DT, 'YYYY-MM-DD') NTIC_DT
		      ,U.DLY_SER_NO ARRRG_NO
		      ,NVL(N.INTR_RATE, 0) * 100 INTR_RATE 
		      ,(SELECT RPRSNTV_NM FROM ENTRPS_INFO_F WHERE ENTRPSCD=U.AGENT_CODE) RPRSNTV_NM
		      ,(SELECT ADRES FROM ENTRPS_INFO_F WHERE ENTRPSCD=U.AGENT_CODE) ADRES
		      ,(SELECT ADRES2 FROM ENTRPS_INFO_F WHERE ENTRPSCD=U.AGENT_CODE) ADRES2
		      ,(SELECT ZIP FROM ENTRPS_INFO_F WHERE ENTRPSCD=U.AGENT_CODE) ZIP
		      ,GAM_GET_FEE_TP_NM(U.PRT_AT_CODE, 'H', DECODE(U.FEE_TP, 'V2', 'A3',U.WORK_CODE)) CHRGE_KND_NM
		      ,U.BZ_RGST_ID
		      ,TO_CHAR(U.DLY_BILL_DT, 'YYYY-MM-DD') BILL_DT
		      ,TO_CHAR(U.DLY_DUE_DT, 'YYYY-MM-DD') DUE_DATE
		      ,N.PAY_SE  
		      ,DECODE(RPAD(TO_CHAR(TO_DATE(TO_CHAR(N.NTIC_PD_FROM, 'YYYYMMDDhh24MISS'), 'YYYYMMDDhh24MISS'),'q'), 3, '/4'), '1/4', '1', '2/4', '2', '3/4', '3', '4/4', '4') QUARTER
		    FROM
		      HTLD_NTIC_DTLS_F N, UNPAID_F U
		    WHERE
		      U.PRT_AT_CODE = '622'
	          AND N.ACCNUT_YEAR = U.FISCAL_YR
	          AND GAM_GET_HTLD_ARRRG_CHRGE_KND(N.CHRGE_KND_CD)=U.WORK_CODE
	          AND N.NTIC_NO = U.BILL_NO
		      AND U.FEE_TP = GAM_GET_HTLD_FEE_TP(GAM_GET_HTLD_ARRRG_CHRGE_KND(N.CHRGE_KND_CD))		     
		      AND N.ACCNUT_YEAR = #accnutYear#
		      AND N.RNTFEE_NTIC_NO = #rntfeeNticNo#
		      AND N.NTIC_SEQ = #nticSeq#
		      AND U.DLY_SER_NO = #dlySerNo#
		  ) N
	</select>
	
	<!-- 출력용 고지 상세 리스트 조회 -->
	<select id="gamHtldRentNticReportDao.selectNticIssueList_D" parameterClass="gamHtldRentNticDefaultVO" resultClass="egovMap">
		SELECT
			L.*
		FROM
		(			
			(
				SELECT
					F.MNG_YEAR MNG_YEAR
					,F.MNG_NO MNG_NO
					,F.MNG_SEQ MNG_SEQ
					,F.RENT_DETAIL_REGIST_SEQ RENT_DETAIL_REGIST_SEQ
					,F.RNTFEE_SEQ RNTFEE_SEQ
					,R.PAY_SE PAY_SE
					,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
					,NVL(D.RENT_AR, 0) RENT_AR
					,TO_CHAR(NVL(D.RENT_AR, 0), '9,999,999,999.99') RENT_AR_STR
					,D.RENT_AR_SE RENT_AR_SE
					,DECODE(D.RENT_AR_SE, '1', '물류부지', '2', '제조부지', '3', '숙성실', '') RENT_AR_SE_NM
					,NVL(D.APPLC_RNTFEE, 0) APPLC_RNTFEE
					,TO_CHAR(D.DETAIL_PD_BEGIN, 'YYYY-MM-DD') DETAIL_PD_BEGIN
					,TO_CHAR(D.DETAIL_PD_END, 'YYYY-MM-DD') DETAIL_PD_END			
					,TO_CHAR(NVL(D.APPLC_RNTFEE, 0), '9,999,999,999.99') APPLC_RNTFEE_STR
					,D.PRICE_SE PRICE_SE
					,DECODE(D.PRICE_SE, '1', '면적당단가', '2', '월단가','') PRICE_SE_NM
					,NVL(D.ASE_RNTFEE, 0) ASE_RNTFEE
					,TO_CHAR(NVL(D.ASE_RNTFEE, 0), '9,999,999,999.99') ASE_RNTFEE_STR
					,TO_CHAR(D.ASE_APPLC_BEGIN, 'YYYY-MM-DD') ASE_APPLC_BEGIN
					,TO_CHAR(D.ASE_APPLC_END, 'YYYY-MM-DD') ASE_APPLC_END
					,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
					,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
					,TO_CHAR(F.APPLC_BEGIN_DT, 'YYYY-MM-DD') APPLC_BEGIN_DT
					,TO_CHAR(F.APPLC_END_DT, 'YYYY-MM-DD') APPLC_END_DT
					,TO_CHAR(NVL(F.APPLC_RNTFEE, 0), '9,999,999,999.99') APP_RNTFEE
					,NVL(F.APPLC_RENT_AR, 0) APPLC_RENT_AR
					,NVL(F.RNTFEE, 0) RNTFEE
					,NVL(F.RNTFEE_SE, '0') RNTFEE_SE
					,F.RNTFEE_SE_NM RNTFEE_SE_NM
					,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
					,F.ACCNUT_YEAR ACCNUT_YEAR 
					,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
					,F.NTIC_SEQ NTIC_SEQ
					,(SELECT TO_CHAR(NTIC_DT, 'YYYY-MM-DD') FROM HTLD_NTIC_DTLS_F WHERE F.ACCNUT_YEAR = ACCNUT_YEAR AND F.RNTFEE_NTIC_NO = RNTFEE_NTIC_NO AND F.NTIC_SEQ = NTIC_SEQ) NTIC_DT
					,(SELECT GIS_ASSETS_LOCPLC FROM GIS_ASSETS_CD_F WHERE 
						ROWNUM =1 AND GIS_ASSETS_PRT_AT_CODE=D.GIS_ASSETS_PRT_AT_CODE AND GIS_ASSETS_CD=D.GIS_ASSETS_CD AND GIS_ASSETS_SUB_CD=D.GIS_ASSETS_SUB_CD
			        	) GIS_ASSETS_LOCPLC
			        ,(SELECT GIS_ASSETS_LNM FROM GIS_ASSETS_CD_F WHERE
			        	ROWNUM=1 AND GIS_ASSETS_PRT_AT_CODE=D.GIS_ASSETS_PRT_AT_CODE AND GIS_ASSETS_CD=D.GIS_ASSETS_CD AND GIS_ASSETS_SUB_CD=D.GIS_ASSETS_SUB_CD
			        	) GIS_ASSETS_LNM
			        ,(SELECT GIS_ASSETS_LNM_SUB FROM GIS_ASSETS_CD_F WHERE 
			        	ROWNUM=1 AND GIS_ASSETS_PRT_AT_CODE=D.GIS_ASSETS_PRT_AT_CODE AND GIS_ASSETS_CD=D.GIS_ASSETS_CD AND GIS_ASSETS_SUB_CD=D.GIS_ASSETS_SUB_CD
			        	) GIS_ASSETS_LNM_SUB
				FROM
				    HTLD_RNTFEE_F F
				LEFT OUTER JOIN
					(SELECT A.* FROM HTLD_RENT_DETAIL_HIST_F A WHERE A.HIST_SEQ = #histSeq#) D
					ON F.MNG_YEAR = D.MNG_YEAR AND F.MNG_NO = D.MNG_NO AND F.MNG_SEQ = D.MNG_SEQ 
						AND (F.RENT_DETAIL_REGIST_SEQ IS NULL OR F.RENT_DETAIL_REGIST_SEQ = D.REGIST_SEQ)
				INNER JOIN
					(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = #histSeq#) R
					ON F.MNG_YEAR = R.MNG_YEAR AND F.MNG_NO = R.MNG_NO AND F.MNG_SEQ = R.MNG_SEQ
				WHERE
					F.MNG_YEAR = #mngYear#
					AND F.MNG_NO = #mngNo#
					AND F.MNG_SEQ = #mngSeq#
					AND F.ACCNUT_YEAR = #accnutYear#
					AND F.RNTFEE_NTIC_NO = #rntfeeNticNo#
					AND F.NTIC_SEQ = #nticSeq#
					AND (F.RNTFEE_SE = '0' OR F.RNTFEE_SE = '1' OR F.RNTFEE_SE = '2')
			) 
			UNION ALL
			(
				SELECT
					F.MNG_YEAR MNG_YEAR
					,F.MNG_NO MNG_NO
					,F.MNG_SEQ MNG_SEQ
					,F.RENT_DETAIL_REGIST_SEQ RENT_DETAIL_REGIST_SEQ
					,F.RNTFEE_SEQ RNTFEE_SEQ
					,R.PAY_SE PAY_SE
					,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
					,0 RENT_AR
					,TO_CHAR(0, '9,999,999,999.99') RENT_AR_STR
					,'' RENT_AR_SE
					,'' RENT_AR_SE_NM
					,0 APPLC_RNTFEE
					,NULL DETAIL_PD_BEGIN
					,NULL DETAIL_PD_END			
					,TO_CHAR(0, '9,999,999,999.99') APPLC_RNTFEE_STR
					,'' PRICE_SE
					,'' PRICE_SE_NM
					,0 ASE_RNTFEE
					,TO_CHAR(0, '9,999,999,999.99') ASE_RNTFEE_STR
					,'' ASE_APPLC_BEGIN
					,'' ASE_APPLC_END
					,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
					,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
					,TO_CHAR(F.APPLC_BEGIN_DT, 'YYYY-MM-DD') APPLC_BEGIN_DT
					,TO_CHAR(F.APPLC_END_DT, 'YYYY-MM-DD') APPLC_END_DT
					,TO_CHAR(NVL(F.APPLC_RNTFEE, 0), '9,999,999,999.99') APP_RNTFEE
					,0 APPLC_RENT_AR
					,NVL(F.RNTFEE, 0) RNTFEE
					,NVL(F.RNTFEE_SE, '0') RNTFEE_SE
					,F.RNTFEE_SE_NM RNTFEE_SE_NM
					,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
					,F.ACCNUT_YEAR ACCNUT_YEAR 
					,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
					,F.NTIC_SEQ NTIC_SEQ
					,(SELECT TO_CHAR(NTIC_DT, 'YYYY-MM-DD') FROM HTLD_NTIC_DTLS_F WHERE F.ACCNUT_YEAR = ACCNUT_YEAR AND F.RNTFEE_NTIC_NO = RNTFEE_NTIC_NO AND F.NTIC_SEQ = NTIC_SEQ) NTIC_DT
					,'' GIS_ASSETS_LOCPLC
			        ,'' GIS_ASSETS_LNM
			        ,'' GIS_ASSETS_LNM_SUB
				FROM
				    HTLD_RNTFEE_F F
				INNER JOIN
					(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = #histSeq#) R
					ON F.MNG_YEAR = R.MNG_YEAR AND F.MNG_NO = R.MNG_NO AND F.MNG_SEQ = R.MNG_SEQ
				WHERE
					F.MNG_YEAR = #mngYear#
					AND F.MNG_NO = #mngNo#
					AND F.MNG_SEQ = #mngSeq#
					AND F.ACCNUT_YEAR = #accnutYear#
					AND F.RNTFEE_NTIC_NO = #rntfeeNticNo#
					AND F.NTIC_SEQ = #nticSeq#
					AND F.RNTFEE_SE = '3'		
			)
		) L
		ORDER BY L.RNTFEE_SE, L.RNTFEE_SEQ
	</select>
	
</sqlMap>