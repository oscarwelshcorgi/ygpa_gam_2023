<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="ygpa.gam.oper.htldnew">
	
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    
	<typeAlias alias="GamHtldRentMngtMainVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentMngtMainVO"/>
	
	<!-- 배후단지 임대 상세목록 조회 -->
	<select id="gamHtldRentMngtMainDao.selectHtldRentDetailList_D" parameterClass="GamHtldRentMngtMainVO" resultClass="egovMap">
		SELECT
		  D.MNG_YEAR MNG_YEAR
		  ,D.MNG_NO MNG_NO
		  ,D.MNG_SEQ MNG_SEQ
		  ,D.REGIST_SEQ REGIST_SEQ
		  ,F.RNTFEE_SEQ RNTFEE_SEQ
		  ,R.ENTRPS_CD ENTRPS_CD
		  ,(SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = R.ENTRPS_CD) ENTRPS_NM
		  ,R.BOUND_CD BOUND_CD 
		  ,GAM_GETCODENAME('GAM062', R.BOUND_CD) BOUND_NM
		  ,R.PAY_SE PAY_SE
		  ,TO_CHAR(R.CTRT_BEGIN_DT, 'YYYY-MM-DD') CTRT_BEGIN_DT
		  ,TO_CHAR(R.CTRT_END_DT, 'YYYY-MM-DD') CTRT_END_DT
		  ,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
		  ,R.CHRGE_KND_CD CHRGE_KND_CD
		  ,GAM_GETCODENAME('GAM053', R.CHRGE_KND_CD) CHRGE_KND_NM
		  ,TO_CHAR(R.TERMN_DT, 'YYYY-MM-DD') TERMN_DT
		  ,DECODE(R.TERMN_DT, NULL, 'N', 'Y') TERMN_YN
		  ,TO_CHAR(D.DETAIL_PD_BEGIN, 'YYYY-MM-DD') DETAIL_PD_BEGIN
		  ,TO_CHAR(D.DETAIL_PD_END, 'YYYY-MM-DD') DETAIL_PD_END
		  ,NVL(D.RENT_AR, 0) RENT_AR
		  ,TO_CHAR(NVL(D.RENT_AR, 0), '9,999,999,999.99') RENT_AR_STR
		  ,D.RENT_AR_SE RENT_AR_SE
		  ,DECODE(D.RENT_AR_SE, '1', '물류부지', '2', '제조부지', '3', '숙성실', '') RENT_AR_SE_NM
		  ,NVL(D.APPLC_RNTFEE, 0) APPLC_RNTFEE
		  ,TO_CHAR(NVL(D.APPLC_RNTFEE, 0), '9,999,999,999.99') APPLC_RNTFEE_STR
		  ,D.PRICE_SE
		  ,DECODE(D.PRICE_SE, '1', '면적당단가', '2', '월단가','') PRICE_SE_NM
		  ,NVL(D.ASE_RNTFEE, 0) ASE_RNTFEE
		  ,TO_CHAR(NVL(D.ASE_RNTFEE, 0), '9,999,999,999.99') ASE_RNTFEE_STR
		  ,TO_CHAR(D.ASE_APPLC_BEGIN, 'YYYY-MM-DD') ASE_APPLC_BEGIN
		  ,TO_CHAR(D.ASE_APPLC_END, 'YYYY-MM-DD') ASE_APPLC_END
		  ,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
		  ,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
		  ,NVL(F.RNTFEE, 0) RNTFEE
		  ,F.RNTFEE_SE RNTFEE_SE
		  ,DECODE(F.RNTFEE_SE, '1', '실적평가 정산분', '2', '지적측정 정산분', '') RNTFEE_SE_NM
		  ,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
		  ,NVL(F.SUP_AMT, 0) SUP_AMT
		  ,NVL(F.VAT, 0) VAT
		  ,NVL(F.PAY_AMT, 0) PAY_AMT 
		  ,F.ACCNUT_YEAR ACCNUT_YEAR 
		  ,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
		  ,F.NTIC_SEQ NTIC_SEQ
	      ,DECODE(F.NTIC_SEQ, NULL, 'N', 'Y') NTIC_YN
		  ,F.RCIV_SE RCIV_SE
		  ,TO_CHAR(F.RCIV_DT, 'YYYY-MM-DD') RCIV_DT
		FROM
		  HTLD_RENT_DETAIL_F D
		LEFT OUTER JOIN
		  HTLD_RNTFEE_F F
		  ON D.MNG_YEAR = F.MNG_YEAR AND D.MNG_NO = F.MNG_NO AND D.MNG_SEQ = F.MNG_SEQ AND D.REGIST_SEQ = F.RENT_DETAIL_REGIST_SEQ
		INNER JOIN
		  HTLD_RENT_F R
		  ON D.MNG_YEAR = R.MNG_YEAR AND D.MNG_NO = R.MNG_NO AND D.MNG_SEQ = R.MNG_SEQ
		WHERE 1=1
			<isNotEmpty property="sNticDt" prepend="AND">
				<![CDATA[
				D.DETAIL_PD_BEGIN <= TO_DATE(#sNticDt#)
				AND D.DETAIL_PD_END >= TO_DATE(#sNticDt#)
				AND ((F.NTIC_BEGIN_DT <= TO_DATE(#sNticDt#) AND F.NTIC_END_DT >= TO_DATE(#sNticDt#)) OR (F.NTIC_BEGIN_DT IS NULL AND  F.NTIC_END_DT IS NULL ))
				]]>
			</isNotEmpty>
			<isEmpty property="sNticDt" prepend="AND">
				<![CDATA[
				D.DETAIL_PD_BEGIN <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
				AND D.DETAIL_PD_END >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
				AND ((F.NTIC_BEGIN_DT <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD')) AND F.NTIC_END_DT >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) OR (F.NTIC_BEGIN_DT IS NULL AND  F.NTIC_END_DT IS NULL ))
				]]>
			</isEmpty>
			<isNotEmpty property="sPaySe" prepend="AND">
				R.PAY_SE = #sPaySe#
			</isNotEmpty>
			<isNotEmpty property="sTermnYn" prepend="AND">
				DECODE(R.TERMN_DT, NULL, 'N', 'Y') = #sTermnYn#
			</isNotEmpty>
		ORDER BY
		  BOUND_CD, ENTRPS_CD, MNG_YEAR, MNG_NO, MNG_SEQ, REGIST_SEQ
	</select>
	
	<!-- Cofix 이자율 조회 -->
	<select id="gamHtldRentMngtMainDao.selectCofixIntrrate_S" parameterClass="GamHtldRentMngtMainVO" resultClass="java.lang.String">
		SELECT TO_CHAR(NEW_MANIP_AMT_STDR_INTRRATE * 100, '9.99') COFIX_INTRRATE
		FROM 
			COFIX_INTRRATE_F
		WHERE
			<isNotEmpty property="sNticDt">
				<![CDATA[
				OBJ_YRMT = (SELECT MAX(OBJ_YRMT) FROM COFIX_INTRRATE_F WHERE TO_DATE(TO_CHAR(ANNODT, 'YYYY-MM-DD'), 'YYYY-MM-DD') <= TO_DATE(GAM_GET_QUARTER_START_DATE(#sNticDt#), 'YYYY-MM-DD'))
				]]>
			</isNotEmpty>
			<isEmpty property="sNticDt">
				<![CDATA[
				OBJ_YRMT = (SELECT MAX(OBJ_YRMT) FROM COFIX_INTRRATE_F WHERE TO_DATE(TO_CHAR(ANNODT, 'YYYY-MM-DD'), 'YYYY-MM-DD') <= TO_DATE(GAM_GET_QUARTER_START_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD')), 'YYYY-MM-DD'))
				]]>
			</isEmpty>
	</select>
</sqlMap>