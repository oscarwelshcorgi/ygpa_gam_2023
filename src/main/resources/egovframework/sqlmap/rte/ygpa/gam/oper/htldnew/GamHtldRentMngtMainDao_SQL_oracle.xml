<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="ygpa.gam.oper.htldnew">
	
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="hashMap" type="java.util.HashMap"/>
    
	<typeAlias alias="GamHtldRentMngtMainVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentMngtMainVO"/>
	<typeAlias alias="GamHtldRentRntfeeVO" type="egovframework.rte.ygpa.gam.oper.htldnew.service.GamHtldRentRntfeeVO"/>
	
	<!-- 배후단지 임대 상세목록 조회 -->
	<select id="gamHtldRentMngtMainDao.selectHtldRentDetailList_D" parameterClass="GamHtldRentMngtMainVO" resultClass="egovMap">
		SELECT
			L.MNG_YEAR MNG_YEAR
			,L.MNG_NO MNG_NO
			,L.MNG_SEQ MNG_SEQ
			,L.REGIST_SEQ REGIST_SEQ
			,L.RNTFEE_SEQ RNTFEE_SEQ
			,L.ENTRPS_CD ENTRPS_CD
			,L.ENTRPS_NM ENTRPS_NM
			,L.BOUND_CD BOUND_CD 
			,L.BOUND_NM BOUND_NM
			,L.PAY_SE PAY_SE
			,L.CTRT_BEGIN_DT CTRT_BEGIN_DT
			,L.CTRT_END_DT CTRT_END_DT
			,L.PAY_SE_NM PAY_SE_NM
			,L.CHRGE_KND_CD CHRGE_KND_CD
			,L.CHRGE_KND_NM CHRGE_KND_NM
			,L.TERMN_DT TERMN_DT
			,L.TERMN_YN TERMN_YN
			,L.DETAIL_PD_BEGIN DETAIL_PD_BEGIN
			,L.DETAIL_PD_END DETAIL_PD_END
			,L.RENT_AR RENT_AR
			,L.RENT_AR_STR RENT_AR_STR
			,L.RENT_AR_SE RENT_AR_SE
			,L.RENT_AR_SE_NM RENT_AR_SE_NM
			,L.APPLC_RNTFEE APPLC_RNTFEE
			,L.APPLC_RNTFEE_STR APPLC_RNTFEE_STR
			,L.PRICE_SE PRICE_SE
			,L.PRICE_SE_NM PRICE_SE_NM
			,L.ASE_RNTFEE ASE_RNTFEE
			,L.ASE_RNTFEE_STR ASE_RNTFEE_STR
			,L.ASE_APPLC_BEGIN ASE_APPLC_BEGIN
			,L.ASE_APPLC_END ASE_APPLC_END
			,L.NTIC_BEGIN_DT NTIC_BEGIN_DT
			,L.NTIC_END_DT NTIC_END_DT
			,L.RNTFEE RNTFEE
			,L.RNTFEE_SE RNTFEE_SE
			,L.RNTFEE_SE_NM RNTFEE_SE_NM
			,L.PAYINST_INTR PAYINST_INTR
			,L.SUP_AMT SUP_AMT
			,L.VAT VAT
			,L.PAY_AMT PAY_AMT
			,L.ACCNUT_YEAR ACCNUT_YEAR 
			,L.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
			,L.NTIC_SEQ NTIC_SEQ
			,L.NTIC_NO NTIC_NO
			,DECODE(L.NTIC_NO, NULL, 'N', 'Y') NTIC_YN
			,L.RCIV_SE RCIV_SE
			,TO_CHAR(L.RCIV_DT, 'YYYY-MM-DD') RCIV_DT
			,L.PAY_TMLMT PAY_TMLMT
			,GAM_GET_IS_PASS_DATE_YN(L.PAY_TMLMT) PAY_TMLMT_YN
			,L.NTIC_CNT NTIC_CNT
			,L.RM RM
		FROM
			(
				(
				<!-- 임대료 상세 가져오는 쿼리 -->
				SELECT
					D.MNG_YEAR MNG_YEAR
					,D.MNG_NO MNG_NO
					,D.MNG_SEQ MNG_SEQ
					,D.REGIST_SEQ REGIST_SEQ
					,F.RNTFEE_SEQ RNTFEE_SEQ
					,R.ENTRPS_CD ENTRPS_CD
					,(SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = R.ENTRPS_CD) ENTRPS_NM
					,R.BOUND_CD BOUND_CD 
					,GAM_GETCODENAME('GAM062', R.BOUND_CD) BOUND_NM
					,R.PAY_SE PAY_SE
					,TO_CHAR(R.CTRT_BEGIN_DT, 'YYYY-MM-DD') CTRT_BEGIN_DT
					,TO_CHAR(R.CTRT_END_DT, 'YYYY-MM-DD') CTRT_END_DT
					,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
					,R.CHRGE_KND_CD CHRGE_KND_CD
					,GAM_GETCODENAME('GAM053', R.CHRGE_KND_CD) CHRGE_KND_NM
					,TO_CHAR(R.TERMN_DT, 'YYYY-MM-DD') TERMN_DT
					,GAM_GET_IS_PASS_DATE_YN(R.TERMN_DT) TERMN_YN
					,TO_CHAR(D.DETAIL_PD_BEGIN, 'YYYY-MM-DD') DETAIL_PD_BEGIN
					,TO_CHAR(D.DETAIL_PD_END, 'YYYY-MM-DD') DETAIL_PD_END
					,NVL(D.RENT_AR, 0) RENT_AR
					,TO_CHAR(NVL(D.RENT_AR, 0), '9,999,999,999.99') RENT_AR_STR
					,D.RENT_AR_SE RENT_AR_SE
					,DECODE(D.RENT_AR_SE, '1', '물류부지', '2', '제조부지', '3', '숙성실', '') RENT_AR_SE_NM
					,NVL(D.APPLC_RNTFEE, 0) APPLC_RNTFEE
					,TO_CHAR(NVL(D.APPLC_RNTFEE, 0), '9,999,999,999.99') APPLC_RNTFEE_STR
					,D.PRICE_SE PRICE_SE
					,DECODE(D.PRICE_SE, '1', '면적당단가', '2', '월단가','') PRICE_SE_NM
					,NVL(D.ASE_RNTFEE, 0) ASE_RNTFEE
					,TO_CHAR(NVL(D.ASE_RNTFEE, 0), '9,999,999,999.99') ASE_RNTFEE_STR
					,TO_CHAR(D.ASE_APPLC_BEGIN, 'YYYY-MM-DD') ASE_APPLC_BEGIN
					,TO_CHAR(D.ASE_APPLC_END, 'YYYY-MM-DD') ASE_APPLC_END
					,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
					,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
					,NVL(F.RNTFEE, 0) RNTFEE
					,NVL(F.RNTFEE_SE, '0') RNTFEE_SE
					,F.RNTFEE_SE_NM RNTFEE_SE_NM
					,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
					,NVL(F.SUP_AMT, 0) SUP_AMT
					,NVL(F.VAT, 0) VAT
					,NVL(F.PAY_AMT, 0) PAY_AMT 
					,F.ACCNUT_YEAR ACCNUT_YEAR 
					,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
					,F.NTIC_SEQ NTIC_SEQ
					,(SELECT NTIC_NO FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_NO
					,(SELECT PAY_TMLMT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) PAY_TMLMT
					,(SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_CNT
					,(SELECT RCIV_SE FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_SE
					,(SELECT RCIV_DT FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_DT
					,F.RM RM
				FROM
					<isNotEmpty property="histDt">
						(SELECT A.* FROM HTLD_RENT_DETAIL_HIST_F A WHERE A.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(A.MNG_YEAR, A.MNG_NO, A.MNG_SEQ, #histDt#)) D
					</isNotEmpty>
					<isEmpty property="histDt">
						(SELECT A.* FROM HTLD_RENT_DETAIL_HIST_F A WHERE A.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(A.MNG_YEAR, A.MNG_NO, A.MNG_SEQ, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) D
					</isEmpty>
				LEFT OUTER JOIN
					HTLD_RNTFEE_F F
					ON D.MNG_YEAR = F.MNG_YEAR AND D.MNG_NO = F.MNG_NO AND D.MNG_SEQ = F.MNG_SEQ 
						AND (F.RENT_DETAIL_REGIST_SEQ IS NULL OR F.RENT_DETAIL_REGIST_SEQ = D.REGIST_SEQ) AND (F.RNTFEE_SE IS NULL OR F.RNTFEE_SE = '0' )
						<isNotEmpty property="histDt" prepend="AND">
							<![CDATA[
								D.DETAIL_PD_BEGIN <= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND D.DETAIL_PD_END >= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND ((F.NTIC_BEGIN_DT <= TO_DATE(#histDt#, 'YYYY-MM-DD') AND F.NTIC_END_DT >= TO_DATE(#histDt#, 'YYYY-MM-DD')) OR (F.NTIC_BEGIN_DT IS NULL AND F.NTIC_END_DT IS NULL ))
							]]>
						</isNotEmpty>
						<isEmpty property="histDt" prepend="AND">
							<![CDATA[
								D.DETAIL_PD_BEGIN <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND D.DETAIL_PD_END >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND ((F.NTIC_BEGIN_DT <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD') AND F.NTIC_END_DT >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')) OR (F.NTIC_BEGIN_DT IS NULL AND F.NTIC_END_DT IS NULL ))
							]]>
						</isEmpty>
				INNER JOIN
					<isNotEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, #histDt#)) R
					</isNotEmpty>
					<isEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) R
					</isEmpty>					
					ON D.MNG_YEAR = R.MNG_YEAR AND D.MNG_NO = R.MNG_NO AND D.MNG_SEQ = R.MNG_SEQ
				)
				UNION ALL
				(
				<!-- 실적평가 및 지적평가 가져오는 쿼리 -->
				SELECT
					D.MNG_YEAR MNG_YEAR
					,D.MNG_NO MNG_NO
					,D.MNG_SEQ MNG_SEQ
					,D.REGIST_SEQ REGIST_SEQ
					,F.RNTFEE_SEQ RNTFEE_SEQ
					,R.ENTRPS_CD ENTRPS_CD
					,(SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = R.ENTRPS_CD) ENTRPS_NM
					,R.BOUND_CD BOUND_CD 
					,GAM_GETCODENAME('GAM062', R.BOUND_CD) BOUND_NM
					,R.PAY_SE PAY_SE
					,TO_CHAR(R.CTRT_BEGIN_DT, 'YYYY-MM-DD') CTRT_BEGIN_DT
					,TO_CHAR(R.CTRT_END_DT, 'YYYY-MM-DD') CTRT_END_DT
					,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
					,R.CHRGE_KND_CD CHRGE_KND_CD
					,GAM_GETCODENAME('GAM053', R.CHRGE_KND_CD) CHRGE_KND_NM
					,TO_CHAR(R.TERMN_DT, 'YYYY-MM-DD') TERMN_DT
					,GAM_GET_IS_PASS_DATE_YN(R.TERMN_DT) TERMN_YN
					,TO_CHAR(D.DETAIL_PD_BEGIN, 'YYYY-MM-DD') DETAIL_PD_BEGIN
					,TO_CHAR(D.DETAIL_PD_END, 'YYYY-MM-DD') DETAIL_PD_END
					,NVL(D.RENT_AR, 0) RENT_AR
					,TO_CHAR(NVL(D.RENT_AR, 0), '9,999,999,999.99') RENT_AR_STR
					,D.RENT_AR_SE RENT_AR_SE
					,DECODE(D.RENT_AR_SE, '1', '물류부지', '2', '제조부지', '3', '숙성실', '') RENT_AR_SE_NM
					,NVL(D.APPLC_RNTFEE, 0) APPLC_RNTFEE
					,TO_CHAR(NVL(D.APPLC_RNTFEE, 0), '9,999,999,999.99') APPLC_RNTFEE_STR
					,D.PRICE_SE PRICE_SE
					,DECODE(D.PRICE_SE, '1', '면적당단가', '2', '월단가','') PRICE_SE_NM
					,NVL(F.APPLC_RNTFEE, 0) ASE_RNTFEE
					,TO_CHAR(NVL(F.APPLC_RNTFEE, 0), '9,999,999,999.99') ASE_RNTFEE_STR
					,TO_CHAR(F.APPLC_BEGIN_DT, 'YYYY-MM-DD') ASE_APPLC_BEGIN
					,TO_CHAR(F.APPLC_END_DT, 'YYYY-MM-DD') ASE_APPLC_END
					,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
					,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
					,NVL(F.RNTFEE, 0) RNTFEE
					,NVL(F.RNTFEE_SE, '2') RNTFEE_SE
					,F.RNTFEE_SE_NM RNTFEE_SE_NM
					,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
					,NVL(F.SUP_AMT, 0) SUP_AMT
					,NVL(F.VAT, 0) VAT
					,NVL(F.PAY_AMT, 0) PAY_AMT 
					,F.ACCNUT_YEAR ACCNUT_YEAR 
					,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
					,F.NTIC_SEQ NTIC_SEQ
					,(SELECT NTIC_NO FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_NO
					,(SELECT PAY_TMLMT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) PAY_TMLMT
					,(SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_CNT
					,(SELECT RCIV_SE FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_SE
					,(SELECT RCIV_DT FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_DT
					,F.RM RM
				FROM
					HTLD_RNTFEE_F F
				LEFT OUTER JOIN
					<isNotEmpty property="histDt">
						(SELECT A.* FROM HTLD_RENT_DETAIL_HIST_F A WHERE A.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(A.MNG_YEAR, A.MNG_NO, A.MNG_SEQ, #histDt#)) D
					</isNotEmpty>
					<isEmpty property="histDt">
						(SELECT A.* FROM HTLD_RENT_DETAIL_HIST_F A WHERE A.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(A.MNG_YEAR, A.MNG_NO, A.MNG_SEQ, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) D
					</isEmpty>
					ON D.MNG_YEAR = F.MNG_YEAR AND D.MNG_NO = F.MNG_NO AND D.MNG_SEQ = F.MNG_SEQ AND D.REGIST_SEQ = F.RENT_DETAIL_REGIST_SEQ AND (F.RNTFEE_SE = '1' OR F.RNTFEE_SE = '2')
						<isNotEmpty property="histDt" prepend="AND">
							<![CDATA[
								D.DETAIL_PD_BEGIN <= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND D.DETAIL_PD_END >= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND F.NTIC_BEGIN_DT <= TO_DATE(#histDt#, 'YYYY-MM-DD') 
								AND F.NTIC_END_DT >= TO_DATE(#histDt#, 'YYYY-MM-DD')
							]]>
						</isNotEmpty>
						<isEmpty property="histDt" prepend="AND">
							<![CDATA[
								D.DETAIL_PD_BEGIN <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND D.DETAIL_PD_END >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND F.NTIC_BEGIN_DT <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD') 
								AND F.NTIC_END_DT >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
							]]>
						</isEmpty>
				INNER JOIN
					<isNotEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, #histDt#)) R
					</isNotEmpty>
					<isEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) R
					</isEmpty>					
					ON D.MNG_YEAR = R.MNG_YEAR AND D.MNG_NO = R.MNG_NO AND D.MNG_SEQ = R.MNG_SEQ
				)
				UNION ALL
				(
				<!-- 추가정산 가져오는 쿼리 -->
				SELECT
					F.MNG_YEAR MNG_YEAR
					,F.MNG_NO MNG_NO
					,F.MNG_SEQ MNG_SEQ
					,NULL REGIST_SEQ
					,F.RNTFEE_SEQ RNTFEE_SEQ
					,R.ENTRPS_CD ENTRPS_CD
					,(SELECT E.ENTRPS_NM FROM ENTRPS_INFO_F E WHERE E.ENTRPSCD = R.ENTRPS_CD) ENTRPS_NM
					,R.BOUND_CD BOUND_CD 
					,GAM_GETCODENAME('GAM062', R.BOUND_CD) BOUND_NM
					,R.PAY_SE PAY_SE
					,TO_CHAR(R.CTRT_BEGIN_DT, 'YYYY-MM-DD') CTRT_BEGIN_DT
					,TO_CHAR(R.CTRT_END_DT, 'YYYY-MM-DD') CTRT_END_DT
					,GAM_GETCODENAME('GAM008', R.PAY_SE) PAY_SE_NM
					,R.CHRGE_KND_CD CHRGE_KND_CD
					,GAM_GETCODENAME('GAM053', R.CHRGE_KND_CD) CHRGE_KND_NM
					,TO_CHAR(R.TERMN_DT, 'YYYY-MM-DD') TERMN_DT
					,GAM_GET_IS_PASS_DATE_YN(R.TERMN_DT) TERMN_YN
					,TO_CHAR(R.CTRT_BEGIN_DT, 'YYYY-MM-DD') DETAIL_PD_BEGIN
					,TO_CHAR(R.CTRT_END_DT, 'YYYY-MM-DD') DETAIL_PD_END
					,0 RENT_AR
					,'0' RENT_AR_STR
					,NULL RENT_AR_SE
					,'' RENT_AR_SE_NM
					,0 APPLC_RNTFEE
					,'0' APPLC_RNTFEE_STR
					,NULL PRICE_SE
					,'' PRICE_SE_NM
					,NVL(F.APPLC_RNTFEE, 0) ASE_RNTFEE
					,TO_CHAR(NVL(F.APPLC_RNTFEE, 0), '9,999,999,999.99') ASE_RNTFEE_STR
					,TO_CHAR(F.APPLC_BEGIN_DT, 'YYYY-MM-DD') ASE_APPLC_BEGIN
					,TO_CHAR(F.APPLC_END_DT, 'YYYY-MM-DD') ASE_APPLC_END
					,TO_CHAR(F.NTIC_BEGIN_DT, 'YYYY-MM-DD') NTIC_BEGIN_DT
					,TO_CHAR(F.NTIC_END_DT, 'YYYY-MM-DD') NTIC_END_DT
					,NVL(F.RNTFEE, 0) RNTFEE
					,NVL(F.RNTFEE_SE, '3') RNTFEE_SE
					,F.RNTFEE_SE_NM RNTFEE_SE_NM
					,NVL(F.PAYINST_INTR, 0) PAYINST_INTR
					,NVL(F.SUP_AMT, 0) SUP_AMT
					,NVL(F.VAT, 0) VAT
					,NVL(F.PAY_AMT, 0) PAY_AMT 
					,F.ACCNUT_YEAR ACCNUT_YEAR 
					,F.RNTFEE_NTIC_NO RNTFEE_NTIC_NO
					,F.NTIC_SEQ NTIC_SEQ
					,(SELECT NTIC_NO FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_NO
					,(SELECT PAY_TMLMT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) PAY_TMLMT
					,(SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ) NTIC_CNT
					,(SELECT RCIV_SE FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_SE
					,(SELECT RCIV_DT FROM LEV_REQEST_F 
						WHERE PRT_AT_CODE = '622' AND MNG_YEAR = F.MNG_YEAR AND MNG_NO = F.MNG_NO AND MNG_CNT = F.MNG_SEQ AND CHRGE_KND = R.CHRGE_KND_CD
						AND NTIC_CNT = (SELECT NTIC_CNT FROM HTLD_NTIC_DTLS_F WHERE ACCNUT_YEAR = F.ACCNUT_YEAR AND RNTFEE_NTIC_NO = F.RNTFEE_NTIC_NO AND NTIC_SEQ = F.NTIC_SEQ)
						) RCIV_DT
					,F.RM RM
				FROM
					HTLD_RNTFEE_F F
				INNER JOIN
					<isNotEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, #histDt#)) R
					</isNotEmpty>
					<isEmpty property="histDt">
						(SELECT B.* FROM HTLD_RENT_HIST_F B WHERE B.HIST_SEQ = GAM_GET_HTLD_RENT_HIST_SEQ(B.MNG_YEAR, B.MNG_NO, B.MNG_SEQ, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))) R
					</isEmpty>					
					ON F.MNG_YEAR = R.MNG_YEAR AND F.MNG_NO = R.MNG_NO AND F.MNG_SEQ = R.MNG_SEQ AND F.RNTFEE_SE = '3'
						<isNotEmpty property="histDt" prepend="AND">
							<![CDATA[
								R.CTRT_BEGIN_DT <= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND R.CTRT_END_DT >= TO_DATE(#histDt#, 'YYYY-MM-DD')
								AND F.NTIC_BEGIN_DT <= TO_DATE(#histDt#, 'YYYY-MM-DD') 
								AND F.NTIC_END_DT >= TO_DATE(#histDt#, 'YYYY-MM-DD')
							]]>
						</isNotEmpty>
						<isEmpty property="histDt" prepend="AND">
							<![CDATA[
								R.CTRT_BEGIN_DT <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND R.CTRT_END_DT >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
								AND F.NTIC_BEGIN_DT <= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD') 
								AND F.NTIC_END_DT >= TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
							]]>
						</isEmpty>
				)
			) L
		WHERE 1=1
			<isNotEmpty property="paySe" prepend="AND">
				L.PAY_SE = #paySe#
			</isNotEmpty>
			<isNotEmpty property="termnYn" prepend="AND">
				L.TERMN_YN = #termnYn#
			</isNotEmpty>
		ORDER BY
			BOUND_CD, ENTRPS_CD, MNG_YEAR, MNG_NO, MNG_SEQ, RNTFEE_SE, REGIST_SEQ,  RNTFEE_SEQ	
	</select>
	 
	<!-- Cofix 이자율 조회 -->
	<select id="gamHtldRentMngtMainDao.selectCofixIntrrate_S" parameterClass="GamHtldRentMngtMainVO" resultClass="java.lang.String">
		SELECT TO_CHAR(NEW_MANIP_AMT_STDR_INTRRATE * 100, '9.99') COFIX_INTRRATE
		FROM 
			COFIX_INTRRATE_F
		WHERE
			<isNotEmpty property="histDt">
				<![CDATA[
				OBJ_YRMT = (SELECT MAX(OBJ_YRMT) FROM COFIX_INTRRATE_F WHERE TO_DATE(TO_CHAR(ANNODT, 'YYYY-MM-DD'), 'YYYY-MM-DD') <= TO_DATE(GAM_GET_QUARTER_START_DATE(#histDt#), 'YYYY-MM-DD'))
				]]>
			</isNotEmpty>
			<isEmpty property="histDt">
				<![CDATA[
				OBJ_YRMT = (SELECT MAX(OBJ_YRMT) FROM COFIX_INTRRATE_F WHERE TO_DATE(TO_CHAR(ANNODT, 'YYYY-MM-DD'), 'YYYY-MM-DD') <= TO_DATE(GAM_GET_QUARTER_START_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD')), 'YYYY-MM-DD'))
				]]>
			</isEmpty>
	</select>
	
	<!-- 임대료 테이블 등록(일반고지일 경우 가상데이터를 위한 쿼리 -->
	<insert id="gamHtldRentMngtMainDao.insertHtldRntfee_S" parameterClass="GamHtldRentRntfeeVO">
		INSERT INTO HTLD_RNTFEE_F (
			MNG_YEAR
			,MNG_NO
			,MNG_SEQ
			,RNTFEE_SEQ
			,RENT_DETAIL_REGIST_SEQ
			,RNTFEE_SE
			,RNTFEE_SE_NM
			,NTIC_BEGIN_DT
			,NTIC_END_DT
			,RNTFEE
			,PAYINST_INTR
			,SUP_AMT
			,VAT
			,PAY_AMT
			,RM
			,REG_USR
			,REGIST_DT
		) VALUES (
			#mngYear#
			,#mngNo#
			,#mngSeq#
			,#rntfeeSeq#
			,#registSeq#
			,#rntfeeSe#
			,#rntfeeSeNm#
			,TO_DATE(#nticBeginDt#, 'YYYY-MM-DD')
			,TO_DATE(#nticEndDt#, 'YYYY-MM-DD')
			,TO_NUMBER(#rntfee#)
			,TO_NUMBER(#payinstIntr#)
			,TO_NUMBER(#supAmt#)
			,TO_NUMBER(#vat#)
			,TO_NUMBER(#payAmt#)
			,#rm#
			,#regUsr#
			,SYSDATE
		)
	</insert>
	
	<!-- 임대료 수정(메인화면에서 임대료등을 고치면 자동계산후 갱신) -->
	<update id="gamHtldRentMngtMainDao.updateHtldRntfee_S" parameterClass="GamHtldRentRntfeeVO">
		UPDATE HTLD_RNTFEE_F
		SET
			RNTFEE = TO_NUMBER(#rntfee#)
			,PAYINST_INTR = TO_NUMBER(#payinstIntr#)
			,SUP_AMT = TO_NUMBER(#supAmt#)
			,VAT = TO_NUMBER(#vat#)
			,PAY_AMT = TO_NUMBER(#payAmt#)
			,RM = #rm#
			,UPD_USR = #updUsr#
			,UPDT_DT = SYSDATE
		WHERE 
			MNG_YEAR = #mngYear#
			AND MNG_NO = #mngNo#
			AND MNG_SEQ = #mngSeq#
			AND RNTFEE_SEQ = #rntfeeSeq#
	</update>
	
		<!-- 배후단지 임대료 순번 생성 -->
	<select id="gamHtldRentMngtMainDao.selectNextRntfeeSeq_S" parameterClass="GamHtldRentRntfeeVO" resultClass="java.lang.String">
   		SELECT
   		  	LPAD(NVL(MAX(RNTFEE_SEQ),0) + 1,'3','0')
   		FROM
   		  	HTLD_RNTFEE_F
   		WHERE
			MNG_YEAR=#mngYear# 
			AND MNG_NO=#mngNo# 
			AND MNG_SEQ=#mngSeq#
	</select>
	
</sqlMap>